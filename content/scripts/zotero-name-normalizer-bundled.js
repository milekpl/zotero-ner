/*! For license information please see zotero-name-normalizer-bundled.js.LICENSE.txt */
"undefined"==typeof console&&(globalThis.console={log:function(){"undefined"!=typeof Zotero&&Zotero.debug&&Zotero.debug("NameNormalizer: "+Array.prototype.join.call(arguments," "))},warn:function(){"undefined"!=typeof Zotero&&Zotero.debug&&Zotero.debug("NameNormalizer WARN: "+Array.prototype.join.call(arguments," "))},error:function(){"undefined"!=typeof Zotero&&Zotero.debug&&Zotero.debug("NameNormalizer ERROR: "+Array.prototype.join.call(arguments," "))},info:function(){"undefined"!=typeof Zotero&&Zotero.debug&&Zotero.debug("NameNormalizer INFO: "+Array.prototype.join.call(arguments," "))},debug:function(){"undefined"!=typeof Zotero&&Zotero.debug&&Zotero.debug("NameNormalizer DEBUG: "+Array.prototype.join.call(arguments," "))}}),function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.ZoteroNameNormalizer=t():e.ZoteroNameNormalizer=t()}(this,()=>(()=>{var e={22:(e,t,r)=>{function u(e){return u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},u(e)}function n(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=s(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var u=0,n=function(){};return{s:n,n:function(){return u>=e.length?{done:!0}:{done:!1,value:e[u++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,o=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return i=e.done,e},e:function(e){o=!0,a=e},f:function(){try{i||null==r.return||r.return()}finally{if(o)throw a}}}}function a(){var e,t,r="function"==typeof Symbol?Symbol:{},u=r.iterator||"@@iterator",n=r.toStringTag||"@@toStringTag";function o(r,u,n,a){var o=u&&u.prototype instanceof l?u:l,D=Object.create(o.prototype);return i(D,"_invoke",function(r,u,n){var a,i,o,l=0,D=n||[],c=!1,f={p:0,n:0,v:e,a:p,f:p.bind(e,4),d:function(t,r){return a=t,i=0,o=e,f.n=r,s}};function p(r,u){for(i=r,o=u,t=0;!c&&l&&!n&&t<D.length;t++){var n,a=D[t],p=f.p,h=a[2];r>3?(n=h===u)&&(o=a[(i=a[4])?5:(i=3,3)],a[4]=a[5]=e):a[0]<=p&&((n=r<2&&p<a[1])?(i=0,f.v=u,f.n=a[1]):p<h&&(n=r<3||a[0]>u||u>h)&&(a[4]=r,a[5]=u,f.n=h,i=0))}if(n||r>1)return s;throw c=!0,u}return function(n,D,h){if(l>1)throw TypeError("Generator is already running");for(c&&1===D&&p(D,h),i=D,o=h;(t=i<2?e:o)||!c;){a||(i?i<3?(i>1&&(f.n=-1),p(i,o)):f.n=o:f.v=o);try{if(l=2,a){if(i||(n="next"),t=a[n]){if(!(t=t.call(a,o)))throw TypeError("iterator result is not an object");if(!t.done)return t;o=t.value,i<2&&(i=0)}else 1===i&&(t=a.return)&&t.call(a),i<2&&(o=TypeError("The iterator does not provide a '"+n+"' method"),i=1);a=e}else if((t=(c=f.n<0)?o:r.call(u,f))!==s)break}catch(t){a=e,i=1,o=t}finally{l=1}}return{value:t,done:c}}}(r,n,a),!0),D}var s={};function l(){}function D(){}function c(){}t=Object.getPrototypeOf;var f=[][u]?t(t([][u]())):(i(t={},u,function(){return this}),t),p=c.prototype=l.prototype=Object.create(f);function h(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,c):(e.__proto__=c,i(e,n,"GeneratorFunction")),e.prototype=Object.create(p),e}return D.prototype=c,i(p,"constructor",c),i(c,"constructor",D),D.displayName="GeneratorFunction",i(c,n,"GeneratorFunction"),i(p),i(p,n,"Generator"),i(p,u,function(){return this}),i(p,"toString",function(){return"[object Generator]"}),(a=function(){return{w:o,m:h}})()}function i(e,t,r,u){var n=Object.defineProperty;try{n({},"",{})}catch(e){n=0}i=function(e,t,r,u){function a(t,r){i(e,t,function(e){return this._invoke(t,r,e)})}t?n?n(e,t,{value:r,enumerable:!u,configurable:!u,writable:!u}):e[t]=r:(a("next",0),a("throw",1),a("return",2))},i(e,t,r,u)}function o(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var u,n,a,i,o=[],s=!0,l=!1;try{if(a=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;s=!1}else for(;!(s=(u=a.call(r)).done)&&(o.push(u.value),o.length!==t);s=!0);}catch(e){l=!0,n=e}finally{try{if(!s&&null!=r.return&&(i=r.return(),Object(i)!==i))return}finally{if(l)throw n}}return o}}(e,t)||s(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function s(e,t){if(e){if("string"==typeof e)return l(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?l(e,t):void 0}}function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,u=Array(t);r<t;r++)u[r]=e[r];return u}function D(e,t,r,u,n,a,i){try{var o=e[a](i),s=o.value}catch(e){return void r(e)}o.done?t(s):Promise.resolve(s).then(u,n)}function c(e){return function(){var t=this,r=arguments;return new Promise(function(u,n){var a=e.apply(t,r);function i(e){D(a,u,n,i,o,"next",e)}function o(e){D(a,u,n,i,o,"throw",e)}i(void 0)})}}function f(e,t){for(var r=0;r<t.length;r++){var u=t[r];u.enumerable=u.enumerable||!1,u.configurable=!0,"value"in u&&(u.writable=!0),Object.defineProperty(e,p(u.key),u)}}function p(e){var t=function(e){if("object"!=u(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=u(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==u(t)?t:t+""}var h=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._learningEngine=null,this._nameParser=null,this._variantGenerator=null}return t=e,u=[{key:"learningEngine",get:function(){if(!this._learningEngine){var e=r(95);this._learningEngine=new e}return this._learningEngine}},{key:"nameParser",get:function(){if(!this._nameParser){var e=r(889);this._nameParser=new e}return this._nameParser}},{key:"variantGenerator",get:function(){if(!this._variantGenerator){var e=r(441);this._variantGenerator=new e}return this._variantGenerator}},{key:"findNameVariants",value:(h=c(a().m(function e(t){var r,u,n,i,s,l,D,c,f,p,h;return a().w(function(e){for(;;)switch(e.p=e.n){case 0:if(t){e.n=1;break}throw new Error("Zotero database object required for candidate finding");case 1:return e.p=1,e.n=2,this.fetchAllCreators(t);case 2:for(r=e.v,u=this.groupCreatorsBySurname(r),n={},i=0,s=0,l=Object.entries(u);s<l.length;s++)D=o(l[s],2),c=D[0],f=D[1],(p=this.findFirstInitialVariations(f)).length>0&&(n[c]=p,i+=p.length);return e.a(2,{surnameGroups:u,variationsBySurname:n,totalVariantGroups:i,totalSurnames:Object.keys(u).length});case 3:throw e.p=3,h=e.v,console.error("Error in findNameVariants:",h),h;case 4:return e.a(2)}},e,this,[[1,3]])})),function(e){return h.apply(this,arguments)})},{key:"fetchAllCreators",value:(p=c(a().m(function e(t){var r,u,i,o,s,l,D,c,f;return a().w(function(e){for(;;)switch(e.n){case 0:if("undefined"==typeof Zotero){e.n=2;break}return r=[],e.n=1,Zotero.Items.getAll();case 1:u=e.v,i=n(u);try{for(i.s();!(o=i.n()).done;){s=o.value,l=s.getCreators(),D=n(l);try{for(D.s();!(c=D.n()).done;)f=c.value,r.push(f)}catch(e){D.e(e)}finally{D.f()}}}catch(e){i.e(e)}finally{i.f()}return e.a(2,r);case 2:return e.a(2,[{firstName:"Jerry",lastName:"Fodor",creatorType:"author"},{firstName:"J.",lastName:"Fodor",creatorType:"author"},{firstName:"Jerry",lastName:"Fodor",creatorType:"author"},{firstName:"Jerry A.",lastName:"Fodor",creatorType:"author"},{firstName:"J.A.",lastName:"Fodor",creatorType:"author"},{firstName:"Eva",lastName:"van Dijk",creatorType:"author"},{firstName:"E.",lastName:"van Dijk",creatorType:"author"},{firstName:"John",lastName:"Smith",creatorType:"author"},{firstName:"J.",lastName:"Smith",creatorType:"author"},{firstName:"Johnny",lastName:"Smith",creatorType:"author"},{firstName:"J.B.",lastName:"Smith",creatorType:"author"},{firstName:"John B.",lastName:"Smith",creatorType:"author"}]);case 3:return e.a(2)}},e)})),function(e){return p.apply(this,arguments)})},{key:"groupCreatorsBySurname",value:function(e){var t,r={},u=n(e);try{for(u.s();!(t=u.n()).done;){var a=t.value,i=this.nameParser.parse("".concat(a.firstName||""," ").concat(a.lastName||"").trim());if(i.lastName){var o=i.lastName.toLowerCase().trim();r[o]||(r[o]=[]),r[o].push(a)}}}catch(e){u.e(e)}finally{u.f()}return r}},{key:"findFirstInitialVariations",value:function(t){var r,u={},a={},i=n(t);try{for(i.s();!(r=i.n()).done;){var o=r.value,s="".concat(o.firstName||""," ").concat(o.lastName||"").trim().toLowerCase();u[s]=(u[s]||0)+1,a[s]||(a[s]=o)}}catch(e){i.e(e)}finally{i.f()}var l,D={},c=n(t);try{for(c.s();!(l=c.n()).done;){var f=(l.value.firstName||"").trim().toLowerCase();f&&(D[f]||(D[f]=0),D[f]++)}}catch(e){c.e(e)}finally{c.f()}for(var p=[],h=function(e){var t=e.length,r=t<=3?"tiny":t<=5?"short":t<=8?"medium":"long",u=e.charAt(0).toLowerCase();return"".concat(u,"_").concat(r)},m={},y=0,F=Object.keys(D);y<F.length;y++){var v=F[y],d=h(v);m[d]||(m[d]=[]),m[d].push(v)}for(var g in m){var A=m[g];if(!(A.length<2))for(var C=0;C<A.length;C++)for(var E=C+1;E<A.length;E++){var b=A[C],B=A[E],w=this.calculateLevenshteinDistance(b,B),S=Math.max(b.length,B.length),k=S>0?1-w/S:1;k>=e.FIRST_NAME_SIMILARITY_THRESHOLD&&p.push({surname:t[0].lastName,variant1:{firstName:b,frequency:D[b]},variant2:{firstName:B,frequency:D[B]},similarity:k,distance:w})}}return p.sort(function(e,t){var r=e.variant1.frequency+e.variant2.frequency;return t.variant1.frequency+t.variant2.frequency-r}),p}},{key:"findCanonicalForms",value:function(e){for(var t={},r=0,u=Object.entries(e);r<u.length;r++){var a,i=o(u[r],2),s=(i[0],n(i[1]));try{for(s.s();!(a=s.n()).done;){var l=a.value,D=l.variant1.frequency>=l.variant2.frequency?l.variant1.firstName:l.variant2.firstName,c="".concat(l.variant1.firstName," ").concat(l.surname).trim(),f="".concat(l.variant2.firstName," ").concat(l.surname).trim(),p="".concat(D," ").concat(l.surname).trim();t[c.toLowerCase()]=p,t[f.toLowerCase()]=p}}catch(e){s.e(e)}finally{s.f()}}return t}},{key:"calculateLevenshteinDistance",value:function(e,t){var r=[];if(0===e.length)return t.length;if(0===t.length)return e.length;for(var u=0;u<=t.length;u++)r[u]=[u];for(var n=0;n<=e.length;n++)r[0][n]=n;for(var a=1;a<=t.length;a++)for(var i=1;i<=e.length;i++)t.charAt(a-1)===e.charAt(i-1)?r[a][i]=r[a-1][i-1]:r[a][i]=Math.min(r[a-1][i-1]+1,r[a][i-1]+1,r[a-1][i]+1);return r[t.length][e.length]}},{key:"performFullAnalysis",value:(D=c(a().m(function e(t){var r,u,n;return a().w(function(e){for(;;)switch(e.n){case 0:return console.log("Starting full name variant analysis (first name/initial focus)..."),e.n=1,this.findNameVariants(t);case 1:return r=e.v,u=this.findCanonicalForms(r.variationsBySurname),e.n=2,this.generateNormalizationSuggestions(r.variationsBySurname,u);case 2:return n=e.v,console.log("Analysis complete: Found ".concat(r.totalVariantGroups," variant groups across ").concat(r.totalSurnames," surnames")),e.a(2,{surnameGroups:r.surnameGroups,variationsBySurname:r.variationsBySurname,canonicalForms:u,suggestions:n,totalVariantGroups:r.totalVariantGroups,totalSurnamesAnalyzed:r.totalSurnames})}},e,this)})),function(e){return D.apply(this,arguments)})},{key:"generateNormalizationSuggestions",value:(l=c(a().m(function e(t,r){var u,i,s,l,D,c,f,p,h,m;return a().w(function(e){for(;;)if(0===e.n){for(u=[],i=0,s=Object.entries(t);i<s.length;i++){(l=o(s[i],2))[0],D=l[1],c=n(D);try{for(c.s();!(f=c.n()).done;)p=f.value,h="".concat(p.variant1.firstName," ").concat(p.surname).trim(),m="".concat(p.variant2.firstName," ").concat(p.surname).trim(),u.push({surname:p.surname,canonicalForm:r[h.toLowerCase()]||r[m.toLowerCase()],variant1:{firstName:p.variant1.firstName,frequency:p.variant1.frequency},variant2:{firstName:p.variant2.firstName,frequency:p.variant2.frequency},similarity:p.similarity,recommendedNormalization:p.variant1.frequency>=p.variant2.frequency?p.variant1.firstName:p.variant2.firstName})}catch(e){c.e(e)}finally{c.f()}}return e.a(2,u)}},e)})),function(e,t){return l.apply(this,arguments)})},{key:"getAllVariations",value:(s=c(a().m(function e(t){var r;return a().w(function(e){for(;;)if(0===e.n)return r=this.nameParser.parse(t),e.a(2,this.variantGenerator.generateVariants(r))},e,this)})),function(e){return s.apply(this,arguments)})}],i=[{key:"FIRST_NAME_SIMILARITY_THRESHOLD",get:function(){return.6}}],u&&f(t.prototype,u),i&&f(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,u,i,s,l,D,p,h}();e.exports&&(e.exports=h)},48:(e,t,r)=>{function u(e){return u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},u(e)}function n(){var e,t,r="function"==typeof Symbol?Symbol:{},u=r.iterator||"@@iterator",i=r.toStringTag||"@@toStringTag";function o(r,u,n,i){var o=u&&u.prototype instanceof l?u:l,D=Object.create(o.prototype);return a(D,"_invoke",function(r,u,n){var a,i,o,l=0,D=n||[],c=!1,f={p:0,n:0,v:e,a:p,f:p.bind(e,4),d:function(t,r){return a=t,i=0,o=e,f.n=r,s}};function p(r,u){for(i=r,o=u,t=0;!c&&l&&!n&&t<D.length;t++){var n,a=D[t],p=f.p,h=a[2];r>3?(n=h===u)&&(o=a[(i=a[4])?5:(i=3,3)],a[4]=a[5]=e):a[0]<=p&&((n=r<2&&p<a[1])?(i=0,f.v=u,f.n=a[1]):p<h&&(n=r<3||a[0]>u||u>h)&&(a[4]=r,a[5]=u,f.n=h,i=0))}if(n||r>1)return s;throw c=!0,u}return function(n,D,h){if(l>1)throw TypeError("Generator is already running");for(c&&1===D&&p(D,h),i=D,o=h;(t=i<2?e:o)||!c;){a||(i?i<3?(i>1&&(f.n=-1),p(i,o)):f.n=o:f.v=o);try{if(l=2,a){if(i||(n="next"),t=a[n]){if(!(t=t.call(a,o)))throw TypeError("iterator result is not an object");if(!t.done)return t;o=t.value,i<2&&(i=0)}else 1===i&&(t=a.return)&&t.call(a),i<2&&(o=TypeError("The iterator does not provide a '"+n+"' method"),i=1);a=e}else if((t=(c=f.n<0)?o:r.call(u,f))!==s)break}catch(t){a=e,i=1,o=t}finally{l=1}}return{value:t,done:c}}}(r,n,i),!0),D}var s={};function l(){}function D(){}function c(){}t=Object.getPrototypeOf;var f=[][u]?t(t([][u]())):(a(t={},u,function(){return this}),t),p=c.prototype=l.prototype=Object.create(f);function h(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,c):(e.__proto__=c,a(e,i,"GeneratorFunction")),e.prototype=Object.create(p),e}return D.prototype=c,a(p,"constructor",c),a(c,"constructor",D),D.displayName="GeneratorFunction",a(c,i,"GeneratorFunction"),a(p),a(p,i,"Generator"),a(p,u,function(){return this}),a(p,"toString",function(){return"[object Generator]"}),(n=function(){return{w:o,m:h}})()}function a(e,t,r,u){var n=Object.defineProperty;try{n({},"",{})}catch(e){n=0}a=function(e,t,r,u){function i(t,r){a(e,t,function(e){return this._invoke(t,r,e)})}t?n?n(e,t,{value:r,enumerable:!u,configurable:!u,writable:!u}):e[t]=r:(i("next",0),i("throw",1),i("return",2))},a(e,t,r,u)}function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(e);t&&(u=u.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,u)}return r}function o(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i(Object(r),!0).forEach(function(t){s(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function s(e,t,r){return(t=h(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function l(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return D(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?D(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var u=0,n=function(){};return{s:n,n:function(){return u>=e.length?{done:!0}:{done:!1,value:e[u++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,o=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return i=e.done,e},e:function(e){o=!0,a=e},f:function(){try{i||null==r.return||r.return()}finally{if(o)throw a}}}}function D(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,u=Array(t);r<t;r++)u[r]=e[r];return u}function c(e,t,r,u,n,a,i){try{var o=e[a](i),s=o.value}catch(e){return void r(e)}o.done?t(s):Promise.resolve(s).then(u,n)}function f(e){return function(){var t=this,r=arguments;return new Promise(function(u,n){var a=e.apply(t,r);function i(e){c(a,u,n,i,o,"next",e)}function o(e){c(a,u,n,i,o,"throw",e)}i(void 0)})}}function p(e,t){for(var r=0;r<t.length;r++){var u=t[r];u.enumerable=u.enumerable||!1,u.configurable=!0,"value"in u&&(u.writable=!0),Object.defineProperty(e,h(u.key),u)}}function h(e){var t=function(e){if("object"!=u(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=u(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==u(t)?t:t+""}var m=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.nameParser=new(r(889)),this.variantGenerator=new(r(441)),this.learningEngine=new(r(95)),this.candidateFinder=new(r(22))},t=[{key:"processItemCreators",value:(s=f(n().m(function e(t){var r,u,a,i,s,D,c,f,p,h,m,y;return n().w(function(e){for(;;)switch(e.p=e.n){case 0:r=[],u=t.getCreators?t.getCreators():[],a=l(u),e.p=1,a.s();case 2:if((i=a.n()).done){e.n=6;break}if(!(s=i.value).firstName&&!s.lastName){e.n=5;break}if(D=this.buildRawName(s),!(c=this.learningEngine.getMapping(D))){e.n=3;break}return r.push({original:o({},s),normalized:this.parseNameFromFullString(c),type:s.creatorType,status:"learned",suggestion:c}),e.a(3,5);case 3:return f=this.learningEngine.findSimilar(D),p=this.nameParser.parse(D),h=this.variantGenerator.generateVariants(p),e.n=4,this.findLibraryWideVariants(p.lastName);case 4:m=e.v,r.push({original:o({},s),parsed:p,variants:h,similars:f,libraryVariants:m,type:s.creatorType,status:"new"});case 5:e.n=2;break;case 6:e.n=8;break;case 7:e.p=7,y=e.v,a.e(y);case 8:return e.p=8,a.f(),e.f(8);case 9:return e.a(2,r)}},e,this,[[1,7,8,9]])})),function(e){return s.apply(this,arguments)})},{key:"findLibraryWideVariants",value:(i=f(n().m(function e(t){var r;return n().w(function(e){for(;;)switch(e.p=e.n){case 0:if("undefined"==typeof Zotero){e.n=3;break}return e.p=1,e.a(2,[]);case 2:return e.p=2,r=e.v,console.warn("Could not perform library-wide variant scan:",r),e.a(2,[]);case 3:return e.a(2,[])}},e,null,[[1,2]])})),function(e){return i.apply(this,arguments)})},{key:"buildRawName",value:function(e){return"".concat(e.firstName||""," ").concat(e.lastName||"").trim()}},{key:"parseNameFromFullString",value:function(e){var t=this.nameParser.parse(e);return{firstName:t.firstName,lastName:t.lastName,fieldMode:0}}},{key:"applyNormalizations",value:(a=f(n().m(function e(t,r){var u,a,i,o;return n().w(function(e){for(;;)switch(e.n){case 0:u=0;case 1:if(!(u<r.length)){e.n=3;break}if(!(a=r[u]).accepted){e.n=2;break}return console.log("Applying normalization: ".concat(a.original.firstName," ").concat(a.original.lastName," -> ").concat(a.normalized.firstName," ").concat(a.normalized.lastName)),i=this.buildRawName(a.original),o=this.buildRawName(a.normalized),e.n=2,this.learningEngine.storeMapping(i,o);case 2:u++,e.n=1;break;case 3:console.log("Applied normalizations to item:",t.getField("title"));case 4:return e.a(2)}},e,this)})),function(e,t){return a.apply(this,arguments)})},{key:"performLibraryAnalysis",value:(u=f(n().m(function e(t){var r,u,a,i,o,s,D,c,f,p,h,m,y,F,v,d,g,A,C,E,b,B,w,S;return n().w(function(e){for(;;)if(0===e.n){r=[],u=l(t);try{for(u.s();!(a=u.n()).done;){i=a.value,o=i.getCreators?i.getCreators():[],s=l(o);try{for(s.s();!(D=s.n()).done;)((c=D.value).firstName||c.lastName)&&(f=this.buildRawName(c),r.push(f))}catch(e){s.e(e)}finally{s.f()}}}catch(e){u.e(e)}finally{u.f()}for(this.learningEngine.constructor.prototype.extractSurnamesWithFrequency||this.nameParser.constructor.prototype.extractSurnamesWithFrequency,p={},h=0,m=r;h<m.length;h++)y=m[h],(F=this.nameParser.parse(y)).lastName&&(v=F.lastName.toLowerCase().trim(),p[v]=(p[v]||0)+1);for(d=Object.keys(p),g=[],A=0;A<d.length;A++)for(C=A+1;C<d.length;C++)E=d[A],b=d[C],B=this.calculateLevenshteinDistance(E,b),w=Math.max(E.length,b.length),(S=w>0?1-B/w:1)>=.8&&g.push({name1:E,name2:b,frequency1:p[E],frequency2:p[b],similarity:S});return e.a(2,{surnameFrequencies:p,potentialVariants:g,totalNames:r.length,uniqueSurnames:d.length})}},e,this)})),function(e){return u.apply(this,arguments)})},{key:"calculateLevenshteinDistance",value:function(e,t){var r=[];if(0===e.length)return t.length;if(0===t.length)return e.length;for(var u=0;u<=t.length;u++)r[u]=[u];for(var n=0;n<=e.length;n++)r[0][n]=n;for(var a=1;a<=t.length;a++)for(var i=1;i<=e.length;i++)t.charAt(a-1)===e.charAt(i-1)?r[a][i]=r[a-1][i-1]:r[a][i]=Math.min(r[a-1][i-1]+1,r[a][i-1]+1,r[a-1][i]+1);return r[t.length][e.length]}}],t&&p(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,u,a,i,s}();e.exports&&(e.exports=m)},95:(e,t,r)=>{function u(e){return u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},u(e)}function n(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var u,n,a,i,o=[],s=!0,l=!1;try{if(a=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;s=!1}else for(;!(s=(u=a.call(r)).done)&&(o.push(u.value),o.length!==t);s=!0);}catch(e){l=!0,n=e}finally{try{if(!s&&null!=r.return&&(i=r.return(),Object(i)!==i))return}finally{if(l)throw n}}return o}}(e,t)||D(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function a(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=D(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var u=0,n=function(){};return{s:n,n:function(){return u>=e.length?{done:!0}:{done:!1,value:e[u++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,o=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return i=e.done,e},e:function(e){o=!0,a=e},f:function(){try{i||null==r.return||r.return()}finally{if(o)throw a}}}}function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(e);t&&(u=u.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,u)}return r}function o(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i(Object(r),!0).forEach(function(t){s(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function s(e,t,r){return(t=F(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function l(e){return function(e){if(Array.isArray(e))return c(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||D(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function D(e,t){if(e){if("string"==typeof e)return c(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?c(e,t):void 0}}function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,u=Array(t);r<t;r++)u[r]=e[r];return u}function f(){var e,t,r="function"==typeof Symbol?Symbol:{},u=r.iterator||"@@iterator",n=r.toStringTag||"@@toStringTag";function a(r,u,n,a){var s=u&&u.prototype instanceof o?u:o,l=Object.create(s.prototype);return p(l,"_invoke",function(r,u,n){var a,o,s,l=0,D=n||[],c=!1,f={p:0,n:0,v:e,a:p,f:p.bind(e,4),d:function(t,r){return a=t,o=0,s=e,f.n=r,i}};function p(r,u){for(o=r,s=u,t=0;!c&&l&&!n&&t<D.length;t++){var n,a=D[t],p=f.p,h=a[2];r>3?(n=h===u)&&(s=a[(o=a[4])?5:(o=3,3)],a[4]=a[5]=e):a[0]<=p&&((n=r<2&&p<a[1])?(o=0,f.v=u,f.n=a[1]):p<h&&(n=r<3||a[0]>u||u>h)&&(a[4]=r,a[5]=u,f.n=h,o=0))}if(n||r>1)return i;throw c=!0,u}return function(n,D,h){if(l>1)throw TypeError("Generator is already running");for(c&&1===D&&p(D,h),o=D,s=h;(t=o<2?e:s)||!c;){a||(o?o<3?(o>1&&(f.n=-1),p(o,s)):f.n=s:f.v=s);try{if(l=2,a){if(o||(n="next"),t=a[n]){if(!(t=t.call(a,s)))throw TypeError("iterator result is not an object");if(!t.done)return t;s=t.value,o<2&&(o=0)}else 1===o&&(t=a.return)&&t.call(a),o<2&&(s=TypeError("The iterator does not provide a '"+n+"' method"),o=1);a=e}else if((t=(c=f.n<0)?s:r.call(u,f))!==i)break}catch(t){a=e,o=1,s=t}finally{l=1}}return{value:t,done:c}}}(r,n,a),!0),l}var i={};function o(){}function s(){}function l(){}t=Object.getPrototypeOf;var D=[][u]?t(t([][u]())):(p(t={},u,function(){return this}),t),c=l.prototype=o.prototype=Object.create(D);function h(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,l):(e.__proto__=l,p(e,n,"GeneratorFunction")),e.prototype=Object.create(c),e}return s.prototype=l,p(c,"constructor",l),p(l,"constructor",s),s.displayName="GeneratorFunction",p(l,n,"GeneratorFunction"),p(c),p(c,n,"Generator"),p(c,u,function(){return this}),p(c,"toString",function(){return"[object Generator]"}),(f=function(){return{w:a,m:h}})()}function p(e,t,r,u){var n=Object.defineProperty;try{n({},"",{})}catch(e){n=0}p=function(e,t,r,u){function a(t,r){p(e,t,function(e){return this._invoke(t,r,e)})}t?n?n(e,t,{value:r,enumerable:!u,configurable:!u,writable:!u}):e[t]=r:(a("next",0),a("throw",1),a("return",2))},p(e,t,r,u)}function h(e,t,r,u,n,a,i){try{var o=e[a](i),s=o.value}catch(e){return void r(e)}o.done?t(s):Promise.resolve(s).then(u,n)}function m(e){return function(){var t=this,r=arguments;return new Promise(function(u,n){var a=e.apply(t,r);function i(e){h(a,u,n,i,o,"next",e)}function o(e){h(a,u,n,i,o,"throw",e)}i(void 0)})}}function y(e,t){for(var r=0;r<t.length;r++){var u=t[r];u.enumerable=u.enumerable||!1,u.configurable=!0,"value"in u&&(u.writable=!0),Object.defineProperty(e,F(u.key),u)}}function F(e){var t=function(e){if("object"!=u(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=u(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==u(t)?t:t+""}var v=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.storageKey="name_normalizer_mappings",this.settingsKey="name_normalizer_settings",this.mappings=new Map,this.settings=this.getDefaultSettings(),this.distinctPairsKey="name_normalizer_distinct_pairs",this.distinctPairs=new Map,this.skipStorageKey="name_normalizer_skipped_suggestions",this.skippedPairs=new Set,this.loadMappings(),this.loadSettings(),this.loadDistinctPairs(),this.loadSkippedPairs()}return t=e,u=[{key:"getStorage",value:function(){return"undefined"!=typeof localStorage?localStorage:"undefined"!=typeof window&&window.localStorage?window.localStorage:(r.g._nameNormalizerStorage||(r.g._nameNormalizerStorage={}),{getItem:function(e){return r.g._nameNormalizerStorage[e]||null},setItem:function(e,t){r.g._nameNormalizerStorage[e]=t},removeItem:function(e){delete r.g._nameNormalizerStorage[e]}})}},{key:"loadMappings",value:(E=m(f().m(function e(){var t,r,u;return f().w(function(e){for(;;)switch(e.n){case 0:try{t=this.getStorage(),(r=t.getItem(this.storageKey))&&(u=JSON.parse(r),this.mappings=new Map(u))}catch(e){console.error("Error loading mappings:",e),this.mappings=new Map}case 1:return e.a(2)}},e,this)})),function(){return E.apply(this,arguments)})},{key:"saveMappings",value:(C=m(f().m(function e(){var t,r;return f().w(function(e){for(;;)switch(e.n){case 0:try{t=this.getStorage(),r=JSON.stringify(l(this.mappings.entries())),t.setItem(this.storageKey,r)}catch(e){console.error("Error saving mappings:",e)}case 1:return e.a(2)}},e,this)})),function(){return C.apply(this,arguments)})},{key:"loadSettings",value:(A=m(f().m(function e(){var t,r;return f().w(function(e){for(;;)switch(e.n){case 0:try{t=this.getStorage(),(r=t.getItem(this.settingsKey))&&(this.settings=o(o({},this.getDefaultSettings()),JSON.parse(r)))}catch(e){console.error("Error loading settings:",e),this.settings=this.getDefaultSettings()}case 1:return e.a(2)}},e,this)})),function(){return A.apply(this,arguments)})},{key:"saveSettings",value:(g=m(f().m(function e(){return f().w(function(e){for(;;)switch(e.n){case 0:try{this.getStorage().setItem(this.settingsKey,JSON.stringify(this.settings))}catch(e){console.error("Error saving settings:",e)}case 1:return e.a(2)}},e,this)})),function(){return g.apply(this,arguments)})},{key:"loadDistinctPairs",value:(d=m(f().m(function e(){var t,r;return f().w(function(e){for(;;)switch(e.n){case 0:try{t=this.getStorage(),(r=t.getItem(this.distinctPairsKey))&&(this.distinctPairs=new Map(JSON.parse(r)))}catch(e){console.error("Error loading distinct name pairs:",e),this.distinctPairs=new Map}case 1:return e.a(2)}},e,this)})),function(){return d.apply(this,arguments)})},{key:"saveDistinctPairs",value:(v=m(f().m(function e(){var t,r;return f().w(function(e){for(;;)switch(e.n){case 0:try{t=this.getStorage(),r=JSON.stringify(l(this.distinctPairs.entries())),t.setItem(this.distinctPairsKey,r)}catch(e){console.error("Error saving distinct name pairs:",e)}case 1:return e.a(2)}},e,this)})),function(){return v.apply(this,arguments)})},{key:"createPairKey",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";if(!e||!t)return null;var u=this.createCanonicalKey(e),n=this.createCanonicalKey(t);if(!u||!n)return null;var a=[u,n].sort();return"".concat(r||"global","::").concat(a[0],"|").concat(a[1])}},{key:"recordDistinctPair",value:(F=m(f().m(function e(t,r){var u,n,a=arguments;return f().w(function(e){for(;;)switch(e.n){case 0:if(u=a.length>2&&void 0!==a[2]?a[2]:"",n=this.createPairKey(t,r,u)){e.n=1;break}return e.a(2,!1);case 1:if(this.distinctPairs.has(n)){e.n=3;break}return this.distinctPairs.set(n,{scope:u||"global",timestamp:Date.now()}),e.n=2,this.saveDistinctPairs();case 2:return e.a(2,!0);case 3:return e.a(2,!1)}},e,this)})),function(e,t){return F.apply(this,arguments)})},{key:"isDistinctPair",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",u=this.createPairKey(e,t,r);return!!u&&this.distinctPairs.has(u)}},{key:"clearDistinctPair",value:(h=m(f().m(function e(t,r){var u,n,a=arguments;return f().w(function(e){for(;;)switch(e.n){case 0:if(u=a.length>2&&void 0!==a[2]?a[2]:"",n=this.createPairKey(t,r,u)){e.n=1;break}return e.a(2,!1);case 1:if(!this.distinctPairs.delete(n)){e.n=3;break}return e.n=2,this.saveDistinctPairs();case 2:return e.a(2,!0);case 3:return e.a(2,!1)}},e,this)})),function(e,t){return h.apply(this,arguments)})},{key:"getDefaultSettings",value:function(){return{autoApplyLearned:!0,confidenceThreshold:e.CONFIDENCE_THRESHOLD,enableSpanishSurnameDetection:!0,showSimilarityScore:!0,maxSuggestions:5}}},{key:"storeMapping",value:(p=m(f().m(function e(t,r){var u,n,a,i,s,l=arguments;return f().w(function(e){for(;;)switch(e.n){case 0:return u=l.length>2&&void 0!==l[2]?l[2]:1,n=l.length>3&&void 0!==l[3]?l[3]:{},a=this.createCanonicalKey(t),i=Date.now(),this.mappings.has(a)?((s=this.mappings.get(a)).normalized=r,s.confidence=Math.max(s.confidence,u),s.lastUsed=i,s.usageCount=(s.usageCount||0)+1,s.context=o(o({},s.context),n)):this.mappings.set(a,{raw:t,normalized:r,timestamp:i,lastUsed:i,confidence:u,usageCount:1,context:n}),e.n=1,this.saveMappings();case 1:return e.a(2)}},e,this)})),function(e,t){return p.apply(this,arguments)})},{key:"recordUsage",value:(c=m(f().m(function e(t){var r,u;return f().w(function(e){for(;;)switch(e.n){case 0:if(r=this.createCanonicalKey(t),!(u=this.mappings.get(r))){e.n=1;break}return u.lastUsed=Date.now(),u.usageCount=(u.usageCount||0)+1,e.n=1,this.saveMappings();case 1:return e.a(2)}},e,this)})),function(e){return c.apply(this,arguments)})},{key:"getMapping",value:function(e){var t=this.createCanonicalKey(e),r=this.mappings.get(t);return r?(this.recordUsage(e),r.normalized):null}},{key:"hasMapping",value:function(e){var t=this.createCanonicalKey(e);return this.mappings.has(t)}},{key:"getMappingDetails",value:function(e){var t=this.createCanonicalKey(e),r=this.mappings.get(t);return r?(this.recordUsage(e),o({},r)):null}},{key:"getAllMappings",value:function(){return new Map(this.mappings)}},{key:"removeMapping",value:(D=m(f().m(function e(t){var r;return f().w(function(e){for(;;)switch(e.n){case 0:return r=this.createCanonicalKey(t),this.mappings.delete(r),e.n=1,this.saveMappings();case 1:return e.a(2)}},e,this)})),function(e){return D.apply(this,arguments)})},{key:"clearAllMappings",value:(s=m(f().m(function e(){return f().w(function(e){for(;;)switch(e.n){case 0:return this.mappings.clear(),e.n=1,this.saveMappings();case 1:return e.a(2)}},e,this)})),function(){return s.apply(this,arguments)})},{key:"createCanonicalKey",value:function(e){return null==e?"":e.trim().toLowerCase().replace(/[.,]/g,"").replace(/\s+/g," ")}},{key:"findSimilar",value:function(e){var t,r=this.createCanonicalKey(e),u=[],i=a(this.mappings);try{for(i.s();!(t=i.n()).done;){var s=n(t.value,2),l=s[0],D=s[1],c=this.calculateSimilarity(r,l);c>=this.settings.confidenceThreshold&&u.push(o(o({},D),{},{similarity:c}))}}catch(e){i.e(e)}finally{i.f()}return u.sort(function(e,t){return t.similarity!==e.similarity?t.similarity-e.similarity:(t.usageCount||0)-(e.usageCount||0)}).slice(0,this.settings.maxSuggestions)}},{key:"calculateSimilarity",value:function(t,r){var u=this.jaroWinklerSimilarity(t,r),n=this.lcsSimilarity(t,r),a=this.initialMatchingSimilarity(t,r);return u*e.JARO_WINKLER_WEIGHT+n*e.LCS_WEIGHT+a*e.INITIAL_MATCHING_WEIGHT}},{key:"jaroWinklerSimilarity",value:function(t,r){if(t===r)return 1;if(!t||!r)return 0;for(var u=[],n=t.length,a=r.length,i=Math.floor(Math.max(n,a)/2)-1,o=0,s=0,l=new Array(n).fill(!1),D=new Array(a).fill(!1),c=0;c<n;c++)for(var f=Math.max(0,c-i),p=Math.min(c+i+1,a),h=f;h<p;h++)if(!D[h]&&t[c]===r[h]){l[c]=D[h]=!0,o++,u.push(t[c]);break}if(0===o)return 0;for(var m=0,y=0;y<n;y++)if(l[y]){for(;!D[m];)m++;t[y]!==r[m]&&s++,m++}for(var F=(o/n+o/a+(o-s/2)/o)/3,v=0,d=Math.min(4,Math.min(t.length,r.length)),g=0;g<d&&t[g]===r[g];g++)v++;return F+e.PREFIX_BONUS*v*(1-F)}},{key:"lcsSimilarity",value:function(e,t){var r=this;if(!e||!t)return 0;if(e===t)return 1;var u,n=e.split(/\s+/),i=t.split(/\s+/),o=0,s=a(n);try{var l=function(){var e=u.value;i.some(function(t){return r.isSimilarWord(e,t)})&&o++};for(s.s();!(u=s.n()).done;)l()}catch(e){s.e(e)}finally{s.f()}var D=Math.max(n.length,i.length);return D>0?o/D:0}},{key:"isSimilarWord",value:function(e,t){if((e=e.replace(/\./g,""))===(t=t.replace(/\./g,"")))return!0;if(1===e.length&&t.startsWith(e)||1===t.length&&e.startsWith(t))return!0;var r={jose:"joseph",joseph:"joe",robert:"rob",charles:"chuck",william:"will",jonathan:"jon"};return r[e]===t||r[t]===e}},{key:"areWordsSimilar",value:function(e,t){return this.isSimilarWord(e,t)}},{key:"isAbbreviation",value:function(e,t){if(e.length>=t.length)return!1;for(var r=0;r<e.length;r++)if(t[r]!==e[r])return!1;return!0}},{key:"initialMatchingSimilarity",value:function(e,t){var r=e.split(/\s+/),u=t.split(/\s+/);return 0===r.length||0===u.length?0:(this.compareNameParts(r[0],u[0])+this.compareNameParts(r[r.length-1],u[u.length-1]))/2}},{key:"compareNameParts",value:function(t,r){if(!t||!r)return 0;if(t.toLowerCase()===r.toLowerCase())return 1;var u=t.replace(/\./g,"").toLowerCase(),n=r.replace(/\./g,"").toLowerCase();return 1===u.length&&n.startsWith(u)||1===n.length&&u.startsWith(n)?e.SINGLE_CHAR_MATCH_SCORE:this.jaroWinklerSimilarity(u,n)}},{key:"exportMappings",value:function(){return{version:"1.0",timestamp:Date.now(),mappings:l(this.mappings.entries()),settings:this.settings}}},{key:"importMappings",value:function(e){if("1.0"!==e.version)throw new Error("Unsupported import data version");this.mappings=new Map(e.mappings),e.settings&&(this.settings=o(o({},this.settings),e.settings),this.saveSettings()),this.saveMappings()}},{key:"getStatistics",value:function(){var e,t=this.mappings.size,r=0,u=0,n=a(this.mappings.values());try{for(n.s();!(e=n.n()).done;){var i=e.value;r+=i.usageCount||0,u+=i.confidence||0}}catch(e){n.e(e)}finally{n.f()}return{totalMappings:t,totalUsage:r,averageUsage:t>0?r/t:0,averageConfidence:u=t>0?u/t:0,skippedPairs:this.skippedPairs?this.skippedPairs.size:0}}},{key:"loadSkippedPairs",value:function(){try{var t=this.getStorage().getItem(e.SKIP_STORAGE_KEY);this.skippedPairs=t?new Set(JSON.parse(t)):new Set}catch(e){console.error("Error loading skipped pairs:",e),this.skippedPairs=new Set}}},{key:"saveSkippedPairs",value:function(){try{var t=this.getStorage(),r=JSON.stringify(l(this.skippedPairs));t.setItem(e.SKIP_STORAGE_KEY,r),"undefined"!=typeof Zotero&&Zotero.Prefs&&Zotero.Prefs.set(e.SKIP_STORAGE_KEY,r)}catch(e){console.error("Error saving skipped pairs:",e)}}},{key:"generateSkipKey",value:function(e,t){var r=(e||"").toLowerCase().trim(),u=(t||"").toLowerCase().trim(),n=function(e){for(var t=0,r=0;r<e.length;r++)t=(t<<5)-t+e.charCodeAt(r),t&=t;return Math.abs(t).toString(16)},a=n(r),i=n(u);return"name:skip:".concat(a,":").concat(i)}},{key:"recordSkipDecision",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},u=this.generateSkipKey(e,t);return this.skippedPairs||this.loadSkippedPairs(),!this.skippedPairs.has(u)&&(this.skippedPairs.add(u),this.saveSkippedPairs(),r.debug&&console.debug('LearningEngine: Recorded skip for "'.concat(e,", ").concat(t,'" -> ').concat(u)),!0)}},{key:"shouldSkipSuggestion",value:function(e){this.skippedPairs||this.loadSkippedPairs();var t=e.surname||e.canonical||"",r=e.firstNamePattern||e.firstName||"",u=this.generateSkipKey(t,r);return this.skippedPairs.has(u)}},{key:"shouldSkipPair",value:function(e,t){this.skippedPairs||this.loadSkippedPairs();var r=this.generateSkipKey(e,t);return this.skippedPairs.has(r)}},{key:"removeSkipDecision",value:function(e,t){this.skippedPairs||this.loadSkippedPairs();var r=this.generateSkipKey(e,t),u=this.skippedPairs.delete(r);return u&&this.saveSkippedPairs(),u}},{key:"clearSkippedPairs",value:function(){this.skippedPairs=new Set,this.saveSkippedPairs(),"undefined"!=typeof Zotero&&Zotero.Prefs&&Zotero.Prefs.clear(e.SKIP_STORAGE_KEY)}},{key:"getSkippedPairsCount",value:function(){return this.skippedPairs||this.loadSkippedPairs(),this.skippedPairs.size}},{key:"getSkippedPairs",value:function(){return this.skippedPairs||this.loadSkippedPairs(),l(this.skippedPairs)}},{key:"filterSkippedSuggestions",value:function(e){var t=this;return this.skippedPairs||this.loadSkippedPairs(),e.filter(function(e){return!t.shouldSkipSuggestion(e)})}},{key:"getSkipStatistics",value:function(){return this.skippedPairs||this.loadSkippedPairs(),{skippedCount:this.skippedPairs?this.skippedPairs.size:0}}}],i=[{key:"CONFIDENCE_THRESHOLD",get:function(){return.8}},{key:"JARO_WINKLER_WEIGHT",get:function(){return.5}},{key:"LCS_WEIGHT",get:function(){return.3}},{key:"INITIAL_MATCHING_WEIGHT",get:function(){return.2}},{key:"PREFIX_BONUS",get:function(){return.1}},{key:"SINGLE_CHAR_MATCH_SCORE",get:function(){return.8}},{key:"SKIP_STORAGE_KEY",get:function(){return"name_normalizer_skipped_suggestions"}}],u&&y(t.prototype,u),i&&y(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,u,i,s,D,c,p,h,F,v,d,g,A,C,E}();e.exports&&(e.exports=v)},258:e=>{var t=["van","de","la","von","del","di","du","le","lo","da","des","dos","das","el","al","do","d","O'","Mac","Mc","Saint","St","San","Santa"],r=["Jr","Sr","II","III","IV","V","PhD","MD","JD","MBA","MA","BA","BS","MS","BSc","MSc","Dr","Prof","Sir","Jr.","Sr."],u={William:["Bill","Will","Willy","Billy"],Robert:["Bob","Rob","Bobby","Bert"],James:["Jim","Jimmy","Jamie","Jake"],John:["Jack","Johnny","Jon","Sean"],Michael:["Mike","Mick","Mickey","Mikey"],David:["Dave","Davey","Davy"],Richard:["Rich","Dick","Ricky","Rick"],Charles:["Chuck","Charlie","Charley","Carl"],Thomas:["Tom","Tommy","Todd"],Christopher:["Chris","Christoph","Kit"],Daniel:["Dan","Danny","Dani"],Matthew:["Matt","Matthieu","Matthew"],Anthony:["Tony","Ant"],Mark:["Marc","Marco"],Steven:["Steve","Stevie"],Paul:["Paolo"],Andrew:["Andy","Drew","Andreas"],Joshua:["Josh","Josiah"],Kenneth:["Ken","Kenny"],Kevin:["Kev"],Brian:["Bry","Bri"],George:["Geo","Georgie"],Edward:["Ed","Eddie","Ned","Ted"],Ronald:["Ron","Ronny"],Timothy:["Tim","Timmy","Timothy"],Jason:["Jay","Jace"],Jeffrey:["Jeff","Geoff","Jeffrey"],Ryan:["Ry"],Jacob:["Jake","Jay"],Gary:["Gare","Gar"],Jonathan:["Jon","John","Jonny"],Stephen:["Steve","Steph","Steven"],Larry:["Lawr","Larr"],Justin:["Just","Jus"],Scott:["Scot"],Brandon:["Brand","Bran"],Benjamin:["Ben","Benny","Benjy"],Samuel:["Sam","Sammy","Samuel"],Raymond:["Ray","Raye"],Frank:["Fran","Franky"],Gregory:["Greg","Gregg","Gregory"],Alexander:["Alex","Xander","Andy"],Patrick:["Pat","Paddy","Rick"],Jack:["John","Johnny"],Dennis:["Denn","Den"],Jerry:["Jer","Jerr"],Tyler:["Ty"],Aaron:["Ron","Aron"],Jose:["Joe","Joey","Jose"],Adam:["Addy"],Nathan:["Nate","Nat"],Henry:["Hank","Harry"],Douglas:["Doug","Dough"],Zachary:["Zach"," Zak"],Peter:["Pete","Peter"],Kyle:["Ky"],Noah:["Noa"],Ethan:["Eth"],Jeremy:["Jer","Remy"],Walter:["Walt","Wally"],Christian:["Chris","Christ"],Keith:["Kei"],Roger:["Roge","Rog"],Terry:["Ter","Terr"],Austin:["Aus"],Sean:["Shawn","John","Sean"],Gerald:["Gerry","Geral","Jerry"],Carl:["Karl","Chuck"],Dylan:["Dill"],Arthur:["Art","Artie"],Lawrence:["Larry","Laur"],Jordan:["Jord","Jay"],Jesse:["Jess","Jesse"],Bryan:["Bryant","Bry"],Billy:["Bill","William"],Bruce:["Bru"],Gabriel:["Gabe","Gabby"],Joe:["Joseph","Joey"],Logan:["Log"],Albert:["Al","Bert"],Willie:["Bill","William","Will"],Alan:["Al","Allen"],Norman:["Norm"],Harold:["Hal","Harry"],Martha:["Marty"],Gloria:["Glo"],Annie:["Ann"],Olivia:["Livy"]},n={Johann:["Johannes","Hans","Jan"],Johannes:["Johann","Hans","Jan"],Hans:["Johann","Johannes","Jan","Gian"],Jan:["Johannes","Hans","Johan"],Johan:["Johannes","Jan","John"],Jean:["John","Jean","Johannes"],Pierre:["Peter","Pier"],Gian:["John","Gianni","Jean"],Gianni:["John","Gian","Jean"],Ivan:["John","Ian"],Ian:["John","Ivan"],Willem:["William","Willy","Bill"],Guillaume:["William","Bill"],Guillermo:["William","Bill"],Guglielmo:["William","Bill"],Wilhelm:["William","Bill"],Franz:["Francis","Frank"],Francis:["Franz","Frank","Francesco"],Francesco:["Francis","Frank"],Andres:["Andrew","Andreas"],Andreas:["Andrew","Andres"],Andrea:["Andrew","Andreas"],Andre:["Andrew","Andreas"],Andrei:["Andrew","Andreas"],Kurt:["Conrad","Kurt"],Conrad:["Kurt","Con"],Lukas:["Lucas","Luke"],Lucas:["Luke","Lukas"],Luca:["Luke","Lucas"],Klaus:["Nicolas","Claus"],Nicolas:["Nick","Nicolas","Klaus"],Nikolaus:["Nick","Nicolas","Klaus"],Boris:["Bill","Boris"],Aleksander:["Alex","Sasha"],Aleksandr:["Alex","Sasha"],Sasha:["Alexander","Alex"],Michele:["Michael","Michel","Mick"],Michel:["Michael","Michele","Mick"],Mikhail:["Michael","Mick"]};e.exports&&(e.exports={NAME_PREFIXES:t,NAME_SUFFIXES:r,COMMON_GIVEN_NAME_EQUIVALENTS:u,EUROPEAN_NAME_EQUIVALENTS:n}),"undefined"!=typeof window&&(window.NameConstants={NAME_PREFIXES:t,NAME_SUFFIXES:r,COMMON_GIVEN_NAME_EQUIVALENTS:u,EUROPEAN_NAME_EQUIVALENTS:n})},273:e=>{function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t(e)}function r(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,u(n.key),n)}}function u(e){var r=function(e){if("object"!=t(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var u=r.call(e,"string");if("object"!=t(u))return u;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==t(r)?r:r+""}var n=function(){return e=function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.container=t,this.estimatedHeight=r.estimatedHeight||80,this.buffer=r.buffer||10,this.useWindowScroll=r.useWindowScroll||!1,this.items=[],this.positions=[],this.measuredHeights=new Map,this.itemToVirtualIndex=new Map,this.virtualToItem=[],this.scrollTop=0,this.totalHeight=0,this.renderFn=null,this.onVisibleRangeChange=null,this.handleScroll=this.handleScroll.bind(this),this.handleResize=this.handleResize.bind(this),this.useWindowScroll?window.addEventListener("scroll",this.handleScroll,{passive:!0}):this.container.addEventListener("scroll",this.handleScroll,{passive:!0}),window.addEventListener("resize",this.handleResize,{passive:!0})},t=[{key:"setItems",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.items=e,this.renderFn=t,this.onVisibleRangeChange=r.onVisibleRangeChange,this.itemToVirtualIndex.clear(),this.virtualToItem=[];for(var u=0;u<e.length;u++)this.itemToVirtualIndex.set(u,u),this.virtualToItem.push(e[u]);this.positions=new Array(e.length+1);for(var n=0,a=0;a<e.length;a++)this.positions[a]=n,n+=this.estimatedHeight;this.positions[e.length]=n,this.totalHeight=n,this.render()}},{key:"getVirtualIndex",value:function(e){var t;return null!==(t=this.itemToVirtualIndex.get(e))&&void 0!==t?t:-1}},{key:"getItemAt",value:function(e){return this.virtualToItem[e]}},{key:"scrollToIndex",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=this.getVirtualIndex(e);if(-1!==r){var u=t.align||"auto",n=this.positions[r],a=this.getViewportHeight();if("start"===u||t.scrollToTop)this.setScrollTop(n);else if("center"===u)this.setScrollTop(n-a/2);else if("end"===u)this.setScrollTop(n-a+this.getItemHeight(r));else{var i=this.getScrollTop(),o=i+a,s=n,l=s+this.getItemHeight(r);s<i?this.setScrollTop(s):l>o&&this.setScrollTop(l-a)}}}},{key:"getScrollTop",value:function(){return this.scrollTop}},{key:"setScrollTop",value:function(e){this.scrollTop=Math.max(0,Math.min(e,this.totalHeight-this.getViewportHeight())),this.useWindowScroll?window.scrollTo(0,this.scrollTop):this.container.scrollTop=this.scrollTop,this.render()}},{key:"getViewportHeight",value:function(){return this.useWindowScroll?window.innerHeight:this.container.clientHeight}},{key:"getItemHeight",value:function(e){var t;return null!==(t=this.measuredHeights.get(e))&&void 0!==t?t:this.estimatedHeight}},{key:"getTotalHeight",value:function(){return this.totalHeight}},{key:"handleScroll",value:function(){this.scrollTop=this.useWindowScroll?window.scrollY:this.container.scrollTop,this.render()}},{key:"handleResize",value:function(){this.refresh()}},{key:"refresh",value:function(){this.measuredHeights.clear(),this.recalculatePositions(),this.render()}},{key:"recalculatePositions",value:function(){for(var e=0,t=0;t<this.items.length;t++)this.positions[t]=e,e+=this.getItemHeight(t);this.positions[this.items.length]=e,this.totalHeight=e}},{key:"findIndexNear",value:function(e){if(0===this.items.length)return 0;for(var t=0,r=this.positions.length-1;t<=r;){var u=Math.floor((t+r)/2);this.positions[u]<=e?t=u+1:r=u-1}return Math.max(0,Math.min(r,this.items.length-1))}},{key:"render",value:function(){if(0===this.items.length)return this.container.innerHTML="",this.container.style.height="0px",void(this.onVisibleRangeChange&&this.onVisibleRangeChange(0,0));var e=this.scrollTop,t=e+this.getViewportHeight(),r=this.findIndexNear(e),u=this.findIndexNear(t),n=Math.max(0,r-this.buffer),a=Math.min(this.items.length,u+this.buffer+1);this.container.style.height=this.totalHeight+"px";var i=this.container.querySelector(".vs-content");i||((i=document.createElement("div")).className="vs-content",this.container.appendChild(i)),i.innerHTML="";for(var o=n;o<a;o++){var s=this.renderFn(this.items[o],o,o);s.style.position="absolute",s.style.top=this.positions[o]+"px",s.style.width="100%",s.dataset.virtualIndex=o,i.appendChild(s)}this.measureVisibleHeights(n,a),this.onVisibleRangeChange&&this.onVisibleRangeChange(n,a-1)}},{key:"measureVisibleHeights",value:function(e,t){var r=this.container.querySelector(".vs-content");if(r)for(var u=r.children,n=0;n<u.length;n++){var a=parseInt(u[n].dataset.virtualIndex,10);if(!isNaN(a)){var i=u[n].getBoundingClientRect().height||this.estimatedHeight;this.measuredHeights.set(a,i)}}}},{key:"getStats",value:function(){return{totalItems:this.items.length,totalHeight:this.totalHeight,measuredCount:this.measuredHeights.size,bufferSize:this.buffer,estimatedHeight:this.estimatedHeight}}},{key:"destroy",value:function(){this.useWindowScroll?window.removeEventListener("scroll",this.handleScroll):this.container.removeEventListener("scroll",this.handleScroll),window.removeEventListener("resize",this.handleResize),this.items=[],this.positions=[],this.measuredHeights.clear(),this.itemToVirtualIndex.clear(),this.virtualToItem=[],this.renderFn=null,this.onVisibleRangeChange=null}}],t&&r(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();e.exports&&(e.exports={DynamicVirtualScroll:n}),"undefined"!=typeof window&&(window.DynamicVirtualScroll=n)},315:e=>{function t(e,t){if(e===t)return 0;if(0===e.length)return t.length;if(0===t.length)return e.length;for(var r=[],u=0;u<=t.length;u++)r[u]=[u];for(var n=0;n<=e.length;n++)r[0][n]=n;for(var a=1;a<=t.length;a++)for(var i=1;i<=e.length;i++)t.charAt(a-1)===e.charAt(i-1)?r[a][i]=r[a-1][i-1]:r[a][i]=Math.min(r[a-1][i-1]+1,r[a][i-1]+1,r[a-1][i]+1);return r[t.length][e.length]}function r(e,r){var u=e.length,n=r.length;return 0===u&&0===n?1:0===u||0===n?0:1-t(e,r)/Math.max(u,n)}e.exports&&(e.exports={levenshteinDistance:t,normalizedLevenshtein:r}),"undefined"!=typeof window&&(window.StringDistance={levenshteinDistance:t,normalizedLevenshtein:r})},441:e=>{function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t(e)}function r(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,u(n.key),n)}}function u(e){var r=function(e){if("object"!=t(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var u=r.call(e,"string");if("object"!=t(u))return u;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==t(r)?r:r+""}var n=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.variationPatterns=[this.fullForm,this.initialForm,this.lastOnlyForm,this.firstInitialLastForm,this.firstInitialsLastForm]},(t=[{key:"generateVariants",value:function(e){var t=this,r=new Set;return this.variationPatterns.forEach(function(u){var n=u.call(t,e);n&&r.add(n)}),r.add(e.original),Array.from(r)}},{key:"fullForm",value:function(e){var t=[];return e.firstName&&t.push(e.firstName),e.middleName&&t.push(e.middleName),e.prefix&&t.push(e.prefix),e.lastName&&t.push(e.lastName),t.join(" ").trim()}},{key:"initialForm",value:function(e){if(!e.firstName||!e.lastName)return null;var t=e.firstName.charAt(0).toUpperCase()+".",r="";e.middleName&&(r=e.middleName.split(/\s+/).map(function(e){return e.charAt(0).toUpperCase()+"."}).join(" "));var u=[];return u.push(t),r&&u.push(r),e.prefix&&u.push(e.prefix),u.push(e.lastName),u.join(" ").trim()}},{key:"lastOnlyForm",value:function(e){return e.lastName?e.lastName.trim():null}},{key:"firstInitialLastForm",value:function(e){if(!e.firstName||!e.lastName)return null;var t=e.firstName.charAt(0).toUpperCase()+".",r=[];return r.push(t),e.prefix&&r.push(e.prefix),r.push(e.lastName),r.join(" ").trim()}},{key:"firstInitialsLastForm",value:function(e){if(!e.firstName||!e.lastName)return null;var t=e.firstName.charAt(0).toUpperCase()+".",r="";e.middleName&&(r=e.middleName.split(/\s+/).map(function(e){return e.charAt(0).toUpperCase()+"."}).join(""));var u=[];return u.push(t+r),e.prefix&&u.push(e.prefix),u.push(e.lastName),u.join(" ").trim().replace(/\.{2,}/g,".")}},{key:"generateCanonical",value:function(e){var t=[];return e.lastName&&t.push(e.lastName.toUpperCase()),e.firstName&&t.push(e.firstName.toUpperCase()),e.middleName&&e.middleName.split(/\s+/).forEach(function(e){return t.push(e.toUpperCase())}),t.join(" ").trim()}}])&&r(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();e.exports&&(e.exports=n)},491:(e,t,r)=>{function u(e){return u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},u(e)}function n(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(e);t&&(u=u.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,u)}return r}function a(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?n(Object(r),!0).forEach(function(t){i(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):n(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function i(e,t,r){return(t=h(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function o(){var e,t,r="function"==typeof Symbol?Symbol:{},u=r.iterator||"@@iterator",n=r.toStringTag||"@@toStringTag";function a(r,u,n,a){var o=u&&u.prototype instanceof l?u:l,D=Object.create(o.prototype);return s(D,"_invoke",function(r,u,n){var a,o,s,l=0,D=n||[],c=!1,f={p:0,n:0,v:e,a:p,f:p.bind(e,4),d:function(t,r){return a=t,o=0,s=e,f.n=r,i}};function p(r,u){for(o=r,s=u,t=0;!c&&l&&!n&&t<D.length;t++){var n,a=D[t],p=f.p,h=a[2];r>3?(n=h===u)&&(s=a[(o=a[4])?5:(o=3,3)],a[4]=a[5]=e):a[0]<=p&&((n=r<2&&p<a[1])?(o=0,f.v=u,f.n=a[1]):p<h&&(n=r<3||a[0]>u||u>h)&&(a[4]=r,a[5]=u,f.n=h,o=0))}if(n||r>1)return i;throw c=!0,u}return function(n,D,h){if(l>1)throw TypeError("Generator is already running");for(c&&1===D&&p(D,h),o=D,s=h;(t=o<2?e:s)||!c;){a||(o?o<3?(o>1&&(f.n=-1),p(o,s)):f.n=s:f.v=s);try{if(l=2,a){if(o||(n="next"),t=a[n]){if(!(t=t.call(a,s)))throw TypeError("iterator result is not an object");if(!t.done)return t;s=t.value,o<2&&(o=0)}else 1===o&&(t=a.return)&&t.call(a),o<2&&(s=TypeError("The iterator does not provide a '"+n+"' method"),o=1);a=e}else if((t=(c=f.n<0)?s:r.call(u,f))!==i)break}catch(t){a=e,o=1,s=t}finally{l=1}}return{value:t,done:c}}}(r,n,a),!0),D}var i={};function l(){}function D(){}function c(){}t=Object.getPrototypeOf;var f=[][u]?t(t([][u]())):(s(t={},u,function(){return this}),t),p=c.prototype=l.prototype=Object.create(f);function h(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,c):(e.__proto__=c,s(e,n,"GeneratorFunction")),e.prototype=Object.create(p),e}return D.prototype=c,s(p,"constructor",c),s(c,"constructor",D),D.displayName="GeneratorFunction",s(c,n,"GeneratorFunction"),s(p),s(p,n,"Generator"),s(p,u,function(){return this}),s(p,"toString",function(){return"[object Generator]"}),(o=function(){return{w:a,m:h}})()}function s(e,t,r,u){var n=Object.defineProperty;try{n({},"",{})}catch(e){n=0}s=function(e,t,r,u){function a(t,r){s(e,t,function(e){return this._invoke(t,r,e)})}t?n?n(e,t,{value:r,enumerable:!u,configurable:!u,writable:!u}):e[t]=r:(a("next",0),a("throw",1),a("return",2))},s(e,t,r,u)}function l(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return D(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?D(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var u=0,n=function(){};return{s:n,n:function(){return u>=e.length?{done:!0}:{done:!1,value:e[u++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,o=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return i=e.done,e},e:function(e){o=!0,a=e},f:function(){try{i||null==r.return||r.return()}finally{if(o)throw a}}}}function D(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,u=Array(t);r<t;r++)u[r]=e[r];return u}function c(e,t,r,u,n,a,i){try{var o=e[a](i),s=o.value}catch(e){return void r(e)}o.done?t(s):Promise.resolve(s).then(u,n)}function f(e){return function(){var t=this,r=arguments;return new Promise(function(u,n){var a=e.apply(t,r);function i(e){c(a,u,n,i,o,"next",e)}function o(e){c(a,u,n,i,o,"throw",e)}i(void 0)})}}function p(e,t){for(var r=0;r<t.length;r++){var u=t[r];u.enumerable=u.enumerable||!1,u.configurable=!0,"value"in u&&(u.writable=!0),Object.defineProperty(e,h(u.key),u)}}function h(e){var t=function(e){if("object"!=u(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=u(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==u(t)?t:t+""}var m=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.learningEngine=new(r(95)),this.variantGenerator=new(r(441)),this.nameParser=new(r(889))},t=[{key:"showDialog",value:(i=f(o().m(function e(t){var r,u,n,a,i,s;return o().w(function(e){for(;;)switch(e.p=e.n){case 0:console.log("Showing normalization dialog for",t.length,"items"),r=[],u=l(t),e.p=1,u.s();case 2:if((n=u.n()).done){e.n=5;break}return a=n.value,e.n=3,this.processItem(a);case 3:i=e.v,r.push(i);case 4:e.n=2;break;case 5:e.n=7;break;case 6:e.p=6,s=e.v,u.e(s);case 7:return e.p=7,u.f(),e.f(7);case 8:return e.n=9,this.presentOptions(r);case 9:return e.a(2,e.v)}},e,this,[[1,6,7,8]])})),function(e){return i.apply(this,arguments)})},{key:"processItem",value:(n=f(o().m(function e(t){var r,u,n,i,s,D,c,f,p,h,m;return o().w(function(e){for(;;)switch(e.p=e.n){case 0:r=t.getCreators?t.getCreators():[],u=[],n=l(r),e.p=1,n.s();case 2:if((i=n.n()).done){e.n=5;break}if(!(s=i.value).firstName&&!s.lastName){e.n=4;break}if(D=this.buildRawName(s),!(c=this.learningEngine.getMapping(D))){e.n=3;break}return u.push({original:a({},s),normalized:c,type:s.creatorType,alreadyLearned:!0,status:"learned"}),e.a(3,4);case 3:f=this.learningEngine.findSimilar(D),p=this.nameParser.parse(D),h=this.variantGenerator.generateVariants(p),u.push({original:a({},s),rawName:D,variants:h,similars:f,type:s.creatorType,alreadyLearned:!1,parsed:p,status:"new"});case 4:e.n=2;break;case 5:e.n=7;break;case 6:e.p=6,m=e.v,n.e(m);case 7:return e.p=7,n.f(),e.f(7);case 8:return e.a(2,{itemID:t.id,title:t.getField?t.getField("title"):"Unknown Title",creators:u})}},e,this,[[1,6,7,8]])})),function(e){return n.apply(this,arguments)})},{key:"buildRawName",value:function(e){return"".concat(e.firstName||""," ").concat(e.lastName||"").trim()}},{key:"presentOptions",value:(u=f(o().m(function e(t){var r,u,n,a,i,s,D,c,f;return o().w(function(e){for(;;)if(0===e.n){console.log("Presenting options to user:"),r=[],u=l(t);try{for(u.s();!(n=u.n()).done;){a=n.value,i={itemID:a.itemID,title:a.title,creators:[]},s=l(a.creators);try{for(s.s();!(D=s.n()).done;)(c=D.value).alreadyLearned?i.creators.push({original:c.original,normalized:c.normalized,type:c.type,accepted:!0,source:"learned"}):(f=c.variants[0],i.creators.push({original:c.original,normalized:f,type:c.type,accepted:!0,source:"user_selected",selectedFrom:"variants"}))}catch(e){s.e(e)}finally{s.f()}r.push(i)}}catch(e){u.e(e)}finally{u.f()}return e.a(2,r)}},e)})),function(e){return u.apply(this,arguments)})},{key:"renderUIDemo",value:function(e){var t,r='<div class="ner-normalizer-dialog"><h2>Author Name Normalization</h2>',u=l(e);try{for(u.s();!(t=u.n()).done;){var n=t.value;r+='<div class="item-section" data-item-id="'.concat(n.itemID,'">'),r+="<h3>".concat(n.title,"</h3>");var a,i=l(n.creators);try{for(i.s();!(a=i.n()).done;){var o=a.value;if(r+='<div class="creator-section">',o.alreadyLearned)r+="<p><strong>Learned:</strong> ".concat(o.rawName,"  ").concat(o.normalized,"</p>");else{r+="<p><strong>Original:</strong> ".concat(o.rawName,"</p>"),r+='<div class="variants-section">',r+="<h4>Variant Suggestions:</h4><ul>";var s,D=l(o.variants);try{for(D.s();!(s=D.n()).done;){var c=s.value;r+='<li><label><input type="radio" name="selection-'.concat(o.rawName,'" value="').concat(c,'"> ').concat(c,"</label></li>")}}catch(e){D.e(e)}finally{D.f()}if(r+="</ul></div>",o.similars.length>0){r+='<div class="similar-section">',r+="<h4>Similar Previously Learned Names:</h4><ul>";var f,p=l(o.similars);try{for(p.s();!(f=p.n()).done;){var h=f.value;r+='<li><label><input type="radio" name="selection-'.concat(o.rawName,'" value="').concat(h.normalized,'"> ').concat(h.raw,"  ").concat(h.normalized," (confidence: ").concat((100*h.similarity).toFixed(1),"%)</label></li>")}}catch(e){p.e(e)}finally{p.f()}r+="</ul></div>"}}r+="</div>"}}catch(e){i.e(e)}finally{i.f()}r+="</div>"}}catch(e){u.e(e)}finally{u.f()}return r+='<div class="dialog-actions">',r+='<button id="accept-all-btn">Accept All</button>',(r+='<button id="cancel-btn">Cancel</button>')+"</div></div>"}}],t&&p(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,u,n,i}();e.exports&&(e.exports=m)},588:e=>{function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t(e)}function r(e){return function(e){if(Array.isArray(e))return u(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return u(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?u(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,u=Array(t);r<t;r++)u[r]=e[r];return u}function n(){var e,t,r="function"==typeof Symbol?Symbol:{},u=r.iterator||"@@iterator",i=r.toStringTag||"@@toStringTag";function o(r,u,n,i){var o=u&&u.prototype instanceof l?u:l,D=Object.create(o.prototype);return a(D,"_invoke",function(r,u,n){var a,i,o,l=0,D=n||[],c=!1,f={p:0,n:0,v:e,a:p,f:p.bind(e,4),d:function(t,r){return a=t,i=0,o=e,f.n=r,s}};function p(r,u){for(i=r,o=u,t=0;!c&&l&&!n&&t<D.length;t++){var n,a=D[t],p=f.p,h=a[2];r>3?(n=h===u)&&(o=a[(i=a[4])?5:(i=3,3)],a[4]=a[5]=e):a[0]<=p&&((n=r<2&&p<a[1])?(i=0,f.v=u,f.n=a[1]):p<h&&(n=r<3||a[0]>u||u>h)&&(a[4]=r,a[5]=u,f.n=h,i=0))}if(n||r>1)return s;throw c=!0,u}return function(n,D,h){if(l>1)throw TypeError("Generator is already running");for(c&&1===D&&p(D,h),i=D,o=h;(t=i<2?e:o)||!c;){a||(i?i<3?(i>1&&(f.n=-1),p(i,o)):f.n=o:f.v=o);try{if(l=2,a){if(i||(n="next"),t=a[n]){if(!(t=t.call(a,o)))throw TypeError("iterator result is not an object");if(!t.done)return t;o=t.value,i<2&&(i=0)}else 1===i&&(t=a.return)&&t.call(a),i<2&&(o=TypeError("The iterator does not provide a '"+n+"' method"),i=1);a=e}else if((t=(c=f.n<0)?o:r.call(u,f))!==s)break}catch(t){a=e,i=1,o=t}finally{l=1}}return{value:t,done:c}}}(r,n,i),!0),D}var s={};function l(){}function D(){}function c(){}t=Object.getPrototypeOf;var f=[][u]?t(t([][u]())):(a(t={},u,function(){return this}),t),p=c.prototype=l.prototype=Object.create(f);function h(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,c):(e.__proto__=c,a(e,i,"GeneratorFunction")),e.prototype=Object.create(p),e}return D.prototype=c,a(p,"constructor",c),a(c,"constructor",D),D.displayName="GeneratorFunction",a(c,i,"GeneratorFunction"),a(p),a(p,i,"Generator"),a(p,u,function(){return this}),a(p,"toString",function(){return"[object Generator]"}),(n=function(){return{w:o,m:h}})()}function a(e,t,r,u){var n=Object.defineProperty;try{n({},"",{})}catch(e){n=0}a=function(e,t,r,u){function i(t,r){a(e,t,function(e){return this._invoke(t,r,e)})}t?n?n(e,t,{value:r,enumerable:!u,configurable:!u,writable:!u}):e[t]=r:(i("next",0),i("throw",1),i("return",2))},a(e,t,r,u)}function i(e,t,r,u,n,a,i){try{var o=e[a](i),s=o.value}catch(e){return void r(e)}o.done?t(s):Promise.resolve(s).then(u,n)}function o(e){return function(){var t=this,r=arguments;return new Promise(function(u,n){var a=e.apply(t,r);function o(e){i(a,u,n,o,s,"next",e)}function s(e){i(a,u,n,o,s,"throw",e)}o(void 0)})}}function s(e,t){for(var r=0;r<t.length;r++){var u=t[r];u.enumerable=u.enumerable||!1,u.configurable=!0,"value"in u&&(u.writable=!0),Object.defineProperty(e,l(u.key),u)}}function l(e){var r=function(e){if("object"!=t(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var u=r.call(e,"string");if("object"!=t(u))return u;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==t(r)?r:r+""}var D=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.settingsKey="name_normalizer_settings",this.mappingsKey="name_normalizer_mappings"},t=[{key:"saveSettings",value:(D=o(n().m(function e(t){var r,u;return n().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,r=JSON.stringify(t),localStorage.setItem(this.settingsKey,r),e.a(2,!0);case 1:return e.p=1,u=e.v,console.error("Error saving settings:",u),e.a(2,!1)}},e,this,[[0,1]])})),function(e){return D.apply(this,arguments)})},{key:"loadSettings",value:(l=o(n().m(function e(){var t,r;return n().w(function(e){for(;;)switch(e.p=e.n){case 0:if(e.p=0,!(t=localStorage.getItem(this.settingsKey))){e.n=1;break}return e.a(2,JSON.parse(t));case 1:return e.a(2,this.getDefaultSettings());case 2:return e.p=2,r=e.v,console.error("Error loading settings:",r),e.a(2,this.getDefaultSettings())}},e,this,[[0,2]])})),function(){return l.apply(this,arguments)})},{key:"getDefaultSettings",value:function(){return{autoApplyLearned:!0,showSuggestionsThreshold:.8,enableSpanishSurnameDetection:!0}}},{key:"saveMappings",value:(i=o(n().m(function e(t){var u,a;return n().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,u=JSON.stringify(r(t.entries())),localStorage.setItem(this.mappingsKey,u),e.a(2,!0);case 1:return e.p=1,a=e.v,console.error("Error saving mappings:",a),e.a(2,!1)}},e,this,[[0,1]])})),function(e){return i.apply(this,arguments)})},{key:"loadMappings",value:(a=o(n().m(function e(){var t,r;return n().w(function(e){for(;;)switch(e.p=e.n){case 0:if(e.p=0,!(t=localStorage.getItem(this.mappingsKey))){e.n=1;break}return e.a(2,new Map(JSON.parse(t)));case 1:return e.a(2,new Map);case 2:return e.p=2,r=e.v,console.error("Error loading mappings:",r),e.a(2,new Map)}},e,this,[[0,2]])})),function(){return a.apply(this,arguments)})},{key:"clearAllData",value:(u=o(n().m(function e(){return n().w(function(e){for(;;)switch(e.n){case 0:localStorage.removeItem(this.settingsKey),localStorage.removeItem(this.mappingsKey);case 1:return e.a(2)}},e,this)})),function(){return u.apply(this,arguments)})}],t&&s(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,u,a,i,l,D}();e.exports&&(e.exports=D)},672:(e,t,r)=>{function u(e){return u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},u(e)}function n(){var e,t,r="function"==typeof Symbol?Symbol:{},u=r.iterator||"@@iterator",i=r.toStringTag||"@@toStringTag";function o(r,u,n,i){var o=u&&u.prototype instanceof l?u:l,D=Object.create(o.prototype);return a(D,"_invoke",function(r,u,n){var a,i,o,l=0,D=n||[],c=!1,f={p:0,n:0,v:e,a:p,f:p.bind(e,4),d:function(t,r){return a=t,i=0,o=e,f.n=r,s}};function p(r,u){for(i=r,o=u,t=0;!c&&l&&!n&&t<D.length;t++){var n,a=D[t],p=f.p,h=a[2];r>3?(n=h===u)&&(o=a[(i=a[4])?5:(i=3,3)],a[4]=a[5]=e):a[0]<=p&&((n=r<2&&p<a[1])?(i=0,f.v=u,f.n=a[1]):p<h&&(n=r<3||a[0]>u||u>h)&&(a[4]=r,a[5]=u,f.n=h,i=0))}if(n||r>1)return s;throw c=!0,u}return function(n,D,h){if(l>1)throw TypeError("Generator is already running");for(c&&1===D&&p(D,h),i=D,o=h;(t=i<2?e:o)||!c;){a||(i?i<3?(i>1&&(f.n=-1),p(i,o)):f.n=o:f.v=o);try{if(l=2,a){if(i||(n="next"),t=a[n]){if(!(t=t.call(a,o)))throw TypeError("iterator result is not an object");if(!t.done)return t;o=t.value,i<2&&(i=0)}else 1===i&&(t=a.return)&&t.call(a),i<2&&(o=TypeError("The iterator does not provide a '"+n+"' method"),i=1);a=e}else if((t=(c=f.n<0)?o:r.call(u,f))!==s)break}catch(t){a=e,i=1,o=t}finally{l=1}}return{value:t,done:c}}}(r,n,i),!0),D}var s={};function l(){}function D(){}function c(){}t=Object.getPrototypeOf;var f=[][u]?t(t([][u]())):(a(t={},u,function(){return this}),t),p=c.prototype=l.prototype=Object.create(f);function h(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,c):(e.__proto__=c,a(e,i,"GeneratorFunction")),e.prototype=Object.create(p),e}return D.prototype=c,a(p,"constructor",c),a(c,"constructor",D),D.displayName="GeneratorFunction",a(c,i,"GeneratorFunction"),a(p),a(p,i,"Generator"),a(p,u,function(){return this}),a(p,"toString",function(){return"[object Generator]"}),(n=function(){return{w:o,m:h}})()}function a(e,t,r,u){var n=Object.defineProperty;try{n({},"",{})}catch(e){n=0}a=function(e,t,r,u){function i(t,r){a(e,t,function(e){return this._invoke(t,r,e)})}t?n?n(e,t,{value:r,enumerable:!u,configurable:!u,writable:!u}):e[t]=r:(i("next",0),i("throw",1),i("return",2))},a(e,t,r,u)}function i(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return o(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?o(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var u=0,n=function(){};return{s:n,n:function(){return u>=e.length?{done:!0}:{done:!1,value:e[u++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return i=e.done,e},e:function(e){s=!0,a=e},f:function(){try{i||null==r.return||r.return()}finally{if(s)throw a}}}}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,u=Array(t);r<t;r++)u[r]=e[r];return u}function s(e,t,r,u,n,a,i){try{var o=e[a](i),s=o.value}catch(e){return void r(e)}o.done?t(s):Promise.resolve(s).then(u,n)}function l(e){return function(){var t=this,r=arguments;return new Promise(function(u,n){var a=e.apply(t,r);function i(e){s(a,u,n,i,o,"next",e)}function o(e){s(a,u,n,i,o,"throw",e)}i(void 0)})}}function D(e,t){for(var r=0;r<t.length;r++){var u=t[r];u.enumerable=u.enumerable||!1,u.configurable=!0,"value"in u&&(u.writable=!0),Object.defineProperty(e,c(u.key),u)}}function c(e){var t=function(e){if("object"!=u(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=u(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==u(t)?t:t+""}var f=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.learningEngine=new(r(95))},t=[{key:"processBatch",value:(a=l(n().m(function e(t){var r,u,a,o;return n().w(function(e){for(;;)switch(e.p=e.n){case 0:console.log("Processing ".concat(t.length," items in batch")),r=i(t),e.p=1,r.s();case 2:if((u=r.n()).done){e.n=4;break}return a=u.value,e.n=3,this.processItem(a);case 3:e.n=2;break;case 4:e.n=6;break;case 5:e.p=5,o=e.v,r.e(o);case 6:return e.p=6,r.f(),e.f(6);case 7:return e.a(2,{success:!0,processedCount:t.length})}},e,this,[[1,5,6,7]])})),function(e){return a.apply(this,arguments)})},{key:"processItem",value:(u=l(n().m(function e(t){var r,u,a,o,s,l;return n().w(function(e){for(;;)switch(e.n){case 0:r=t.getCreators?t.getCreators():[],u=i(r);try{for(u.s();!(a=u.n()).done;)((o=a.value).firstName||o.lastName)&&(s="".concat(o.firstName||""," ").concat(o.lastName||"").trim(),(l=this.learningEngine.getMapping(s))?console.log("Applying learned normalization: ".concat(s," -> ").concat(l)):console.log("Need to process: ".concat(s)))}catch(e){u.e(e)}finally{u.f()}case 1:return e.a(2)}},e,this)})),function(e){return u.apply(this,arguments)})}],t&&D(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,u,a}();e.exports&&(e.exports=f)},886:(e,t,r)=>{function u(e){return u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},u(e)}function n(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return a(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?a(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var u=0,n=function(){};return{s:n,n:function(){return u>=e.length?{done:!0}:{done:!1,value:e[u++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw i}}}}function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,u=Array(t);r<t;r++)u[r]=e[r];return u}function i(){var e,t,r="function"==typeof Symbol?Symbol:{},u=r.iterator||"@@iterator",n=r.toStringTag||"@@toStringTag";function a(r,u,n,a){var i=u&&u.prototype instanceof l?u:l,D=Object.create(i.prototype);return o(D,"_invoke",function(r,u,n){var a,i,o,l=0,D=n||[],c=!1,f={p:0,n:0,v:e,a:p,f:p.bind(e,4),d:function(t,r){return a=t,i=0,o=e,f.n=r,s}};function p(r,u){for(i=r,o=u,t=0;!c&&l&&!n&&t<D.length;t++){var n,a=D[t],p=f.p,h=a[2];r>3?(n=h===u)&&(o=a[(i=a[4])?5:(i=3,3)],a[4]=a[5]=e):a[0]<=p&&((n=r<2&&p<a[1])?(i=0,f.v=u,f.n=a[1]):p<h&&(n=r<3||a[0]>u||u>h)&&(a[4]=r,a[5]=u,f.n=h,i=0))}if(n||r>1)return s;throw c=!0,u}return function(n,D,h){if(l>1)throw TypeError("Generator is already running");for(c&&1===D&&p(D,h),i=D,o=h;(t=i<2?e:o)||!c;){a||(i?i<3?(i>1&&(f.n=-1),p(i,o)):f.n=o:f.v=o);try{if(l=2,a){if(i||(n="next"),t=a[n]){if(!(t=t.call(a,o)))throw TypeError("iterator result is not an object");if(!t.done)return t;o=t.value,i<2&&(i=0)}else 1===i&&(t=a.return)&&t.call(a),i<2&&(o=TypeError("The iterator does not provide a '"+n+"' method"),i=1);a=e}else if((t=(c=f.n<0)?o:r.call(u,f))!==s)break}catch(t){a=e,i=1,o=t}finally{l=1}}return{value:t,done:c}}}(r,n,a),!0),D}var s={};function l(){}function D(){}function c(){}t=Object.getPrototypeOf;var f=[][u]?t(t([][u]())):(o(t={},u,function(){return this}),t),p=c.prototype=l.prototype=Object.create(f);function h(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,c):(e.__proto__=c,o(e,n,"GeneratorFunction")),e.prototype=Object.create(p),e}return D.prototype=c,o(p,"constructor",c),o(c,"constructor",D),D.displayName="GeneratorFunction",o(c,n,"GeneratorFunction"),o(p),o(p,n,"Generator"),o(p,u,function(){return this}),o(p,"toString",function(){return"[object Generator]"}),(i=function(){return{w:a,m:h}})()}function o(e,t,r,u){var n=Object.defineProperty;try{n({},"",{})}catch(e){n=0}o=function(e,t,r,u){function a(t,r){o(e,t,function(e){return this._invoke(t,r,e)})}t?n?n(e,t,{value:r,enumerable:!u,configurable:!u,writable:!u}):e[t]=r:(a("next",0),a("throw",1),a("return",2))},o(e,t,r,u)}function s(e,t,r,u,n,a,i){try{var o=e[a](i),s=o.value}catch(e){return void r(e)}o.done?t(s):Promise.resolve(s).then(u,n)}function l(e){return function(){var t=this,r=arguments;return new Promise(function(u,n){var a=e.apply(t,r);function i(e){s(a,u,n,i,o,"next",e)}function o(e){s(a,u,n,i,o,"throw",e)}i(void 0)})}}function D(e,t){for(var r=0;r<t.length;r++){var u=t[r];u.enumerable=u.enumerable||!1,u.configurable=!0,"value"in u&&(u.writable=!0),Object.defineProperty(e,c(u.key),u)}}function c(e){var t=function(e){if("object"!=u(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=u(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==u(t)?t:t+""}var f=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.itemProcessor=new(r(48)),this.zoteroDBAnalyzer=new(r(887))},t=[{key:"initialize",value:(c=l(i().m(function e(){return i().w(function(e){for(;;)switch(e.n){case 0:console.log("Initializing menu integration"),this.registerMenuItems();case 1:return e.a(2)}},e,this)})),function(){return c.apply(this,arguments)})},{key:"registerMenuItems",value:function(){console.log("Registered menu items for name normalization")}},{key:"handleNormalizeAction",value:(s=l(i().m(function e(t){var u,a,o,s,l,D,c,f,p,h,m,y;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:e.p=0,console.log("Handling normalize action for ".concat(t.length," items")),u=[],a=n(t),e.p=1,a.s();case 2:if((o=a.n()).done){e.n=5;break}return s=o.value,e.n=3,this.itemProcessor.processItemCreators(s);case 3:l=e.v,u.push({item:s,results:l});case 4:e.n=2;break;case 5:e.n=7;break;case 6:e.p=6,m=e.v,a.e(m);case 7:return e.p=7,a.f(),e.f(7);case 8:return D=new(r(491)),e.n=9,D.showDialog(t);case 9:c=e.v,f=0;case 10:if(!(f<t.length)){e.n=12;break}return p=t[f],h=c[f],e.n=11,this.itemProcessor.applyNormalizations(p,h.creators);case 11:f++,e.n=10;break;case 12:return e.a(2,{success:!0,processed:t.length});case 13:throw e.p=13,y=e.v,Zotero.debug("MenuIntegration: Error in handleNormalizeAction: ".concat(y.message)),y;case 14:return e.a(2)}},e,this,[[1,6,7,8],[0,13]])})),function(e){return s.apply(this,arguments)})},{key:"performFullLibraryAnalysis",value:(o=l(i().m(function e(){var t,r;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:if("undefined"!=typeof Zotero){e.n=1;break}throw new Error("This feature requires Zotero context");case 1:return console.log("Starting full library analysis for name variants..."),e.p=2,e.n=3,this.zoteroDBAnalyzer.analyzeFullLibrary();case 3:return t=e.v,console.log("Analysis complete: Found ".concat(t.totalVariantGroups," potential variant groups")),e.a(2,t);case 4:throw e.p=4,r=e.v,console.error("Error in full library analysis:",r),r;case 5:return e.a(2)}},e,this,[[2,4]])})),function(){return o.apply(this,arguments)})},{key:"handleFullLibraryAnalysis",value:(a=l(i().m(function e(){var t,r;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,this.performFullLibraryAnalysis();case 1:return t=e.v,console.log("Full library analysis results:",{totalUniqueSurnames:t.totalUniqueSurnames,totalVariantGroups:t.totalVariantGroups,topSuggestions:t.suggestions.slice(0,10)}),e.a(2,t);case 2:throw e.p=2,r=e.v,console.error("Error handling full library analysis:",r),r;case 3:return e.a(2)}},e,this,[[0,2]])})),function(){return a.apply(this,arguments)})},{key:"applyNormalizationSuggestions",value:(u=l(i().m(function e(t){var r,u,n,a,o=arguments;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:if(r=o.length>1&&void 0!==o[1]&&o[1],u=o.length>2&&void 0!==o[2]?o[2]:{},"undefined"!=typeof Zotero){e.n=1;break}throw new Error("This feature requires Zotero context");case 1:return console.log("Applying normalization suggestions for "+t.length+" items"),e.p=2,e.n=3,this.zoteroDBAnalyzer.applyNormalizationSuggestions(t,r,u);case 3:return n=e.v,console.log("Normalization application complete:",n),e.a(2,n);case 4:throw e.p=4,a=e.v,console.error("Error applying normalization suggestions:",a),a;case 5:return e.a(2)}},e,this,[[2,4]])})),function(e){return u.apply(this,arguments)})}],t&&D(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,u,a,o,s,c}();e.exports&&(e.exports=f)},887:(e,t,r)=>{function u(e){return u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},u(e)}function n(e){if(null!=e){var t=e["function"==typeof Symbol&&Symbol.iterator||"@@iterator"],r=0;if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length))return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}}throw new TypeError(u(e)+" is not iterable")}function a(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(e);t&&(u=u.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,u)}return r}function i(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?a(Object(r),!0).forEach(function(t){o(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function o(e,t,r){return(t=v(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function s(e){return function(e){if(Array.isArray(e))return h(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||p(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function l(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var u,n,a,i,o=[],s=!0,l=!1;try{if(a=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;s=!1}else for(;!(s=(u=a.call(r)).done)&&(o.push(u.value),o.length!==t);s=!0);}catch(e){l=!0,n=e}finally{try{if(!s&&null!=r.return&&(i=r.return(),Object(i)!==i))return}finally{if(l)throw n}}return o}}(e,t)||p(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function D(){var e,t,r="function"==typeof Symbol?Symbol:{},u=r.iterator||"@@iterator",n=r.toStringTag||"@@toStringTag";function a(r,u,n,a){var s=u&&u.prototype instanceof o?u:o,l=Object.create(s.prototype);return c(l,"_invoke",function(r,u,n){var a,o,s,l=0,D=n||[],c=!1,f={p:0,n:0,v:e,a:p,f:p.bind(e,4),d:function(t,r){return a=t,o=0,s=e,f.n=r,i}};function p(r,u){for(o=r,s=u,t=0;!c&&l&&!n&&t<D.length;t++){var n,a=D[t],p=f.p,h=a[2];r>3?(n=h===u)&&(s=a[(o=a[4])?5:(o=3,3)],a[4]=a[5]=e):a[0]<=p&&((n=r<2&&p<a[1])?(o=0,f.v=u,f.n=a[1]):p<h&&(n=r<3||a[0]>u||u>h)&&(a[4]=r,a[5]=u,f.n=h,o=0))}if(n||r>1)return i;throw c=!0,u}return function(n,D,h){if(l>1)throw TypeError("Generator is already running");for(c&&1===D&&p(D,h),o=D,s=h;(t=o<2?e:s)||!c;){a||(o?o<3?(o>1&&(f.n=-1),p(o,s)):f.n=s:f.v=s);try{if(l=2,a){if(o||(n="next"),t=a[n]){if(!(t=t.call(a,s)))throw TypeError("iterator result is not an object");if(!t.done)return t;s=t.value,o<2&&(o=0)}else 1===o&&(t=a.return)&&t.call(a),o<2&&(s=TypeError("The iterator does not provide a '"+n+"' method"),o=1);a=e}else if((t=(c=f.n<0)?s:r.call(u,f))!==i)break}catch(t){a=e,o=1,s=t}finally{l=1}}return{value:t,done:c}}}(r,n,a),!0),l}var i={};function o(){}function s(){}function l(){}t=Object.getPrototypeOf;var f=[][u]?t(t([][u]())):(c(t={},u,function(){return this}),t),p=l.prototype=o.prototype=Object.create(f);function h(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,l):(e.__proto__=l,c(e,n,"GeneratorFunction")),e.prototype=Object.create(p),e}return s.prototype=l,c(p,"constructor",l),c(l,"constructor",s),s.displayName="GeneratorFunction",c(l,n,"GeneratorFunction"),c(p),c(p,n,"Generator"),c(p,u,function(){return this}),c(p,"toString",function(){return"[object Generator]"}),(D=function(){return{w:a,m:h}})()}function c(e,t,r,u){var n=Object.defineProperty;try{n({},"",{})}catch(e){n=0}c=function(e,t,r,u){function a(t,r){c(e,t,function(e){return this._invoke(t,r,e)})}t?n?n(e,t,{value:r,enumerable:!u,configurable:!u,writable:!u}):e[t]=r:(a("next",0),a("throw",1),a("return",2))},c(e,t,r,u)}function f(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=p(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var u=0,n=function(){};return{s:n,n:function(){return u>=e.length?{done:!0}:{done:!1,value:e[u++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,o=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return i=e.done,e},e:function(e){o=!0,a=e},f:function(){try{i||null==r.return||r.return()}finally{if(o)throw a}}}}function p(e,t){if(e){if("string"==typeof e)return h(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?h(e,t):void 0}}function h(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,u=Array(t);r<t;r++)u[r]=e[r];return u}function m(e,t,r,u,n,a,i){try{var o=e[a](i),s=o.value}catch(e){return void r(e)}o.done?t(s):Promise.resolve(s).then(u,n)}function y(e){return function(){var t=this,r=arguments;return new Promise(function(u,n){var a=e.apply(t,r);function i(e){m(a,u,n,i,o,"next",e)}function o(e){m(a,u,n,i,o,"throw",e)}i(void 0)})}}function F(e,t){for(var r=0;r<t.length;r++){var u=t[r];u.enumerable=u.enumerable||!1,u.configurable=!0,"value"in u&&(u.writable=!0),Object.defineProperty(e,v(u.key),u)}}function v(e){var t=function(e){if("object"!=u(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=u(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==u(t)?t:t+""}var d=r(258),g=(d.NAME_PREFIXES,d.NAME_SUFFIXES,d.COMMON_GIVEN_NAME_EQUIVALENTS,r(315).normalizedLevenshtein),A=Object.freeze({alex:"alexander",alexander:"alexander",alexandra:"alexandra",alexis:"alexander",ally:"allison",ann:"anne",anna:"anne",annie:"anne",anthony:"anthony",antonio:"antonio",beth:"elizabeth",betsy:"elizabeth",betty:"elizabeth",bill:"william",billy:"william",bob:"robert",bobby:"robert",charles:"charles",charlie:"charles",charlotte:"charlotte",chaz:"charles",che:"ernesto",chuck:"charles",cathy:"catherine",catherine:"catherine",cathie:"catherine",cathryn:"catherine",frank:"francis",francis:"francis",francisco:"francisco",fran:"francis",frederic:"frederick",frederick:"frederick",fred:"frederick",freddie:"frederick",freddy:"frederick",harold:"harold",harry:"harry",hal:"harold",hank:"henry",henry:"henry",jack:"john",jacob:"jacob",jake:"jacob",james:"james",jamie:"james",jen:"jennifer",jenn:"jennifer",jenny:"jennifer",jennifer:"jennifer",jesse:"jessica",jess:"jessica",jessica:"jessica",jim:"james",jimmy:"james",joe:"joseph",joey:"joseph",john:"john",jon:"jonathan",jonathan:"jonathan",jose:"jose",joseph:"joseph",joyce:"joyce",kate:"katherine",katherine:"katherine",kathy:"catherine",katy:"katherine",katie:"katherine",liz:"elizabeth",lizzie:"elizabeth",lou:"louis",louis:"louis",maggie:"margaret",margaret:"margaret",marie:"mary",mary:"mary",megan:"margaret",meg:"margaret",michael:"michael",mick:"michael",mickey:"michael",mike:"michael",manuel:"manuel",manu:"manuel",nancy:"anne",nick:"nicholas",nicholas:"nicholas",nico:"nicholas",paco:"francisco",patricia:"patricia",patty:"patricia",peggy:"margaret",pepe:"jose",rick:"richard",rich:"richard",richard:"richard",ricky:"richard",rob:"robert",robbie:"robert",robert:"robert",ron:"ronald",ronnie:"ronald",ronald:"ronald",rose:"rose",rosie:"rose",sasha:"alexander",sandy:"alexander",ted:"theodore",teddy:"theodore",theodore:"theodore",toni:"antonio",tonya:"antonia",will:"william",willie:"william",william:"william"}),C=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.candidateFinder=new(r(22)),this.learningEngine=new(r(95))},t=[{key:"analyzeFullLibrary",value:(C=y(D().m(function e(){var t,r,u,n,a,i,o,s,l,c,p,h,m,y,F,v,d,g,A,C,E,b,B,w,S,k,N,j,P,O=arguments;return D().w(function(e){for(;;)switch(e.p=e.n){case 0:if(t=O.length>0&&void 0!==O[0]?O[0]:null,r=O.length>1&&void 0!==O[1]?O[1]:null,Zotero.debug("ZoteroDBAnalyzer: analyzeFullLibrary started"),"undefined"!=typeof Zotero){e.n=1;break}throw Zotero.debug("ZoteroDBAnalyzer: Zotero undefined, throwing error"),new Error("This method must be run in the Zotero context");case 1:return console.log("Starting full library analysis..."),e.p=2,Zotero.debug("ZoteroDBAnalyzer: Creating search for libraryID: "+Zotero.Libraries.userLibraryID),(u=new Zotero.Search).addCondition("libraryID","is",Zotero.Libraries.userLibraryID),e.n=3,u.search();case 3:if(n=e.v,Zotero.debug("ZoteroDBAnalyzer: Search returned "+(n?n.length:0)+" item IDs"),console.log("Found ".concat(n.length," total items in library")),n&&0!==n.length){e.n=4;break}return console.log("No items found in library"),e.a(2,{surnameFrequencies:{},potentialVariants:[],suggestions:[],totalUniqueSurnames:0,totalVariantGroups:0});case 4:a=200,i={},o=[],s=0;case 5:if(!(s<n.length)){e.n=8;break}return l=n.slice(s,s+a),e.n=6,Zotero.Items.getAsync(l);case 6:c=e.v,p=f(c);try{for(p.s();!(h=p.n()).done;){m=h.value;try{if((y=m.getCreators?m.getCreators():[])&&Array.isArray(y)&&y.length>0){F=y.filter(function(e){return e&&(e.firstName||e.lastName)}),F.length>0&&o.push(m),v=f(y);try{for(v.s();!(d=v.n()).done;)g=d.value,this.addCreatorOccurrence(i,g,m)}catch(e){v.e(e)}finally{v.f()}}}catch(e){console.warn("Error processing item creators:",e)}}}catch(e){p.e(e)}finally{p.f()}t&&t({stage:"filtering_items",processed:s+l.length,total:n.length,percent:Math.round((s+l.length)/n.length*100)});case 7:s+=a,e.n=5;break;case 8:if(Zotero.debug("ZoteroDBAnalyzer: Filtering complete, items with creators: "+o.length),console.log("Found ".concat(o.length," items with valid creators")),0!==o.length){e.n=16;break}return console.log("WARNING: No items with valid creators found!"),console.log("This might indicate:"),console.log("1. Items exist but have no creators"),console.log("2. Creator data is malformed"),console.log("3. Search conditions are too restrictive"),console.log("Trying fallback search to verify database access..."),(A=new Zotero.Search).addCondition("libraryID","is",Zotero.Libraries.userLibraryID),A.addCondition("limit","is",10),e.p=9,e.n=10,A.search();case 10:if(!((C=e.v)&&C.length>0)){e.n=12;break}return e.n=11,Zotero.Items.getAsync(C);case 11:E=e.v,console.log("Fallback found ".concat(E.length," items")),b=f(E.slice(0,3));try{for(b.s();!(B=b.n()).done;){w=B.value;try{S=w.getCreators?w.getCreators():[],console.log('Item "'.concat(w.getField?w.getField("title"):"Unknown",'" has ').concat(S.length," creators:"),S)}catch(e){console.log("Error getting creators for item:",e)}}}catch(e){b.e(e)}finally{b.f()}e.n=13;break;case 12:console.log("Fallback search also found no items");case 13:e.n=15;break;case 14:e.p=14,j=e.v,console.error("Fallback search failed:",j);case 15:Zotero.debug("ZoteroDBAnalyzer: No items with creators found, fallback search initiated");case 16:return k=Object.values(i),Zotero.debug("ZoteroDBAnalyzer: Extracted "+k.length+" unique creators"),console.log("Found ".concat(k.length," unique creator combinations")),k.length>0?(Zotero.debug("ZoteroDBAnalyzer: Sample creators: "+JSON.stringify(k.slice(0,3))),console.log("Sample creators:",k.slice(0,5))):(Zotero.debug("ZoteroDBAnalyzer: WARNING - No creators extracted at all"),console.log("WARNING: No creators found! This indicates an issue with creator extraction.")),Zotero.debug("ZoteroDBAnalyzer: Starting analyzeCreators with "+k.length+" creators"),e.n=17,this.analyzeCreators(k,t,r);case 17:return N=e.v,Zotero.debug("ZoteroDBAnalyzer: analyzeCreators completed, suggestions count: "+(N.suggestions?N.suggestions.length:0)),console.log("Analysis complete: processed ".concat(k.length," unique creator entries")),e.a(2,N);case 18:if(e.p=18,P=e.v,console.error("Error in database analysis:",P),"Analysis cancelled"!==P.message){e.n=19;break}throw P;case 19:return e.a(2,{surnameFrequencies:{},potentialVariants:[],suggestions:[],totalUniqueSurnames:0,totalVariantGroups:0})}},e,this,[[9,14],[2,18]])})),function(){return C.apply(this,arguments)})},{key:"addCreatorOccurrence",value:function(e,t,r){if(t&&(t.firstName||t.lastName)){var u="".concat(t.firstName||"","|").concat(t.lastName||"","|").concat(t.fieldMode||0);if(!e[u]){var n=this.parseName("".concat(t.firstName||""," ").concat(t.lastName||"").trim()||t.lastName||"");e[u]={key:u,firstName:t.firstName||"",lastName:t.lastName||"",fieldMode:t.fieldMode||0,count:0,items:[],parsedName:n}}if(e[u].count=(e[u].count||0)+1,r){var a=this.buildItemSummary(r);a&&(e[u].items||[]).length<25&&e[u].items.push(a)}}}},{key:"buildItemSummary",value:function(e){if(!e)return null;try{var t="function"==typeof e.getField?e.getField.bind(e):null,r=t?t("title"):e.title||"",u=t?t("date"):e.date||"",n=this.extractYear(u),a="function"==typeof e.getCreators?(e.getCreators()||[]).length:void 0;return{id:e.id||null,key:e.key||null,title:r||"Untitled",date:u||"",year:n,itemType:e.itemType||(t?t("itemType"):""),creatorsCount:a}}catch(e){return console.warn("Unable to summarize item for creator mapping:",e),null}}},{key:"extractYear",value:function(e){if(!e||"string"!=typeof e)return"";var t=e.match(/(\d{4})/);return t?t[1]:""}},{key:"analyzeCreators",value:(d=y(D().m(function e(t){var r,u,n,a,i,o,s,l,c,p,h,m,y,F,v,d=arguments;return D().w(function(e){for(;;)if(0===e.n){r=d.length>1&&void 0!==d[1]?d[1]:null,u=d.length>2&&void 0!==d[2]?d[2]:null,Zotero.debug("ZoteroDBAnalyzer: analyzeCreators started with "+(t?t.length:0)+" creators"),n={},a={},i=f(t);try{for(i.s();!(o=i.n()).done;)s=o.value,l="".concat(s.firstName," ").concat(s.lastName).trim(),(c=this.parseName(l)).lastName&&(p=c.lastName.toLowerCase().trim(),n[p]=(n[p]||0)+(s.count||1),a[p]=this.mergeItemSummaries(a[p],s.items))}catch(e){i.e(e)}finally{i.f()}return h=Object.keys(n),Zotero.debug("ZoteroDBAnalyzer: Found "+h.length+" unique surnames"),console.log("Analyzing ".concat(h.length," unique surnames for variants...")),(m=this.findVariantsEfficiently(n,r,u)).sort(function(e,t){var r=e.variant1.frequency+e.variant2.frequency;return t.variant1.frequency+t.variant2.frequency-r}),y=this.groupCreatorsBySurnameForVariants(t),F=this.findGivenNameVariantGroups(y),v=this.generateNormalizationSuggestions(m,F,a),e.a(2,{surnameFrequencies:n,potentialVariants:m,suggestions:v,totalUniqueSurnames:h.length,totalVariantGroups:v.length,givenNameVariantGroups:F})}},e,this)})),function(e){return d.apply(this,arguments)})},{key:"findVariantsEfficiently",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,u=Object.keys(e),n=[],a=function(e){for(var t=new Set,r=0;r<e.length-1;r++)t.add(e.substring(r,r+2));return t},i=function(e){var t,r={},u=f(e);try{for(u.s();!(t=u.n()).done;){var n,i=t.value,o=f(a(i));try{for(o.s();!(n=o.n()).done;){var s=n.value;r[s]||(r[s]=[]),r[s].push(i)}}catch(e){o.e(e)}finally{o.f()}}}catch(e){u.e(e)}finally{u.f()}return r}(u),o=u.sort(function(t,r){return e[r]-e[t]}),s=new Set,l=0,D=0;D<o.length;D++){if(r&&r())throw new Error("Analysis cancelled");var c,p=o[D],h=a(p),m=new Set,y=f(h);try{for(y.s();!(c=y.n()).done;){var F=c.value;if(i[F]){var v,d=f(i[F]);try{for(d.s();!(v=d.n()).done;){var g=v.value;g!==p&&m.add(g)}}catch(e){d.e(e)}finally{d.f()}}}}catch(e){y.e(e)}finally{y.f()}var A,C=f(m);try{for(C.s();!(A=C.n()).done;){var E=A.value,b=p<E?"".concat(p,"|").concat(E):"".concat(E,"|").concat(p);if(!s.has(b)){s.add(b);var B=p.length,w=E.length;if(!(Math.abs(B-w)>2)){l++;var S=this.calculateStringSimilarity(p,E);S>=.8&&n.push({variant1:{name:p,frequency:e[p]},variant2:{name:E,frequency:e[E]},similarity:S,recommendedNormalization:e[p]>=e[E]?p:E}),t&&l%100==0&&t({stage:"analyzing_surnames",processed:l,total:null,percent:null})}}}}catch(e){C.e(e)}finally{C.f()}t&&D%10==0&&t({stage:"analyzing_surnames",processed:D,total:o.length,percent:Math.round(D/o.length*100)})}return Zotero.debug("ZoteroDBAnalyzer: Variant detection complete, compared "+l+" pairs, found "+n.length+" variants"),console.log("Compared ".concat(l," surname pairs, found ").concat(n.length," potential variants")),n}},{key:"groupCreatorsBySurnameForVariants",value:function(e){var t,r={},u=f(e);try{for(u.s();!(t=u.n()).done;){var n=t.value;if(n&&n.lastName){var a=(n.lastName||"").toLowerCase().trim();r[a]||(r[a]=[]),r[a].push(n)}}}catch(e){u.e(e)}finally{u.f()}return r}},{key:"parseGivenNameTokens",value:function(e){var t=(e||"").trim();if(!t)return[];var r,u=t.split(/[\s-]+/).filter(Boolean),n=[],a=f(u);try{for(a.s();!(r=a.n()).done;){var i=r.value,o=i.replace(/[^A-Za-z]/g,"");o&&(this.isLikelyInitialSequence(o,i)?o.toUpperCase().split("").forEach(function(e){n.push({type:"initial",value:e})}):1===o.length?n.push({type:"initial",value:o.toUpperCase()}):n.push({type:"word",value:this.toTitleCase(o)}))}}catch(e){a.e(e)}finally{a.f()}return n}},{key:"extractTokenSignature",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],r=new Set,u=new Set,n=!1,a=f(t);try{for(a.s();!(e=a.n()).done;){var i=e.value;if(i)if("word"===i.type){if(!n){n=!0;continue}u.add(i.value.toLowerCase())}else"initial"===i.type&&r.add(i.value.toUpperCase())}}catch(e){a.e(e)}finally{a.f()}return{initials:Array.from(r),extraWords:Array.from(u)}}},{key:"mergeTokenSignatures",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],r=new Set,u=new Set,n=f(t);try{for(n.s();!(e=n.n()).done;){var a=e.value;a&&((a.initials||[]).forEach(function(e){return r.add(e.toUpperCase())}),(a.extraWords||[]).forEach(function(e){return u.add(e.toLowerCase())}))}}catch(e){n.e(e)}finally{n.f()}return{initials:Array.from(r),extraWords:Array.from(u)}}},{key:"signaturesOverlap",value:function(e,t){if(!e||!t)return!1;var r,u=new Set((e.initials||[]).map(function(e){return e.toUpperCase()})),n=f(t.initials||[]);try{for(n.s();!(r=n.n()).done;){var a=r.value;if(u.has(a.toUpperCase()))return!0}}catch(e){n.e(e)}finally{n.f()}var i,o=new Set((e.extraWords||[]).map(function(e){return e.toLowerCase()})),s=f(t.extraWords||[]);try{for(s.s();!(i=s.n()).done;){var l=i.value;if(o.has(l.toLowerCase()))return!0}}catch(e){s.e(e)}finally{s.f()}return!1}},{key:"clusterVariantsBySignature",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(!e||e.length<=1)return[e.map(function(e,t){return t})];for(var t=function(t){var r,u=null===(r=e[t])||void 0===r?void 0:r.tokenSignature;return!(!u||!(u.initials&&u.initials.length||u.extraWords&&u.extraWords.length))},r=e.map(function(e,t){return t}),u=function(e){return r[e]!==e&&(r[e]=u(r[e])),r[e]},n=function(e,t){var n=u(e),a=u(t);n!==a&&(r[a]=n)},a=0;a<e.length;a++)if(t(a))for(var i=a+1;i<e.length;i++)t(i)&&this.signaturesOverlap(e[a].tokenSignature,e[i].tokenSignature)&&n(a,i);for(var o=new Map,s=[],l=0;l<e.length;l++)if(t(l)){var D=u(l);o.has(D)||o.set(D,[]),o.get(D).push(l)}else s.push(l);var c=Array.from(o.values());if(0===c.length)return[e.map(function(e,t){return t})];if(s.length>0){for(var f=c.map(function(t){return t.reduce(function(t,r){return t+(e[r].frequency||0)},0)}),p=0,h=f[0]||0,m=1;m<f.length;m++)f[m]>h&&(h=f[m],p=m);s.forEach(function(e){return c[p].push(e)})}return c}},{key:"isLikelyInitialSequence",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";if(!e)return!1;var r=e.toUpperCase();return!(r.length<2||r.length>4||/[^A-Z]/.test(r)||!/\./.test(t)&&/[AEIOUY]/.test(r))}},{key:"selectCanonicalGivenNameData",value:function(e,t){var r,u=t&&!t.startsWith("initial:")?this.toTitleCase(t):"",n=[],a=-1/0,i=f(e||[]);try{for(i.s();!(r=i.n()).done;){var o,s=r.value,l=((null===(o=s.parsedName)||void 0===o?void 0:o.firstName)||s.firstName||"").trim();if(l){var D=this.parseGivenNameTokens(l);if(0!==D.length){var c=D.some(function(e){return"word"===e.type}),p=(s.count||1)+D.length;c&&(p+=1e3),p>a&&(n=D,a=p)}}}}catch(e){i.e(e)}finally{i.f()}var h,m=n.find(function(e){return"word"===e.type}),y=m?m.value:u,F=[],v=[],d=!1,g=f(n);try{for(g.s();!(h=g.n()).done;){var A=h.value;if("word"===A.type){if(!(d||m&&A.value!==m.value)){d=!0;continue}F.includes(A.value)||F.push(A.value)}else if("initial"===A.type){var C=A.value.toUpperCase();v.includes(C)||v.push(C)}}}catch(e){g.e(e)}finally{g.f()}return{baseWord:y,extraWords:F,initials:v}}},{key:"composeGivenNameFromTokens",value:function(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},u=r.baseWord||"",n=r.extraWords||[],a=r.initials||[],i=Array.isArray(e)?e:[],o=i.filter(function(e){return e&&"word"===e.type}),s=i.filter(function(e){return e&&"initial"===e.type}),l=o.length>0,D=s.length>0,c=!l&&D,p="",h=[],m=[],y=f(i);try{for(y.s();!(t=y.n()).done;){var F=t.value;if("word"===F.type)p?h.includes(F.value)||h.push(F.value):p=F.value;else if("initial"===F.type){var v=F.value.toUpperCase();m.includes(v)||m.push(v)}}}catch(e){y.e(e)}finally{y.f()}!p&&u&&(p=u);var d=p?p.charAt(0).toUpperCase():"";!p&&m.length>0&&(p="".concat(m[0],"."),m.shift()),c&&n.forEach(function(e){e&&(h.includes(e)||e===p||h.push(e))});var g=[],A=new Set,C=function(e){if(e){var t=e.toUpperCase();t!==d||A.has(t)?A.has(t)||(g.push("".concat(t,".")),A.add(t)):A.add(t)}};m.forEach(function(e){return C(e)}),c&&a.forEach(function(e){return C(e)});var E=[];return p&&E.push(p),E.push.apply(E,h),E.push.apply(E,g),E.join(" ").replace(/\s+/g," ").trim()}},{key:"findGivenNameVariantGroups",value:function(e){for(var t=[],r=0,u=Object.entries(e);r<u.length;r++){var n=l(u[r],2),a=n[0],i=n[1];if(i&&!(i.length<2)){var o=this.findGivenNameVariantsForSurname(a,i);o.length>0&&t.push.apply(t,s(o))}}return t}},{key:"findGivenNameVariantsForSurname",value:function(e,t){var r,u=this,n=[],a=new Map,i=new Map,o=(e||"").trim(),s=o.toLowerCase(),D=this.toTitleCase(o),c=f(t);try{for(c.s();!(r=c.n()).done;){var p,h,m=r.value,y=[null===(p=m.parsedName)||void 0===p?void 0:p.firstName,null===(h=m.parsedName)||void 0===h?void 0:h.middleName].filter(function(e){return e&&"string"==typeof e&&e.trim().length>0}).join(" ").trim(),F=(m.firstName||"").trim(),v=y||F;if(v){var d=this.normalizeGivenName(v)||v.toLowerCase();a.has(d)||a.set(d,[]),a.get(d).push(m);var g="".concat(v,"|").concat(m.lastName);i.has(g)||i.set(g,m.items||[])}}}catch(e){c.e(e)}finally{c.f()}this.mergeInitialBuckets(a);var A,C=f(a.entries());try{var E=function(){var e=l(A.value,2),t=e[0],r=e[1];if(r.length<2)return 0;var a,c=u.selectCanonicalGivenNameData(r,t),p=new Map,h=f(r);try{for(h.s();!(a=h.n()).done;){var m,y,F,v=a.value,d=[null===(m=v.parsedName)||void 0===m?void 0:m.firstName,null===(y=v.parsedName)||void 0===y?void 0:y.middleName].filter(function(e){return e&&"string"==typeof e&&e.trim().length>0}).join(" ").trim()||(v.firstName||"").trim(),g=u.parseGivenNameTokens(d),C=u.extractTokenSignature(g),E=u.composeGivenNameFromTokens(g,c)||c.baseWord||d,b=((null===(F=v.parsedName)||void 0===F?void 0:F.lastName)||v.lastName||o).trim(),B=u.toTitleCase(b),w="".concat(E,"|").concat(B).toLowerCase(),S=p.get(w)||{firstName:E,lastName:B,frequency:0,items:[],name:"".concat(E," ").concat(B).trim(),tokenSignatures:[],creatorRefs:[]};S.frequency+=v.count||1,S.lastName=B,S.name="".concat(S.firstName," ").concat(B).trim(),S.tokenSignatures.push(C),S.creatorRefs.push({creator:v,tokens:g,signature:C});var k="".concat(d,"|").concat(v.lastName);i.has(k)&&(S.items=u.mergeItemSummaries(S.items,i.get(k))),p.set(w,S)}}catch(e){h.e(e)}finally{h.f()}if(p.size<2)return 0;var N,j=Array.from(p.values()).map(function(e){var t=u.toTitleCase(e.lastName||D),r=u.mergeTokenSignatures(e.tokenSignatures||[]);return Object.assign({},e,{lastName:t,name:"".concat(e.firstName," ").concat(t).trim(),tokenSignature:r,creatorRefs:(e.creatorRefs||[]).slice()})}),P=f(u.clusterVariantsBySignature(j));try{var O=function(){var e=N.value;if(!e||e.length<2)return 0;var r=e.map(function(e){return Object.assign({},j[e])}),a=[];if(r.forEach(function(e){(e.creatorRefs||[]).forEach(function(e){e&&e.creator&&a.push(e.creator)})}),0===a.length)return 0;var i=u.selectCanonicalGivenNameData(a,t),o=r.map(function(e){var t=Object.assign({},e);return delete t.tokenSignature,delete t.creatorRefs,t}),l=u.buildGivenNameRecommendation(o,D,i),c=o.reduce(function(e,t){return e+(t.frequency||0)},0);n.push({surname:D,surnameKey:s,normalizedKey:t,variants:o,totalFrequency:c,recommendedFirstName:l.firstName,recommendedFullName:l.fullName})};for(P.s();!(N=P.n()).done;)O()}catch(e){P.e(e)}finally{P.f()}};for(C.s();!(A=C.n()).done;)E()}catch(e){C.e(e)}finally{C.f()}return n}},{key:"normalizeGivenName",value:function(e){var t=e.trim();if(!t)return"";var r=t.split(/[\s-]+/).filter(Boolean),u=r.map(function(e){return e.replace(/\./g,"")});if(0===u.length)return"";var n=u[0].toLowerCase();return u.every(function(e){return 1===e.length})?"initial:".concat(u.join("")):1===u.length&&this.isLikelyInitialSequence(u[0],r[0])?"initial:".concat(u[0].toUpperCase()):A[n]?A[n]:n}},{key:"mergeItemSummaries",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(!t||0===t.length)return e;var r,u=new Map,n=f(e);try{for(n.s();!(r=n.n()).done;){var a=r.value;if(a){var i=a.key||a.id||JSON.stringify(a);if(u.has(i)||u.set(i,a),u.size>=25)break}}}catch(e){n.e(e)}finally{n.f()}var o,s=f(t);try{for(s.s();!(o=s.n()).done;){var l=o.value;if(l){var D=l.key||l.id||JSON.stringify(l);if(!u.has(D)&&u.size<25&&u.set(D,l),u.size>=25)break}}}catch(e){s.e(e)}finally{s.f()}return Array.from(u.values())}},{key:"mergeInitialBuckets",value:function(e){var t=Array.from(e.keys()).filter(function(e){return!e.startsWith("initial:")});if(0===t.length)return e;for(var r=function(){var r=l(n[u],2),a=r[0],i=r[1];if(!a.startsWith("initial:"))return 0;var o=a.replace("initial:","");if(!o)return 0;var s=o.charAt(0).toLowerCase(),D=t.find(function(e){return e.charAt(0).toLowerCase()===s});if(D){var c=e.get(D);i.forEach(function(e){return c.push(e)}),e.delete(a)}},u=0,n=Array.from(e.entries());u<n.length;u++)r();return e}},{key:"buildGivenNameRecommendation",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!e||0===e.length)return{firstName:"",fullName:t||""};var u,n=function(e,t){t&&(e.includes(t)||e.push(t))},a=r.baseWord?this.toTitleCase(r.baseWord):"",i=[],o=[],s=!1,l=f(e);try{for(l.s();!(u=l.n()).done;){var D=u.value,c=this.parseGivenNameTokens(D.firstName||""),p=c.some(function(e){return"word"===e.type}),h=c.some(function(e){return"initial"===e.type});p&&!h&&(s=!0);var m,y=!1,F=f(c);try{for(F.s();!(m=F.n()).done;){var v=m.value;"word"===v.type?y?n(i,v.value):(y=!0,a||(a=v.value)):"initial"===v.type&&n(o,v.value.toUpperCase())}}catch(e){F.e(e)}finally{F.f()}}}catch(e){l.e(e)}finally{l.f()}if((r.extraWords||[]).forEach(function(e){return n(i,e)}),s||(r.initials||[]).forEach(function(e){return n(o,e.toUpperCase())}),!a){var d=this.parseGivenNameTokens(e[0].firstName||""),g=d.find(function(e){return"word"===e.type});if(g)a=g.value;else{var A=d.find(function(e){return"initial"===e.type});if(A){var C=A.value.toUpperCase();a="".concat(C,".");var E=o.indexOf(C);-1!==E&&o.splice(E,1)}}}var b=a?a.charAt(0).toUpperCase():"";if(b){var B=o.indexOf(b);-1!==B&&o.splice(B,1)}s&&(o.length=0);var w=[];a&&w.push(a),w.push.apply(w,i),o.forEach(function(e){return w.push("".concat(e,"."))});var S=w.filter(Boolean).join(" ").replace(/\s+/g," ").trim(),k=this.toTitleCase(t||"");return{firstName:S,fullName:k?"".concat(S," ").concat(k).trim():S}}},{key:"scoreGivenNameVariant",value:function(e){var t;if(!e)return 0;var r=e.frequency||0,u=(e.firstName||"").trim();if(!u)return r;var n=u.replace(/\./g,"");/[a-z]{2,}/i.test(n)&&(r+=1e3),u.includes(".")||(r+=200);var a=(null===(t=n.split(/[\s-]+/)[0])||void 0===t?void 0:t.toLowerCase())||"";return A[a]&&(r+=50),r+Math.min(n.length,20)}},{key:"toTitleCase",value:function(e){return e?e.split(/\s+/).filter(Boolean).map(function(e){return e.toLowerCase().replace(/(^|['\x2D`])((?:[A-Za-z\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u05D0-\u05EA\u05EF-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u0870-\u0887\u0889-\u088F\u08A0-\u08C9\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C5C\u0C5D\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDC-\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D04-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16F1-\u16F8\u1700-\u1711\u171F-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1878\u1880-\u1884\u1887-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4C\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C8A\u1C90-\u1CBA\u1CBD-\u1CBF\u1CE9-\u1CEC\u1CEE-\u1CF3\u1CF5\u1CF6\u1CFA\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2183\u2184\u2C00-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005\u3006\u3031-\u3035\u303B\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u31BF\u31F0-\u31FF\u3400-\u4DBF\u4E00-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6E5\uA717-\uA71F\uA722-\uA788\uA78B-\uA7DC\uA7F1-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA8FE\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB69\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDE80-\uDE9C\uDEA0-\uDED0\uDF00-\uDF1F\uDF2D-\uDF40\uDF42-\uDF49\uDF50-\uDF75\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF]|\uD801[\uDC00-\uDC9D\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDD70-\uDD7A\uDD7C-\uDD8A\uDD8C-\uDD92\uDD94\uDD95\uDD97-\uDDA1\uDDA3-\uDDB1\uDDB3-\uDDB9\uDDBB\uDDBC\uDDC0-\uDDF3\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67\uDF80-\uDF85\uDF87-\uDFB0\uDFB2-\uDFBA]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD40-\uDD59\uDD80-\uDDB7\uDDBE\uDDBF\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE35\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE4\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2\uDD00-\uDD23\uDD4A-\uDD65\uDD6F-\uDD85\uDE80-\uDEA9\uDEB0\uDEB1\uDEC2-\uDEC7\uDF00-\uDF1C\uDF27\uDF30-\uDF45\uDF70-\uDF81\uDFB0-\uDFC4\uDFE0-\uDFF6]|\uD804[\uDC03-\uDC37\uDC71\uDC72\uDC75\uDC83-\uDCAF\uDCD0-\uDCE8\uDD03-\uDD26\uDD44\uDD47\uDD50-\uDD72\uDD76\uDD83-\uDDB2\uDDC1-\uDDC4\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE2B\uDE3F\uDE40\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEDE\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3D\uDF50\uDF5D-\uDF61\uDF80-\uDF89\uDF8B\uDF8E\uDF90-\uDFB5\uDFB7\uDFD1\uDFD3]|\uD805[\uDC00-\uDC34\uDC47-\uDC4A\uDC5F-\uDC61\uDC80-\uDCAF\uDCC4\uDCC5\uDCC7\uDD80-\uDDAE\uDDD8-\uDDDB\uDE00-\uDE2F\uDE44\uDE80-\uDEAA\uDEB8\uDF00-\uDF1A\uDF40-\uDF46]|\uD806[\uDC00-\uDC2B\uDCA0-\uDCDF\uDCFF-\uDD06\uDD09\uDD0C-\uDD13\uDD15\uDD16\uDD18-\uDD2F\uDD3F\uDD41\uDDA0-\uDDA7\uDDAA-\uDDD0\uDDE1\uDDE3\uDE00\uDE0B-\uDE32\uDE3A\uDE50\uDE5C-\uDE89\uDE9D\uDEB0-\uDEF8\uDFC0-\uDFE0]|\uD807[\uDC00-\uDC08\uDC0A-\uDC2E\uDC40\uDC72-\uDC8F\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD30\uDD46\uDD60-\uDD65\uDD67\uDD68\uDD6A-\uDD89\uDD98\uDDB0-\uDDDB\uDEE0-\uDEF2\uDF02\uDF04-\uDF10\uDF12-\uDF33\uDFB0]|\uD808[\uDC00-\uDF99]|\uD809[\uDC80-\uDD43]|\uD80B[\uDF90-\uDFF0]|[\uD80C\uD80E\uD80F\uD81C-\uD822\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2F\uDC41-\uDC46\uDC60-\uDFFF]|\uD810[\uDC00-\uDFFA]|\uD811[\uDC00-\uDE46]|\uD818[\uDD00-\uDD1D]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE70-\uDEBE\uDED0-\uDEED\uDF00-\uDF2F\uDF40-\uDF43\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDD40-\uDD6C\uDE40-\uDE7F\uDEA0-\uDEB8\uDEBB-\uDED3\uDF00-\uDF4A\uDF50\uDF93-\uDF9F\uDFE0\uDFE1\uDFE3\uDFF2\uDFF3]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82B[\uDFF0-\uDFF3\uDFF5-\uDFFB\uDFFD\uDFFE]|\uD82C[\uDC00-\uDD22\uDD32\uDD50-\uDD52\uDD55\uDD64-\uDD67\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB]|\uD837[\uDF00-\uDF1E\uDF25-\uDF2A]|\uD838[\uDC30-\uDC6D\uDD00-\uDD2C\uDD37-\uDD3D\uDD4E\uDE90-\uDEAD\uDEC0-\uDEEB]|\uD839[\uDCD0-\uDCEB\uDDD0-\uDDED\uDDF0\uDEC0-\uDEDE\uDEE0-\uDEE2\uDEE4\uDEE5\uDEE7-\uDEED\uDEF0-\uDEF4\uDEFE\uDEFF\uDFE0-\uDFE6\uDFE8-\uDFEB\uDFED\uDFEE\uDFF0-\uDFFE]|\uD83A[\uDC00-\uDCC4\uDD00-\uDD43\uDD4B]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79]))/g,function(e,t,r){return t+r.toUpperCase()})}).join(" "):""}},{key:"parseName",value:function(e){return(new(r(889))).parse(e)}},{key:"calculateStringSimilarity",value:function(e,t){return g(e,t)}},{key:"generateNormalizationSuggestions",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Zotero.debug("ZoteroDBAnalyzer: generateNormalizationSuggestions called with "+(e?e.length:0)+" surname variants and "+(r?r.length:0)+" given-name groups");var n,a=[],i=new Set,o=f(e||[]);try{for(o.s();!(n=o.n()).done;){var s=n.value,l=s.variant1.name,D=s.variant2.name;if(!i.has(l)&&!i.has(D)){var c={type:"surname",primary:s.recommendedNormalization,variants:[{name:s.variant1.name,frequency:s.variant1.frequency,items:u[s.variant1.name]||[]},{name:s.variant2.name,frequency:s.variant2.frequency,items:u[s.variant2.name]||[]}],similarity:s.similarity,surnameKey:(s.recommendedNormalization||"").toLowerCase()};if(this.enrichSuggestionWithGivenNameData(c,r),this.shouldSkipSuggestionFromLearning(c)){i.add(l),i.add(D);continue}a.push(c),i.add(l),i.add(D)}}}catch(e){o.e(e)}finally{o.f()}var p,h=f(r||[]);try{var m=function(){var e=p.value;if(!e||!e.surname||!Array.isArray(e.variants)||e.variants.length<2)return 0;var r=e.surnameKey||e.surname.toLowerCase(),u=a.find(function(t){return"given-name"===t.type&&(t.surnameKey||(t.surname||"").toLowerCase())===r&&t.normalizedGivenNameKey===e.normalizedKey}),n=e.variants.map(function(r){var u=t.toTitleCase(r.lastName||e.surname);return{name:"".concat(r.firstName," ").concat(u).trim(),firstName:r.firstName,lastName:u,frequency:r.frequency,items:r.items||[]}});if(u)u.variants=t.mergeVariantLists(u.variants,n),u.totalFrequency=(u.totalFrequency||0)+(e.totalFrequency||0),u.surname=e.surname,u.surnameKey=r,u.normalizedGivenNameKey=e.normalizedKey,!u.recommendedFullName&&e.recommendedFullName&&(u.recommendedFullName=e.recommendedFullName);else{var i,o={type:"given-name",surname:e.surname,surnameKey:r,normalizedGivenNameKey:e.normalizedKey,variants:n,totalFrequency:e.totalFrequency,recommendedFirstName:e.recommendedFirstName,recommendedFullName:e.recommendedFullName,primary:e.recommendedFullName||"".concat((null===(i=n[0])||void 0===i?void 0:i.name)||"")};if(t.shouldSkipSuggestionFromLearning(o))return 0;a.push(o)}};for(h.s();!(p=h.n()).done;)m()}catch(e){h.e(e)}finally{h.f()}return Zotero.debug("ZoteroDBAnalyzer: Generated "+a.length+" normalization suggestions (combined)"),a}},{key:"enrichSuggestionWithGivenNameData",value:function(e,t){if(!e||!t||0===t.length)return e;var r=(e.surnameKey||e.primary||"").toLowerCase();if(!r)return e;var u=t.find(function(e){return e&&(e.surnameKey||(e.surname||"").toLowerCase())===r});return u?(e.relatedGivenNameVariants=u.variants.map(function(e){return{firstName:e.firstName,frequency:e.frequency,items:e.items||[]}}),e.relatedGivenNameKey=u.normalizedKey,e.relatedGivenNameTotal=u.totalFrequency,e):e}},{key:"mergeVariantLists",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(!t||0===t.length)return e||[];var r,u=new Map,n=f(e||[]);try{for(n.s();!(r=n.n()).done;){var a=r.value;if(a){var o=a.name?a.name.toLowerCase():JSON.stringify(a);u.has(o)||u.set(o,i(i({},a),{},{items:a.items?s(a.items):[]}))}}}catch(e){n.e(e)}finally{n.f()}var l,D=f(t);try{for(D.s();!(l=D.n()).done;){var c=l.value;if(c){var p=c.name?c.name.toLowerCase():JSON.stringify(c);if(u.has(p)){var h=u.get(p);h.frequency=(h.frequency||0)+(c.frequency||0),h.items=this.mergeItemSummaries(h.items,c.items)}else u.set(p,i(i({},c),{},{items:c.items?s(c.items):[]}))}}}catch(e){D.e(e)}finally{D.f()}return Array.from(u.values()).sort(function(e,t){return(t.frequency||0)-(e.frequency||0)})}},{key:"getNormalizationForSurname",value:(v=y(D().m(function e(t){var r,u,n,a,i;return D().w(function(e){for(;;)switch(e.p=e.n){case 0:if("undefined"!=typeof Zotero){e.n=1;break}return e.a(2,null);case 1:return e.n=2,this.analyzeFullLibrary();case 2:r=e.v,u=f(r.potentialVariants),e.p=3,u.s();case 4:if((n=u.n()).done){e.n=6;break}if((a=n.value).variant1.name!==t&&a.variant2.name!==t){e.n=5;break}return e.a(2,{recommended:a.recommendedNormalization,alternatives:[a.variant1.name,a.variant2.name],similarity:a.similarity,frequencies:o(o({},a.variant1.name,a.variant1.frequency),a.variant2.name,a.variant2.frequency)});case 5:e.n=4;break;case 6:e.n=8;break;case 7:e.p=7,i=e.v,u.e(i);case 8:return e.p=8,u.f(),e.f(8);case 9:return e.a(2,null)}},e,this,[[3,7,8,9]])})),function(e){return v.apply(this,arguments)})},{key:"applyNormalizationSuggestions",value:(m=y(D().m(function e(t){var r,u,n,a,i,o,s,l,c,p,h,m,y,F,v,d,g,A,C,E,b=arguments;return D().w(function(e){for(;;)switch(e.p=e.n){case 0:if(r=b.length>1&&void 0!==b[1]&&b[1],u=b.length>2&&void 0!==b[2]?b[2]:{},"undefined"!=typeof Zotero){e.n=1;break}throw new Error("This method must be run in the Zotero context");case 1:if("undefined"!=typeof Zotero&&Zotero.Items&&"function"==typeof Zotero.Items.getAsync){e.n=2;break}throw new Error("Zotero Items API is not available");case 2:if(a=(n=u||{}).progressCallback,i=void 0===a?null:a,o=n.declinedSuggestions,s=void 0===o?[]:o,l=Array.isArray(t)?t:[],c={totalSuggestions:l.length,applied:0,skipped:0,errors:0,updatedCreators:0,declinedRecorded:0},0!==l.length){e.n=5;break}if(!(Array.isArray(s)&&s.length>0)){e.n=4;break}return v=c.declinedRecorded,e.n=3,this.recordDeclinedSuggestions(s);case 3:c.declinedRecorded=v+=e.v;case 4:return i&&i({stage:"complete",applied:c.applied,skipped:c.skipped,updatedCreators:c.updatedCreators,declined:c.declinedRecorded,total:c.totalSuggestions}),e.a(2,c);case 5:e.p=5,p=[],h=f(l),e.p=6,h.s();case 7:if((m=h.n()).done){e.n=13;break}if(y=m.value,e.p=8,d=r){e.n=10;break}return e.n=9,this.confirmNormalization(y);case 9:d=e.v;case 10:d?p.push(y):c.skipped++,e.n=12;break;case 11:e.p=11,g=e.v,console.error("Error applying normalization:",g),c.errors++;case 12:e.n=7;break;case 13:e.n=15;break;case 14:e.p=14,A=e.v,h.e(A);case 15:return e.p=15,h.f(),e.f(15);case 16:if(!(p.length>0)){e.n=19;break}return i&&i({stage:"prepare",total:p.length}),e.n=17,this.applyDatabaseNormalizations(p,{progressCallback:i});case 17:return F=e.v,c.applied=p.length,c.updatedCreators=F.updatedCreators||0,c.errors+=Array.isArray(F.errors)?F.errors.length:0,e.n=18,this.persistLearningDecisions(p,F.plans);case 18:i&&i({stage:"finalizing",total:p.length,updatedCreators:c.updatedCreators});case 19:if(!(Array.isArray(s)&&s.length>0)){e.n=21;break}return C=c.declinedRecorded,e.n=20,this.recordDeclinedSuggestions(s);case 20:c.declinedRecorded=C+=e.v;case 21:i&&i({stage:"complete",applied:c.applied,skipped:c.skipped,updatedCreators:c.updatedCreators,declined:c.declinedRecorded,total:c.totalSuggestions}),e.n=23;break;case 22:e.p=22,E=e.v,console.error("Error in applyNormalizationSuggestions:",E),c.errors++,i&&i({stage:"error",error:E});case 23:return e.a(2,c)}},e,this,[[8,11],[6,14,15,16],[5,22]])})),function(e){return m.apply(this,arguments)})},{key:"persistLearningDecisions",value:(h=y(D().m(function e(t,r){var u,n,a,i,o,s,l,c,p;return D().w(function(e){for(;;)switch(e.p=e.n){case 0:if(this.learningEngine){e.n=1;break}return e.a(2);case 1:if(u=new Map,Array.isArray(r)){n=f(r);try{for(n.s();!(a=n.n()).done;)(i=a.value)&&i.suggestion&&u.set(i.suggestion,i)}catch(e){n.e(e)}finally{n.f()}}o=f(t||[]),e.p=2,o.s();case 3:if((s=o.n()).done){e.n=5;break}return l=s.value,c=u.get(l)||this.buildSuggestionOperationPlan(l),e.n=4,this.persistLearningForSuggestion(l,c);case 4:e.n=3;break;case 5:e.n=7;break;case 6:e.p=6,p=e.v,o.e(p);case 7:return e.p=7,o.f(),e.f(7);case 8:return e.a(2)}},e,this,[[2,6,7,8]])})),function(e,t){return h.apply(this,arguments)})},{key:"persistLearningForSuggestion",value:(p=y(D().m(function e(t,r){var u,n,a,i,o,s,l,c,p,h,m,y,F,v,d,g,A,C,E,b,B,w,S,k,N;return D().w(function(e){for(;;)switch(e.p=e.n){case 0:if(this.learningEngine&&t){e.n=1;break}return e.a(2);case 1:if(u=(t.primary||"").trim(),n=Array.isArray(t.variants)?t.variants:[],a=r&&Array.isArray(r.variantPairs)?r.variantPairs:this.getVariantPairsForSuggestion(t),"surname"!==t.type){e.n=13;break}i=f(n),e.p=2,i.s();case 3:if((o=i.n()).done){e.n=9;break}if(s=o.value,l=(s&&s.name?s.name:"").trim()){e.n=4;break}return e.a(3,8);case 4:if(!this.stringsEqualIgnoreCase(l,u)){e.n=5;break}return e.a(3,8);case 5:return e.p=5,e.n=6,this.learningEngine.storeMapping(l,u,t.similarity||1);case 6:e.n=8;break;case 7:e.p=7,b=e.v,console.error("Error storing surname mapping:",b);case 8:e.n=3;break;case 9:e.n=11;break;case 10:e.p=10,B=e.v,i.e(B);case 11:return e.p=11,i.f(),e.f(11);case 12:e.n=24;break;case 13:if(c=(null==r?void 0:r.normalizedFirstName)||"",p=(null==r?void 0:r.normalizedLastName)||t.surname||"",!(h=(null==r?void 0:r.normalizedFullName)||this.buildFullName(c,p))){e.n=24;break}m=f(n),e.p=14,m.s();case 15:if((y=m.n()).done){e.n=21;break}if(F=y.value,v=this.extractVariantGivenName(F),d=this.extractVariantSurname(F,p),g=this.buildFullName(v,d)){e.n=16;break}return e.a(3,20);case 16:if(!this.stringsEqualIgnoreCase(g,h)){e.n=17;break}return e.a(3,20);case 17:return e.p=17,e.n=18,this.learningEngine.storeMapping(g,h,t.similarity||1);case 18:e.n=20;break;case 19:e.p=19,w=e.v,console.error("Error storing given-name mapping:",w);case 20:e.n=15;break;case 21:e.n=23;break;case 22:e.p=22,S=e.v,m.e(S);case 23:return e.p=23,m.f(),e.f(23);case 24:if(!(a&&a.length>0&&"function"==typeof this.learningEngine.clearDistinctPair)){e.n=34;break}A=f(a),e.p=25,A.s();case 26:if((C=A.n()).done){e.n=31;break}return E=C.value,e.p=27,e.n=28,this.learningEngine.clearDistinctPair(E.nameA,E.nameB,E.scope);case 28:e.n=30;break;case 29:e.p=29,k=e.v,console.error("Error clearing distinct pair learning entry:",k);case 30:e.n=26;break;case 31:e.n=33;break;case 32:e.p=32,N=e.v,A.e(N);case 33:return e.p=33,A.f(),e.f(33);case 34:return e.a(2)}},e,this,[[27,29],[25,32,33,34],[17,19],[14,22,23,24],[5,7],[2,10,11,12]])})),function(e,t){return p.apply(this,arguments)})},{key:"recordDeclinedSuggestions",value:(c=y(D().m(function e(t){var r,u,n,a,i,o,s,l,c,p,h;return D().w(function(e){for(;;)switch(e.p=e.n){case 0:if(this.learningEngine&&"function"==typeof this.learningEngine.recordDistinctPair){e.n=1;break}return e.a(2,0);case 1:if(Array.isArray(t)&&0!==t.length){e.n=2;break}return e.a(2,0);case 2:r=0,u=f(t),e.p=3,u.s();case 4:if((n=u.n()).done){e.n=16;break}if(a=n.value){e.n=5;break}return e.a(3,15);case 5:i=this.getVariantPairsForSuggestion(a),o=f(i),e.p=6,o.s();case 7:if((s=o.n()).done){e.n=12;break}return l=s.value,e.p=8,e.n=9,this.learningEngine.recordDistinctPair(l.nameA,l.nameB,l.scope);case 9:e.v&&r++,e.n=11;break;case 10:e.p=10,c=e.v,console.error("Error recording distinct pair decision:",c);case 11:e.n=7;break;case 12:e.n=14;break;case 13:e.p=13,p=e.v,o.e(p);case 14:return e.p=14,o.f(),e.f(14);case 15:e.n=4;break;case 16:e.n=18;break;case 17:e.p=17,h=e.v,u.e(h);case 18:return e.p=18,u.f(),e.f(18);case 19:return e.a(2,r)}},e,this,[[8,10],[6,13,14,15],[3,17,18,19]])})),function(e){return c.apply(this,arguments)})},{key:"applyDatabaseNormalizations",value:(a=y(D().m(function e(t){var r,u,a,o,s,l,c,p,h,m,y,F,v,d,g,A,C,E,b,B,w,S,k,N,j,P,O,T,I,x,z,G=this,M=arguments;return D().w(function(e){for(;;)switch(e.p=e.n){case 0:if(r=M.length>1&&void 0!==M[1]?M[1]:{},Array.isArray(t)&&0!==t.length){e.n=1;break}return e.a(2,{plans:[],operations:[],updatedCreators:0,errors:[]});case 1:(u=r.progressCallback||null)&&u({stage:"operations-planned",total:t.length,suggestions:t.length}),a=[],o=0,s=0,l=t.length,c=new Set,p=new Map,h=f(t),e.p=2,h.s();case 3:if((m=h.n()).done){e.n=21;break}if((y=m.value)&&y.primary){e.n=4;break}return e.a(3,20);case 4:F=y.primary.trim(),v=y.type||"surname",d=f(y.variants||[]),e.p=5,d.s();case 6:if((g=d.n()).done){e.n=17;break}if((A=g.value)&&A.items&&0!==A.items.length){e.n=7;break}return e.a(3,16);case 7:C=f(A.items),e.p=8,C.s();case 9:if((E=C.n()).done){e.n=13;break}if((b=E.value)&&b.id){e.n=10;break}return e.a(3,12);case 10:if(B=b.id,w=A.name||"",!this.stringsEqualIgnoreCase(w,F)){e.n=11;break}return e.a(3,12);case 11:c.add(B),p.has(B)||p.set(B,{suggestion:y,variant:A,normalizedValue:F,type:v});case 12:e.n=9;break;case 13:e.n=15;break;case 14:e.p=14,T=e.v,C.e(T);case 15:return e.p=15,C.f(),e.f(15);case 16:e.n=6;break;case 17:e.n=19;break;case 18:e.p=18,I=e.v,d.e(I);case 19:return e.p=19,d.f(),e.f(19);case 20:e.n=3;break;case 21:e.n=23;break;case 22:e.p=22,x=e.v,h.e(x);case 23:return e.p=23,h.f(),e.f(23);case 24:if(0!==c.size){e.n=25;break}return u&&u({stage:"operations-finished",total:0,updatedCreators:0}),e.a(2,{plans:[],operations:[],updatedCreators:0,errors:[]});case 25:return S=Array.from(c),e.n=26,Zotero.Items.getAsync(S);case 26:k=e.v,N=f(k),e.p=27,P=D().m(function e(){var t,r,n,c,f;return D().w(function(e){for(;;)switch(e.p=e.n){case 0:if((t=j.value)&&"function"==typeof t.getCreators){e.n=1;break}return e.a(2,0);case 1:if(e.p=1,r=t.getCreators(),Array.isArray(r)){e.n=2;break}return e.a(2,0);case 2:if(n=!1,c=r.map(function(e){if(!e)return e;var r=p.get(t.id);if(!r)return e;var u=r.normalizedValue,a=r.type,o=r.variant,s=i({},e);if("surname"===a){var l=(e.lastName||"").trim(),D=(o.name||"").trim();G.stringsEqualIgnoreCase(l,D)&&(s.lastName=u,n=!0)}else{var c=(e.firstName||"").trim(),f=(e.lastName||"").trim(),h=(o.firstName||"").trim(),m=(o.lastName||f).trim();if(G.stringsEqualIgnoreCase(c,h)&&G.stringsEqualIgnoreCase(f,m)){var y=u.split(" ");s.firstName=y[0]||"",s.lastName=y.slice(1).join(" ")||f,n=!0}}return s}),!n){e.n=4;break}return t.setCreators(c),e.n=3,t.save();case 3:o++,u&&(s++,u({stage:"operation-complete",processed:s,total:l,affected:1,itemId:t.id}));case 4:e.n=6;break;case 5:e.p=5,f=e.v,a.push({itemId:t.id,error:f}),console.error("Error updating item:",f);case 6:return e.a(2)}},e,null,[[1,5]])}),N.s();case 28:if((j=N.n()).done){e.n=31;break}return e.d(n(P()),29);case 29:if(0!==e.v){e.n=30;break}return e.a(3,30);case 30:e.n=28;break;case 31:e.n=33;break;case 32:e.p=32,z=e.v,N.e(z);case 33:return e.p=33,N.f(),e.f(33);case 34:return u&&u({stage:"operations-finished",total:l,updatedCreators:o}),O=t.map(function(e){return G.buildSuggestionOperationPlan(e)}),e.a(2,{plans:O,operations:[],updatedCreators:o,errors:a})}},e,this,[[27,32,33,34],[8,14,15,16],[5,18,19,20],[2,22,23,24]])})),function(e){return a.apply(this,arguments)})},{key:"buildSuggestionOperationPlan",value:function(e){var t=(e&&e.primary?e.primary:"").trim(),r={suggestion:e,normalizedValue:t,operations:[],variantPairs:this.getVariantPairsForSuggestion(e),normalizedFirstName:"",normalizedLastName:"",normalizedFullName:""};if(!e||!Array.isArray(e.variants)||0===e.variants.length)return r;var u=new Set;if("surname"===e.type){var n,a=f(e.variants);try{for(a.s();!(n=a.n()).done;){var i=n.value,o=(i&&i.name?i.name:"").trim();if(o){var s="surname|".concat(o.toLowerCase(),"|").concat(t.toLowerCase());u.has(s)||(u.add(s),this.stringsEqualIgnoreCase(o,t)||r.operations.push({type:"surname",fromLastName:o,toLastName:t,scope:"surname",variant:i}))}}}catch(e){a.e(e)}finally{a.f()}return r}var l=this.parseName(t),D=[l.firstName,l.middleName].filter(Boolean).join(" ").trim()||l.firstName||t,c=l.lastName||e.surname||"";r.normalizedFirstName=D,r.normalizedLastName=c,r.normalizedFullName=this.buildFullName(D,c);var p,h=f(e.variants);try{for(h.s();!(p=h.n()).done;){var m=p.value,y=this.extractVariantGivenName(m),F=this.extractVariantSurname(m,c||e.surname||"");if(y&&F){var v="given|".concat(y.toLowerCase(),"|").concat(F.toLowerCase());u.has(v)||(u.add(v),this.stringsEqualIgnoreCase(y,D)&&this.stringsEqualIgnoreCase(F,c)||r.operations.push({type:"given-name",fromFirstName:y,fromLastName:F,toFirstName:D,toLastName:c||F,scope:"given:".concat(e.surnameKey||(F||"").toLowerCase()),variant:m}))}}}catch(e){h.e(e)}finally{h.f()}return r}},{key:"getVariantPairsForSuggestion",value:function(e){if(!e||!Array.isArray(e.variants)||e.variants.length<2)return[];for(var t=e.variants,r="surname"===e.type?"surname":"given:".concat(e.surnameKey||(e.surname||"").toLowerCase()),u=[],n=0;n<t.length;n++){var a=this.extractVariantPairName(e,t[n]);if(a)for(var i=n+1;i<t.length;i++){var o=this.extractVariantPairName(e,t[i]);o&&u.push({nameA:a,nameB:o,scope:r})}}return u}},{key:"extractVariantPairName",value:function(e,t){if(!t)return"";if(e&&"surname"===e.type)return(t.name||"").trim();var r=(null==e?void 0:e.surname)||t.lastName||(null==e?void 0:e.primary)||"",u=this.extractVariantGivenName(t);return u?this.buildFullName(u,r):(t.name||"").trim()}},{key:"stringsEqualIgnoreCase",value:function(e,t){return!e&&!t||!(!e||!t)&&e.trim().toLowerCase()===t.trim().toLowerCase()}},{key:"extractVariantGivenName",value:function(e){if(!e)return"";if("string"==typeof e.firstName&&e.firstName.trim())return e.firstName.trim();if("string"==typeof e.name&&e.name.trim()){var t=this.parseName(e.name),r=[t.firstName,t.middleName].filter(Boolean).join(" ").trim();if(r)return r}return""}},{key:"extractVariantSurname",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";if(!e)return t||"";if("string"==typeof e.lastName&&e.lastName.trim())return e.lastName.trim();if("string"==typeof e.name&&e.name.trim()){var r=this.parseName(e.name);if(r.lastName)return r.lastName.trim()}return t||""}},{key:"buildFullName",value:function(e,t){return[e,t].filter(function(e){return e&&e.trim()}).join(" ").trim()}},{key:"describeOperation",value:function(e){if(!e)return"";if("surname"===e.type)return"".concat(e.fromLastName,"  ").concat(e.toLastName);var t=this.buildFullName(e.fromFirstName,e.fromLastName),r=this.buildFullName(e.toFirstName,e.toLastName);return"".concat(t,"  ").concat(r)}},{key:"shouldSkipSuggestionFromLearning",value:function(e){var t=this;if(!this.learningEngine||"function"!=typeof this.learningEngine.isDistinctPair)return!1;var r=this.getVariantPairsForSuggestion(e);return!(!r||0===r.length)&&r.some(function(e){return t.learningEngine.isDistinctPair(e.nameA,e.nameB,e.scope)})}},{key:"confirmNormalization",value:(u=y(D().m(function e(){return D().w(function(e){for(;;)if(0===e.n)return e.a(2,!0)},e)})),function(){return u.apply(this,arguments)})}],t&&F(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,u,a,c,p,h,m,v,d,C}();e.exports&&(e.exports=C)},889:(e,t,r)=>{function u(e){return u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},u(e)}function n(e,t){for(var r=0;r<t.length;r++){var u=t[r];u.enumerable=u.enumerable||!1,u.configurable=!0,"value"in u&&(u.writable=!0),Object.defineProperty(e,a(u.key),u)}}function a(e){var t=function(e){if("object"!=u(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=u(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==u(t)?t:t+""}var i=r(258),o=i.NAME_PREFIXES,s=i.NAME_SUFFIXES,l=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.prefixes=o,this.suffixes=s,this.initialPattern=/^[A-Z]\.?$/,this.initialsPattern=/^[A-Z]\.[A-Z]\.?$/},(t=[{key:"parse",value:function(e){var t=this,r=e||"",u=(r||"").trim();if(u.includes(",")){var n=u.split(",").map(function(e){return e.trim()}).filter(function(e){return e.length>0});if(n.length>=2){var a=n[0],i=n.slice(1).join(" ").trim();/(?:[A-Za-z\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u05D0-\u05EA\u05EF-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u0870-\u0887\u0889-\u088F\u08A0-\u08C9\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C5C\u0C5D\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDC-\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D04-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16F1-\u16F8\u1700-\u1711\u171F-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1878\u1880-\u1884\u1887-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4C\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C8A\u1C90-\u1CBA\u1CBD-\u1CBF\u1CE9-\u1CEC\u1CEE-\u1CF3\u1CF5\u1CF6\u1CFA\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2183\u2184\u2C00-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005\u3006\u3031-\u3035\u303B\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u31BF\u31F0-\u31FF\u3400-\u4DBF\u4E00-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6E5\uA717-\uA71F\uA722-\uA788\uA78B-\uA7DC\uA7F1-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA8FE\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB69\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDE80-\uDE9C\uDEA0-\uDED0\uDF00-\uDF1F\uDF2D-\uDF40\uDF42-\uDF49\uDF50-\uDF75\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF]|\uD801[\uDC00-\uDC9D\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDD70-\uDD7A\uDD7C-\uDD8A\uDD8C-\uDD92\uDD94\uDD95\uDD97-\uDDA1\uDDA3-\uDDB1\uDDB3-\uDDB9\uDDBB\uDDBC\uDDC0-\uDDF3\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67\uDF80-\uDF85\uDF87-\uDFB0\uDFB2-\uDFBA]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD40-\uDD59\uDD80-\uDDB7\uDDBE\uDDBF\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE35\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE4\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2\uDD00-\uDD23\uDD4A-\uDD65\uDD6F-\uDD85\uDE80-\uDEA9\uDEB0\uDEB1\uDEC2-\uDEC7\uDF00-\uDF1C\uDF27\uDF30-\uDF45\uDF70-\uDF81\uDFB0-\uDFC4\uDFE0-\uDFF6]|\uD804[\uDC03-\uDC37\uDC71\uDC72\uDC75\uDC83-\uDCAF\uDCD0-\uDCE8\uDD03-\uDD26\uDD44\uDD47\uDD50-\uDD72\uDD76\uDD83-\uDDB2\uDDC1-\uDDC4\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE2B\uDE3F\uDE40\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEDE\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3D\uDF50\uDF5D-\uDF61\uDF80-\uDF89\uDF8B\uDF8E\uDF90-\uDFB5\uDFB7\uDFD1\uDFD3]|\uD805[\uDC00-\uDC34\uDC47-\uDC4A\uDC5F-\uDC61\uDC80-\uDCAF\uDCC4\uDCC5\uDCC7\uDD80-\uDDAE\uDDD8-\uDDDB\uDE00-\uDE2F\uDE44\uDE80-\uDEAA\uDEB8\uDF00-\uDF1A\uDF40-\uDF46]|\uD806[\uDC00-\uDC2B\uDCA0-\uDCDF\uDCFF-\uDD06\uDD09\uDD0C-\uDD13\uDD15\uDD16\uDD18-\uDD2F\uDD3F\uDD41\uDDA0-\uDDA7\uDDAA-\uDDD0\uDDE1\uDDE3\uDE00\uDE0B-\uDE32\uDE3A\uDE50\uDE5C-\uDE89\uDE9D\uDEB0-\uDEF8\uDFC0-\uDFE0]|\uD807[\uDC00-\uDC08\uDC0A-\uDC2E\uDC40\uDC72-\uDC8F\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD30\uDD46\uDD60-\uDD65\uDD67\uDD68\uDD6A-\uDD89\uDD98\uDDB0-\uDDDB\uDEE0-\uDEF2\uDF02\uDF04-\uDF10\uDF12-\uDF33\uDFB0]|\uD808[\uDC00-\uDF99]|\uD809[\uDC80-\uDD43]|\uD80B[\uDF90-\uDFF0]|[\uD80C\uD80E\uD80F\uD81C-\uD822\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2F\uDC41-\uDC46\uDC60-\uDFFF]|\uD810[\uDC00-\uDFFA]|\uD811[\uDC00-\uDE46]|\uD818[\uDD00-\uDD1D]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE70-\uDEBE\uDED0-\uDEED\uDF00-\uDF2F\uDF40-\uDF43\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDD40-\uDD6C\uDE40-\uDE7F\uDEA0-\uDEB8\uDEBB-\uDED3\uDF00-\uDF4A\uDF50\uDF93-\uDF9F\uDFE0\uDFE1\uDFE3\uDFF2\uDFF3]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82B[\uDFF0-\uDFF3\uDFF5-\uDFFB\uDFFD\uDFFE]|\uD82C[\uDC00-\uDD22\uDD32\uDD50-\uDD52\uDD55\uDD64-\uDD67\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB]|\uD837[\uDF00-\uDF1E\uDF25-\uDF2A]|\uD838[\uDC30-\uDC6D\uDD00-\uDD2C\uDD37-\uDD3D\uDD4E\uDE90-\uDEAD\uDEC0-\uDEEB]|\uD839[\uDCD0-\uDCEB\uDDD0-\uDDED\uDDF0\uDEC0-\uDEDE\uDEE0-\uDEE2\uDEE4\uDEE5\uDEE7-\uDEED\uDEF0-\uDEF4\uDEFE\uDEFF\uDFE0-\uDFE6\uDFE8-\uDFEB\uDFED\uDFEE\uDFF0-\uDFFE]|\uD83A[\uDC00-\uDCC4\uDD00-\uDD43\uDD4B]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79])/.test(a)&&/(?:[A-Za-z\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u05D0-\u05EA\u05EF-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u0870-\u0887\u0889-\u088F\u08A0-\u08C9\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C5C\u0C5D\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDC-\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D04-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16F1-\u16F8\u1700-\u1711\u171F-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1878\u1880-\u1884\u1887-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4C\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C8A\u1C90-\u1CBA\u1CBD-\u1CBF\u1CE9-\u1CEC\u1CEE-\u1CF3\u1CF5\u1CF6\u1CFA\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2183\u2184\u2C00-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005\u3006\u3031-\u3035\u303B\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u31BF\u31F0-\u31FF\u3400-\u4DBF\u4E00-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6E5\uA717-\uA71F\uA722-\uA788\uA78B-\uA7DC\uA7F1-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA8FE\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB69\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDE80-\uDE9C\uDEA0-\uDED0\uDF00-\uDF1F\uDF2D-\uDF40\uDF42-\uDF49\uDF50-\uDF75\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF]|\uD801[\uDC00-\uDC9D\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDD70-\uDD7A\uDD7C-\uDD8A\uDD8C-\uDD92\uDD94\uDD95\uDD97-\uDDA1\uDDA3-\uDDB1\uDDB3-\uDDB9\uDDBB\uDDBC\uDDC0-\uDDF3\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67\uDF80-\uDF85\uDF87-\uDFB0\uDFB2-\uDFBA]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD40-\uDD59\uDD80-\uDDB7\uDDBE\uDDBF\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE35\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE4\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2\uDD00-\uDD23\uDD4A-\uDD65\uDD6F-\uDD85\uDE80-\uDEA9\uDEB0\uDEB1\uDEC2-\uDEC7\uDF00-\uDF1C\uDF27\uDF30-\uDF45\uDF70-\uDF81\uDFB0-\uDFC4\uDFE0-\uDFF6]|\uD804[\uDC03-\uDC37\uDC71\uDC72\uDC75\uDC83-\uDCAF\uDCD0-\uDCE8\uDD03-\uDD26\uDD44\uDD47\uDD50-\uDD72\uDD76\uDD83-\uDDB2\uDDC1-\uDDC4\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE2B\uDE3F\uDE40\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEDE\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3D\uDF50\uDF5D-\uDF61\uDF80-\uDF89\uDF8B\uDF8E\uDF90-\uDFB5\uDFB7\uDFD1\uDFD3]|\uD805[\uDC00-\uDC34\uDC47-\uDC4A\uDC5F-\uDC61\uDC80-\uDCAF\uDCC4\uDCC5\uDCC7\uDD80-\uDDAE\uDDD8-\uDDDB\uDE00-\uDE2F\uDE44\uDE80-\uDEAA\uDEB8\uDF00-\uDF1A\uDF40-\uDF46]|\uD806[\uDC00-\uDC2B\uDCA0-\uDCDF\uDCFF-\uDD06\uDD09\uDD0C-\uDD13\uDD15\uDD16\uDD18-\uDD2F\uDD3F\uDD41\uDDA0-\uDDA7\uDDAA-\uDDD0\uDDE1\uDDE3\uDE00\uDE0B-\uDE32\uDE3A\uDE50\uDE5C-\uDE89\uDE9D\uDEB0-\uDEF8\uDFC0-\uDFE0]|\uD807[\uDC00-\uDC08\uDC0A-\uDC2E\uDC40\uDC72-\uDC8F\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD30\uDD46\uDD60-\uDD65\uDD67\uDD68\uDD6A-\uDD89\uDD98\uDDB0-\uDDDB\uDEE0-\uDEF2\uDF02\uDF04-\uDF10\uDF12-\uDF33\uDFB0]|\uD808[\uDC00-\uDF99]|\uD809[\uDC80-\uDD43]|\uD80B[\uDF90-\uDFF0]|[\uD80C\uD80E\uD80F\uD81C-\uD822\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2F\uDC41-\uDC46\uDC60-\uDFFF]|\uD810[\uDC00-\uDFFA]|\uD811[\uDC00-\uDE46]|\uD818[\uDD00-\uDD1D]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE70-\uDEBE\uDED0-\uDEED\uDF00-\uDF2F\uDF40-\uDF43\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDD40-\uDD6C\uDE40-\uDE7F\uDEA0-\uDEB8\uDEBB-\uDED3\uDF00-\uDF4A\uDF50\uDF93-\uDF9F\uDFE0\uDFE1\uDFE3\uDFF2\uDFF3]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82B[\uDFF0-\uDFF3\uDFF5-\uDFFB\uDFFD\uDFFE]|\uD82C[\uDC00-\uDD22\uDD32\uDD50-\uDD52\uDD55\uDD64-\uDD67\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB]|\uD837[\uDF00-\uDF1E\uDF25-\uDF2A]|\uD838[\uDC30-\uDC6D\uDD00-\uDD2C\uDD37-\uDD3D\uDD4E\uDE90-\uDEAD\uDEC0-\uDEEB]|\uD839[\uDCD0-\uDCEB\uDDD0-\uDDED\uDDF0\uDEC0-\uDEDE\uDEE0-\uDEE2\uDEE4\uDEE5\uDEE7-\uDEED\uDEF0-\uDEF4\uDEFE\uDEFF\uDFE0-\uDFE6\uDFE8-\uDFEB\uDFED\uDFEE\uDFF0-\uDFFE]|\uD83A[\uDC00-\uDCC4\uDD00-\uDD43\uDD4B]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79])/.test(i)&&(u="".concat(i," ").concat(a).trim())}}var o=u.replace(/[ ,\s]+$/,"").split(/\s+/),s={firstName:"",middleName:"",lastName:"",prefix:"",suffix:"",original:r};if(1===o.length&&""!==o[0])return this.prefixes.includes(o[0].toLowerCase())?s.prefix=o[0]:s.lastName=o[0],s;if(1===o.length&&""===o[0])return s;if(o.length>=2){s.firstName=this.stripTrailingPeriodIfName(o[0]);for(var l=1;l<o.length-1&&this.prefixes.includes(o[l].toLowerCase());)s.prefix?s.prefix="".concat(s.prefix," ").concat(o[l]):s.prefix=o[l],l++;s.prefix&&l<o.length-1&&this.isNextWordForPrefix(s.prefix,o[l])&&(s.prefix="".concat(s.prefix," ").concat(o[l]),l++);for(var D=o.length-1;D>l&&this.suffixes.some(function(e){return o[D].toLowerCase()===e.toLowerCase()||o[D].toLowerCase()===e.toLowerCase()+"."});)s.suffix?s.suffix="".concat(o[D]," ").concat(s.suffix):s.suffix=o[D],D--;if(D>=l&&(s.lastName=o[D]),l<D){var c=o.slice(l,D);c.length>0&&(s.middleName=c.map(function(e){return t.stripTrailingPeriodIfName(e)}).join(" "))}}return s.firstName=this.stripTrailingPeriodIfName(s.firstName),s.middleName=this.stripTrailingPeriodIfName(s.middleName),s.lastName=this.stripTrailingPeriodIfName(s.lastName),s}},{key:"isNextWordForPrefix",value:function(e,t){return!!["del","de","da","das","dos","do","du","des","di"].includes(e)&&/^[A-Z][a-zA-Z]+$/.test(t)&&t.length>1}},{key:"stripTrailingPeriodIfName",value:function(e){if(!e||"string"!=typeof e)return e||"";var t=e.trim();if(!t.endsWith("."))return t;var r=t.slice(0,-1);return r.length<2||r.includes(".")?t:/[A-Za-z]/.test(r)&&/[AEIOUYaeiouy]/.test(r)?r:t}}])&&n(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();e.exports&&(e.exports=l)}},t={};function r(u){var n=t[u];if(void 0!==n)return n.exports;var a=t[u]={exports:{}};return e[u](a,a.exports,r),a.exports}r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var u in t)r.o(t,u)&&!r.o(e,u)&&Object.defineProperty(e,u,{enumerable:!0,get:t[u]})},r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var u={};return(()=>{"use strict";r.r(u),r.d(u,{BatchProcessor:()=>d.a,CandidateFinder:()=>l.a,DataManager:()=>E.a,DynamicVirtualScroll:()=>A.a,ItemProcessor:()=>c.a,LearningEngine:()=>o.a,MenuIntegration:()=>p.a,NameParser:()=>t.a,NormalizerDialog:()=>F.a,VariantGenerator:()=>a.a,ZoteroDBAnalyzer:()=>m.a,default:()=>B});var e=r(889),t=r.n(e),n=r(441),a=r.n(n),i=r(95),o=r.n(i),s=r(22),l=r.n(s),D=r(48),c=r.n(D),f=r(886),p=r.n(f),h=r(887),m=r.n(h),y=r(491),F=r.n(y),v=r(672),d=r.n(v),g=r(273),A=r.n(g),C=r(588),E=r.n(C);"undefined"==typeof console&&(globalThis.console={log:function(){if("undefined"!=typeof Zotero&&Zotero.debug){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];Zotero.debug("NameNormalizer: "+t.join(" "))}},warn:function(){if("undefined"!=typeof Zotero&&Zotero.debug){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];Zotero.debug("NameNormalizer WARN: "+t.join(" "))}},error:function(){if("undefined"!=typeof Zotero&&Zotero.debug){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];Zotero.debug("NameNormalizer ERROR: "+t.join(" "))}},info:function(){if("undefined"!=typeof Zotero&&Zotero.debug){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];Zotero.debug("NameNormalizer INFO: "+t.join(" "))}},debug:function(){if("undefined"!=typeof Zotero&&Zotero.debug){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];Zotero.debug("NameNormalizer DEBUG: "+t.join(" "))}}});var b={NameParser:t(),VariantGenerator:a(),LearningEngine:o(),CandidateFinder:l(),ItemProcessor:c(),MenuIntegration:p(),ZoteroDBAnalyzer:m(),NormalizerDialog:F(),BatchProcessor:d(),DataManager:E(),DynamicVirtualScroll:A()};"undefined"!=typeof window&&(window.ZoteroNameNormalizer=b);const B=b})(),u})());