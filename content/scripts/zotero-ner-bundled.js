/*! For license information please see zotero-ner-bundled.js.LICENSE.txt */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.ZoteroNER=t():e.ZoteroNER=t()}(this,()=>(()=>{var e={22:(e,t,r)=>{function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function a(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=s(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,u=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return i=e.done,e},e:function(e){u=!0,o=e},f:function(){try{i||null==r.return||r.return()}finally{if(u)throw o}}}}function o(){var e,t,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",a=r.toStringTag||"@@toStringTag";function u(r,n,a,o){var u=n&&n.prototype instanceof c?n:c,l=Object.create(u.prototype);return i(l,"_invoke",function(r,n,a){var o,i,u,c=0,l=a||[],f=!1,p={p:0,n:0,v:e,a:y,f:y.bind(e,4),d:function(t,r){return o=t,i=0,u=e,p.n=r,s}};function y(r,n){for(i=r,u=n,t=0;!f&&c&&!a&&t<l.length;t++){var a,o=l[t],y=p.p,m=o[2];r>3?(a=m===n)&&(u=o[(i=o[4])?5:(i=3,3)],o[4]=o[5]=e):o[0]<=y&&((a=r<2&&y<o[1])?(i=0,p.v=n,p.n=o[1]):y<m&&(a=r<3||o[0]>n||n>m)&&(o[4]=r,o[5]=n,p.n=m,i=0))}if(a||r>1)return s;throw f=!0,n}return function(a,l,m){if(c>1)throw TypeError("Generator is already running");for(f&&1===l&&y(l,m),i=l,u=m;(t=i<2?e:u)||!f;){o||(i?i<3?(i>1&&(p.n=-1),y(i,u)):p.n=u:p.v=u);try{if(c=2,o){if(i||(a="next"),t=o[a]){if(!(t=t.call(o,u)))throw TypeError("iterator result is not an object");if(!t.done)return t;u=t.value,i<2&&(i=0)}else 1===i&&(t=o.return)&&t.call(o),i<2&&(u=TypeError("The iterator does not provide a '"+a+"' method"),i=1);o=e}else if((t=(f=p.n<0)?u:r.call(n,p))!==s)break}catch(t){o=e,i=1,u=t}finally{c=1}}return{value:t,done:f}}}(r,a,o),!0),l}var s={};function c(){}function l(){}function f(){}t=Object.getPrototypeOf;var p=[][n]?t(t([][n]())):(i(t={},n,function(){return this}),t),y=f.prototype=c.prototype=Object.create(p);function m(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,f):(e.__proto__=f,i(e,a,"GeneratorFunction")),e.prototype=Object.create(y),e}return l.prototype=f,i(y,"constructor",f),i(f,"constructor",l),l.displayName="GeneratorFunction",i(f,a,"GeneratorFunction"),i(y),i(y,a,"Generator"),i(y,n,function(){return this}),i(y,"toString",function(){return"[object Generator]"}),(o=function(){return{w:u,m}})()}function i(e,t,r,n){var a=Object.defineProperty;try{a({},"",{})}catch(e){a=0}i=function(e,t,r,n){function o(t,r){i(e,t,function(e){return this._invoke(t,r,e)})}t?a?a(e,t,{value:r,enumerable:!n,configurable:!n,writable:!n}):e[t]=r:(o("next",0),o("throw",1),o("return",2))},i(e,t,r,n)}function u(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,a,o,i,u=[],s=!0,c=!1;try{if(o=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;s=!1}else for(;!(s=(n=o.call(r)).done)&&(u.push(n.value),u.length!==t);s=!0);}catch(e){c=!0,a=e}finally{try{if(!s&&null!=r.return&&(i=r.return(),Object(i)!==i))return}finally{if(c)throw a}}return u}}(e,t)||s(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function s(e,t){if(e){if("string"==typeof e)return c(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?c(e,t):void 0}}function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function l(e,t,r,n,a,o,i){try{var u=e[o](i),s=u.value}catch(e){return void r(e)}u.done?t(s):Promise.resolve(s).then(n,a)}function f(e){return function(){var t=this,r=arguments;return new Promise(function(n,a){var o=e.apply(t,r);function i(e){l(o,n,a,i,u,"next",e)}function u(e){l(o,n,a,i,u,"throw",e)}i(void 0)})}}function p(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,y(n.key),n)}}function y(e){var t=function(e){if("object"!=n(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=n(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==n(t)?t:t+""}var m=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.nerProcessor=new(r(388)),this.learningEngine=new(r(95)),this.nameParser=new(r(889)),this.variantGenerator=new(r(441))},t=[{key:"findNameVariants",value:(l=f(o().m(function e(t){var r,n,a,i,s,c,l,f,p,y,m;return o().w(function(e){for(;;)switch(e.p=e.n){case 0:if(t){e.n=1;break}throw new Error("Zotero database object required for candidate finding");case 1:return e.p=1,e.n=2,this.fetchAllCreators(t);case 2:for(r=e.v,n=this.groupCreatorsBySurname(r),a={},i=0,s=0,c=Object.entries(n);s<c.length;s++)l=u(c[s],2),f=l[0],p=l[1],(y=this.findFirstInitialVariations(p)).length>0&&(a[f]=y,i+=y.length);return e.a(2,{surnameGroups:n,variationsBySurname:a,totalVariantGroups:i,totalSurnames:Object.keys(n).length});case 3:throw e.p=3,m=e.v,console.error("Error in findNameVariants:",m),m;case 4:return e.a(2)}},e,this,[[1,3]])})),function(e){return l.apply(this,arguments)})},{key:"fetchAllCreators",value:(c=f(o().m(function e(t){var r,n,i,u,s,c,l,f,p;return o().w(function(e){for(;;)switch(e.n){case 0:if("undefined"==typeof Zotero){e.n=2;break}return r=[],e.n=1,Zotero.Items.getAll();case 1:n=e.v,i=a(n);try{for(i.s();!(u=i.n()).done;){s=u.value,c=s.getCreators(),l=a(c);try{for(l.s();!(f=l.n()).done;)p=f.value,r.push(p)}catch(e){l.e(e)}finally{l.f()}}}catch(e){i.e(e)}finally{i.f()}return e.a(2,r);case 2:return e.a(2,[{firstName:"Jerry",lastName:"Fodor",creatorType:"author"},{firstName:"J.",lastName:"Fodor",creatorType:"author"},{firstName:"Jerry",lastName:"Fodor",creatorType:"author"},{firstName:"Jerry A.",lastName:"Fodor",creatorType:"author"},{firstName:"J.A.",lastName:"Fodor",creatorType:"author"},{firstName:"Eva",lastName:"van Dijk",creatorType:"author"},{firstName:"E.",lastName:"van Dijk",creatorType:"author"},{firstName:"John",lastName:"Smith",creatorType:"author"},{firstName:"J.",lastName:"Smith",creatorType:"author"},{firstName:"Johnny",lastName:"Smith",creatorType:"author"},{firstName:"J.B.",lastName:"Smith",creatorType:"author"},{firstName:"John B.",lastName:"Smith",creatorType:"author"}]);case 3:return e.a(2)}},e)})),function(e){return c.apply(this,arguments)})},{key:"groupCreatorsBySurname",value:function(e){var t,r={},n=a(e);try{for(n.s();!(t=n.n()).done;){var o=t.value,i=this.nameParser.parse("".concat(o.firstName||""," ").concat(o.lastName||"").trim());if(i.lastName){var u=i.lastName.toLowerCase().trim();r[u]||(r[u]=[]),r[u].push(o)}}}catch(e){n.e(e)}finally{n.f()}return r}},{key:"findFirstInitialVariations",value:function(e){var t,r={},n={},o=a(e);try{for(o.s();!(t=o.n()).done;){var i=t.value,u="".concat(i.firstName||""," ").concat(i.lastName||"").trim().toLowerCase();r[u]=(r[u]||0)+1,n[u]||(n[u]=i)}}catch(e){o.e(e)}finally{o.f()}var s,c={},l=a(e);try{for(l.s();!(s=l.n()).done;){var f=(s.value.firstName||"").trim().toLowerCase();f&&(c[f]||(c[f]=0),c[f]++)}}catch(e){l.e(e)}finally{l.f()}for(var p=Object.keys(c),y=[],m=0;m<p.length;m++)for(var h=m+1;h<p.length;h++){var v=p[m],d=p[h],g=this.calculateLevenshteinDistance(v,d),b=Math.max(v.length,d.length),w=b>0?1-g/b:1;w>=.6&&y.push({surname:e[0].lastName,variant1:{firstName:v,frequency:c[v]},variant2:{firstName:d,frequency:c[d]},similarity:w,distance:g})}return y.sort(function(e,t){var r=e.variant1.frequency+e.variant2.frequency;return t.variant1.frequency+t.variant2.frequency-r}),y}},{key:"findCanonicalForms",value:function(e){for(var t={},r=0,n=Object.entries(e);r<n.length;r++){var o,i=u(n[r],2),s=(i[0],a(i[1]));try{for(s.s();!(o=s.n()).done;){var c=o.value,l=c.variant1.frequency>=c.variant2.frequency?c.variant1.firstName:c.variant2.firstName,f="".concat(c.variant1.firstName," ").concat(c.surname).trim(),p="".concat(c.variant2.firstName," ").concat(c.surname).trim(),y="".concat(l," ").concat(c.surname).trim();t[f.toLowerCase()]=y,t[p.toLowerCase()]=y}}catch(e){s.e(e)}finally{s.f()}}return t}},{key:"calculateLevenshteinDistance",value:function(e,t){var r=[];if(0===e.length)return t.length;if(0===t.length)return e.length;for(var n=0;n<=t.length;n++)r[n]=[n];for(var a=0;a<=e.length;a++)r[0][a]=a;for(var o=1;o<=t.length;o++)for(var i=1;i<=e.length;i++)t.charAt(o-1)===e.charAt(i-1)?r[o][i]=r[o-1][i-1]:r[o][i]=Math.min(r[o-1][i-1]+1,r[o][i-1]+1,r[o-1][i]+1);return r[t.length][e.length]}},{key:"performFullAnalysis",value:(s=f(o().m(function e(t){var r,n,a;return o().w(function(e){for(;;)switch(e.n){case 0:return console.log("Starting full name variant analysis (first name/initial focus)..."),e.n=1,this.findNameVariants(t);case 1:return r=e.v,n=this.findCanonicalForms(r.variationsBySurname),e.n=2,this.generateNormalizationSuggestions(r.variationsBySurname,n);case 2:return a=e.v,console.log("Analysis complete: Found ".concat(r.totalVariantGroups," variant groups across ").concat(r.totalSurnames," surnames")),e.a(2,{surnameGroups:r.surnameGroups,variationsBySurname:r.variationsBySurname,canonicalForms:n,suggestions:a,totalVariantGroups:r.totalVariantGroups,totalSurnamesAnalyzed:r.totalSurnames})}},e,this)})),function(e){return s.apply(this,arguments)})},{key:"generateNormalizationSuggestions",value:(i=f(o().m(function e(t,r){var n,i,s,c,l,f,p,y,m,h;return o().w(function(e){for(;;)if(0===e.n){for(n=[],i=0,s=Object.entries(t);i<s.length;i++){(c=u(s[i],2))[0],l=c[1],f=a(l);try{for(f.s();!(p=f.n()).done;)y=p.value,m="".concat(y.variant1.firstName," ").concat(y.surname).trim(),h="".concat(y.variant2.firstName," ").concat(y.surname).trim(),n.push({surname:y.surname,canonicalForm:r[m.toLowerCase()]||r[h.toLowerCase()],variant1:{firstName:y.variant1.firstName,frequency:y.variant1.frequency},variant2:{firstName:y.variant2.firstName,frequency:y.variant2.frequency},similarity:y.similarity,recommendedNormalization:y.variant1.frequency>=y.variant2.frequency?y.variant1.firstName:y.variant2.firstName})}catch(e){f.e(e)}finally{f.f()}}return e.a(2,n)}},e)})),function(e,t){return i.apply(this,arguments)})},{key:"getAllVariations",value:(n=f(o().m(function e(t){var r;return o().w(function(e){for(;;)if(0===e.n)return r=this.nameParser.parse(t),e.a(2,this.variantGenerator.generateVariants(r))},e,this)})),function(e){return n.apply(this,arguments)})}],t&&p(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,n,i,s,c,l}();e.exports&&(e.exports=m)},48:(e,t,r)=>{function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function a(){var e,t,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",i=r.toStringTag||"@@toStringTag";function u(r,n,a,i){var u=n&&n.prototype instanceof c?n:c,l=Object.create(u.prototype);return o(l,"_invoke",function(r,n,a){var o,i,u,c=0,l=a||[],f=!1,p={p:0,n:0,v:e,a:y,f:y.bind(e,4),d:function(t,r){return o=t,i=0,u=e,p.n=r,s}};function y(r,n){for(i=r,u=n,t=0;!f&&c&&!a&&t<l.length;t++){var a,o=l[t],y=p.p,m=o[2];r>3?(a=m===n)&&(u=o[(i=o[4])?5:(i=3,3)],o[4]=o[5]=e):o[0]<=y&&((a=r<2&&y<o[1])?(i=0,p.v=n,p.n=o[1]):y<m&&(a=r<3||o[0]>n||n>m)&&(o[4]=r,o[5]=n,p.n=m,i=0))}if(a||r>1)return s;throw f=!0,n}return function(a,l,m){if(c>1)throw TypeError("Generator is already running");for(f&&1===l&&y(l,m),i=l,u=m;(t=i<2?e:u)||!f;){o||(i?i<3?(i>1&&(p.n=-1),y(i,u)):p.n=u:p.v=u);try{if(c=2,o){if(i||(a="next"),t=o[a]){if(!(t=t.call(o,u)))throw TypeError("iterator result is not an object");if(!t.done)return t;u=t.value,i<2&&(i=0)}else 1===i&&(t=o.return)&&t.call(o),i<2&&(u=TypeError("The iterator does not provide a '"+a+"' method"),i=1);o=e}else if((t=(f=p.n<0)?u:r.call(n,p))!==s)break}catch(t){o=e,i=1,u=t}finally{c=1}}return{value:t,done:f}}}(r,a,i),!0),l}var s={};function c(){}function l(){}function f(){}t=Object.getPrototypeOf;var p=[][n]?t(t([][n]())):(o(t={},n,function(){return this}),t),y=f.prototype=c.prototype=Object.create(p);function m(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,f):(e.__proto__=f,o(e,i,"GeneratorFunction")),e.prototype=Object.create(y),e}return l.prototype=f,o(y,"constructor",f),o(f,"constructor",l),l.displayName="GeneratorFunction",o(f,i,"GeneratorFunction"),o(y),o(y,i,"Generator"),o(y,n,function(){return this}),o(y,"toString",function(){return"[object Generator]"}),(a=function(){return{w:u,m}})()}function o(e,t,r,n){var a=Object.defineProperty;try{a({},"",{})}catch(e){a=0}o=function(e,t,r,n){function i(t,r){o(e,t,function(e){return this._invoke(t,r,e)})}t?a?a(e,t,{value:r,enumerable:!n,configurable:!n,writable:!n}):e[t]=r:(i("next",0),i("throw",1),i("return",2))},o(e,t,r,n)}function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function u(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i(Object(r),!0).forEach(function(t){s(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function s(e,t,r){return(t=m(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function c(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return l(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?l(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,u=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return i=e.done,e},e:function(e){u=!0,o=e},f:function(){try{i||null==r.return||r.return()}finally{if(u)throw o}}}}function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function f(e,t,r,n,a,o,i){try{var u=e[o](i),s=u.value}catch(e){return void r(e)}u.done?t(s):Promise.resolve(s).then(n,a)}function p(e){return function(){var t=this,r=arguments;return new Promise(function(n,a){var o=e.apply(t,r);function i(e){f(o,n,a,i,u,"next",e)}function u(e){f(o,n,a,i,u,"throw",e)}i(void 0)})}}function y(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,m(n.key),n)}}function m(e){var t=function(e){if("object"!=n(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=n(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==n(t)?t:t+""}var h=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.nameParser=new(r(889)),this.variantGenerator=new(r(441)),this.learningEngine=new(r(95)),this.candidateFinder=new(r(22))},t=[{key:"processItemCreators",value:(s=p(a().m(function e(t){var r,n,o,i,s,l,f,p,y,m,h,v;return a().w(function(e){for(;;)switch(e.p=e.n){case 0:r=[],n=t.getCreators?t.getCreators():[],o=c(n),e.p=1,o.s();case 2:if((i=o.n()).done){e.n=6;break}if(!(s=i.value).firstName&&!s.lastName){e.n=5;break}if(l=this.buildRawName(s),!(f=this.learningEngine.getMapping(l))){e.n=3;break}return r.push({original:u({},s),normalized:this.parseNameFromFullString(f),type:s.creatorType,status:"learned",suggestion:f}),e.a(3,5);case 3:return p=this.learningEngine.findSimilar(l),y=this.nameParser.parse(l),m=this.variantGenerator.generateVariants(y),e.n=4,this.findLibraryWideVariants(y.lastName);case 4:h=e.v,r.push({original:u({},s),parsed:y,variants:m,similars:p,libraryVariants:h,type:s.creatorType,status:"new"});case 5:e.n=2;break;case 6:e.n=8;break;case 7:e.p=7,v=e.v,o.e(v);case 8:return e.p=8,o.f(),e.f(8);case 9:return e.a(2,r)}},e,this,[[1,7,8,9]])})),function(e){return s.apply(this,arguments)})},{key:"findLibraryWideVariants",value:(i=p(a().m(function e(t){var r;return a().w(function(e){for(;;)switch(e.p=e.n){case 0:if("undefined"==typeof Zotero){e.n=3;break}return e.p=1,e.a(2,[]);case 2:return e.p=2,r=e.v,console.warn("Could not perform library-wide variant scan:",r),e.a(2,[]);case 3:return e.a(2,[])}},e,null,[[1,2]])})),function(e){return i.apply(this,arguments)})},{key:"buildRawName",value:function(e){return"".concat(e.firstName||""," ").concat(e.lastName||"").trim()}},{key:"parseNameFromFullString",value:function(e){var t=this.nameParser.parse(e);return{firstName:t.firstName,lastName:t.lastName,fieldMode:0}}},{key:"applyNormalizations",value:(o=p(a().m(function e(t,r){var n,o,i,u;return a().w(function(e){for(;;)switch(e.n){case 0:n=0;case 1:if(!(n<r.length)){e.n=3;break}if(!(o=r[n]).accepted){e.n=2;break}return console.log("Applying normalization: ".concat(o.original.firstName," ").concat(o.original.lastName," -> ").concat(o.normalized.firstName," ").concat(o.normalized.lastName)),i=this.buildRawName(o.original),u=this.buildRawName(o.normalized),e.n=2,this.learningEngine.storeMapping(i,u);case 2:n++,e.n=1;break;case 3:console.log("Applied normalizations to item:",t.getField("title"));case 4:return e.a(2)}},e,this)})),function(e,t){return o.apply(this,arguments)})},{key:"performLibraryAnalysis",value:(n=p(a().m(function e(t){var r,n,o,i,u,s,l,f,p,y,m,h,v,d,g,b,w,S,N,k,j,O,P,A;return a().w(function(e){for(;;)if(0===e.n){r=[],n=c(t);try{for(n.s();!(o=n.n()).done;){i=o.value,u=i.getCreators?i.getCreators():[],s=c(u);try{for(s.s();!(l=s.n()).done;)((f=l.value).firstName||f.lastName)&&(p=this.buildRawName(f),r.push(p))}catch(e){s.e(e)}finally{s.f()}}}catch(e){n.e(e)}finally{n.f()}for(this.learningEngine.constructor.prototype.extractSurnamesWithFrequency||this.nameParser.constructor.prototype.extractSurnamesWithFrequency,y={},m=0,h=r;m<h.length;m++)v=h[m],(d=this.nameParser.parse(v)).lastName&&(g=d.lastName.toLowerCase().trim(),y[g]=(y[g]||0)+1);for(b=Object.keys(y),w=[],S=0;S<b.length;S++)for(N=S+1;N<b.length;N++)k=b[S],j=b[N],O=this.calculateLevenshteinDistance(k,j),P=Math.max(k.length,j.length),(A=P>0?1-O/P:1)>=.8&&w.push({name1:k,name2:j,frequency1:y[k],frequency2:y[j],similarity:A});return e.a(2,{surnameFrequencies:y,potentialVariants:w,totalNames:r.length,uniqueSurnames:b.length})}},e,this)})),function(e){return n.apply(this,arguments)})},{key:"calculateLevenshteinDistance",value:function(e,t){var r=[];if(0===e.length)return t.length;if(0===t.length)return e.length;for(var n=0;n<=t.length;n++)r[n]=[n];for(var a=0;a<=e.length;a++)r[0][a]=a;for(var o=1;o<=t.length;o++)for(var i=1;i<=e.length;i++)t.charAt(o-1)===e.charAt(i-1)?r[o][i]=r[o-1][i-1]:r[o][i]=Math.min(r[o-1][i-1]+1,r[o][i-1]+1,r[o-1][i]+1);return r[t.length][e.length]}}],t&&y(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,n,o,i,s}();e.exports&&(e.exports=h)},95:(e,t,r)=>{function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function a(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,a,o,i,u=[],s=!0,c=!1;try{if(o=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;s=!1}else for(;!(s=(n=o.call(r)).done)&&(u.push(n.value),u.length!==t);s=!0);}catch(e){c=!0,a=e}finally{try{if(!s&&null!=r.return&&(i=r.return(),Object(i)!==i))return}finally{if(c)throw a}}return u}}(e,t)||l(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=l(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,u=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return i=e.done,e},e:function(e){u=!0,o=e},f:function(){try{i||null==r.return||r.return()}finally{if(u)throw o}}}}function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function u(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i(Object(r),!0).forEach(function(t){s(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function s(e,t,r){return(t=d(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function c(e){return function(e){if(Array.isArray(e))return f(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||l(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function l(e,t){if(e){if("string"==typeof e)return f(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?f(e,t):void 0}}function f(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function p(){var e,t,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",a=r.toStringTag||"@@toStringTag";function o(r,n,a,o){var s=n&&n.prototype instanceof u?n:u,c=Object.create(s.prototype);return y(c,"_invoke",function(r,n,a){var o,u,s,c=0,l=a||[],f=!1,p={p:0,n:0,v:e,a:y,f:y.bind(e,4),d:function(t,r){return o=t,u=0,s=e,p.n=r,i}};function y(r,n){for(u=r,s=n,t=0;!f&&c&&!a&&t<l.length;t++){var a,o=l[t],y=p.p,m=o[2];r>3?(a=m===n)&&(s=o[(u=o[4])?5:(u=3,3)],o[4]=o[5]=e):o[0]<=y&&((a=r<2&&y<o[1])?(u=0,p.v=n,p.n=o[1]):y<m&&(a=r<3||o[0]>n||n>m)&&(o[4]=r,o[5]=n,p.n=m,u=0))}if(a||r>1)return i;throw f=!0,n}return function(a,l,m){if(c>1)throw TypeError("Generator is already running");for(f&&1===l&&y(l,m),u=l,s=m;(t=u<2?e:s)||!f;){o||(u?u<3?(u>1&&(p.n=-1),y(u,s)):p.n=s:p.v=s);try{if(c=2,o){if(u||(a="next"),t=o[a]){if(!(t=t.call(o,s)))throw TypeError("iterator result is not an object");if(!t.done)return t;s=t.value,u<2&&(u=0)}else 1===u&&(t=o.return)&&t.call(o),u<2&&(s=TypeError("The iterator does not provide a '"+a+"' method"),u=1);o=e}else if((t=(f=p.n<0)?s:r.call(n,p))!==i)break}catch(t){o=e,u=1,s=t}finally{c=1}}return{value:t,done:f}}}(r,a,o),!0),c}var i={};function u(){}function s(){}function c(){}t=Object.getPrototypeOf;var l=[][n]?t(t([][n]())):(y(t={},n,function(){return this}),t),f=c.prototype=u.prototype=Object.create(l);function m(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,c):(e.__proto__=c,y(e,a,"GeneratorFunction")),e.prototype=Object.create(f),e}return s.prototype=c,y(f,"constructor",c),y(c,"constructor",s),s.displayName="GeneratorFunction",y(c,a,"GeneratorFunction"),y(f),y(f,a,"Generator"),y(f,n,function(){return this}),y(f,"toString",function(){return"[object Generator]"}),(p=function(){return{w:o,m}})()}function y(e,t,r,n){var a=Object.defineProperty;try{a({},"",{})}catch(e){a=0}y=function(e,t,r,n){function o(t,r){y(e,t,function(e){return this._invoke(t,r,e)})}t?a?a(e,t,{value:r,enumerable:!n,configurable:!n,writable:!n}):e[t]=r:(o("next",0),o("throw",1),o("return",2))},y(e,t,r,n)}function m(e,t,r,n,a,o,i){try{var u=e[o](i),s=u.value}catch(e){return void r(e)}u.done?t(s):Promise.resolve(s).then(n,a)}function h(e){return function(){var t=this,r=arguments;return new Promise(function(n,a){var o=e.apply(t,r);function i(e){m(o,n,a,i,u,"next",e)}function u(e){m(o,n,a,i,u,"throw",e)}i(void 0)})}}function v(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,d(n.key),n)}}function d(e){var t=function(e){if("object"!=n(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=n(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==n(t)?t:t+""}var g=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.storageKey="ner_normalizer_mappings",this.settingsKey="ner_normalizer_settings",this.mappings=new Map,this.settings=this.getDefaultSettings(),this.loadMappings(),this.loadSettings()},t=[{key:"getStorage",value:function(){return"undefined"!=typeof localStorage?localStorage:"undefined"!=typeof window&&window.localStorage?window.localStorage:(r.g._nerStorage||(r.g._nerStorage={}),{getItem:function(e){return r.g._nerStorage[e]||null},setItem:function(e,t){r.g._nerStorage[e]=t},removeItem:function(e){delete r.g._nerStorage[e]}})}},{key:"loadMappings",value:(d=h(p().m(function e(){var t,r,n;return p().w(function(e){for(;;)switch(e.n){case 0:try{t=this.getStorage(),(r=t.getItem(this.storageKey))&&(n=JSON.parse(r),this.mappings=new Map(n))}catch(e){console.error("Error loading mappings:",e),this.mappings=new Map}case 1:return e.a(2)}},e,this)})),function(){return d.apply(this,arguments)})},{key:"saveMappings",value:(m=h(p().m(function e(){var t,r;return p().w(function(e){for(;;)switch(e.n){case 0:try{t=this.getStorage(),r=JSON.stringify(c(this.mappings.entries())),t.setItem(this.storageKey,r)}catch(e){console.error("Error saving mappings:",e)}case 1:return e.a(2)}},e,this)})),function(){return m.apply(this,arguments)})},{key:"loadSettings",value:(y=h(p().m(function e(){var t,r;return p().w(function(e){for(;;)switch(e.n){case 0:try{t=this.getStorage(),(r=t.getItem(this.settingsKey))&&(this.settings=u(u({},this.getDefaultSettings()),JSON.parse(r)))}catch(e){console.error("Error loading settings:",e),this.settings=this.getDefaultSettings()}case 1:return e.a(2)}},e,this)})),function(){return y.apply(this,arguments)})},{key:"saveSettings",value:(f=h(p().m(function e(){return p().w(function(e){for(;;)switch(e.n){case 0:try{this.getStorage().setItem(this.settingsKey,JSON.stringify(this.settings))}catch(e){console.error("Error saving settings:",e)}case 1:return e.a(2)}},e,this)})),function(){return f.apply(this,arguments)})},{key:"getDefaultSettings",value:function(){return{autoApplyLearned:!0,confidenceThreshold:.8,enableSpanishSurnameDetection:!0,showSimilarityScore:!0,maxSuggestions:5}}},{key:"storeMapping",value:(l=h(p().m(function e(t,r){var n,a,o,i,s,c=arguments;return p().w(function(e){for(;;)switch(e.n){case 0:return n=c.length>2&&void 0!==c[2]?c[2]:1,a=c.length>3&&void 0!==c[3]?c[3]:{},o=this.createCanonicalKey(t),i=Date.now(),this.mappings.has(o)?((s=this.mappings.get(o)).normalized=r,s.confidence=Math.max(s.confidence,n),s.lastUsed=i,s.usageCount=(s.usageCount||0)+1,s.context=u(u({},s.context),a)):this.mappings.set(o,{raw:t,normalized:r,timestamp:i,lastUsed:i,confidence:n,usageCount:1,context:a}),e.n=1,this.saveMappings();case 1:return e.a(2)}},e,this)})),function(e,t){return l.apply(this,arguments)})},{key:"recordUsage",value:(s=h(p().m(function e(t){var r,n;return p().w(function(e){for(;;)switch(e.n){case 0:if(r=this.createCanonicalKey(t),!(n=this.mappings.get(r))){e.n=1;break}return n.lastUsed=Date.now(),n.usageCount=(n.usageCount||0)+1,e.n=1,this.saveMappings();case 1:return e.a(2)}},e,this)})),function(e){return s.apply(this,arguments)})},{key:"getMapping",value:function(e){var t=this.createCanonicalKey(e),r=this.mappings.get(t);return r?(this.recordUsage(e),r.normalized):null}},{key:"hasMapping",value:function(e){var t=this.createCanonicalKey(e);return this.mappings.has(t)}},{key:"getMappingDetails",value:function(e){var t=this.createCanonicalKey(e),r=this.mappings.get(t);return r?(this.recordUsage(e),u({},r)):null}},{key:"getAllMappings",value:function(){return new Map(this.mappings)}},{key:"removeMapping",value:(i=h(p().m(function e(t){var r;return p().w(function(e){for(;;)switch(e.n){case 0:return r=this.createCanonicalKey(t),this.mappings.delete(r),e.n=1,this.saveMappings();case 1:return e.a(2)}},e,this)})),function(e){return i.apply(this,arguments)})},{key:"clearAllMappings",value:(n=h(p().m(function e(){return p().w(function(e){for(;;)switch(e.n){case 0:return this.mappings.clear(),e.n=1,this.saveMappings();case 1:return e.a(2)}},e,this)})),function(){return n.apply(this,arguments)})},{key:"createCanonicalKey",value:function(e){return e.trim().toLowerCase().replace(/[.,]/g,"").replace(/\s+/g," ")}},{key:"findSimilar",value:function(e){var t,r=this.createCanonicalKey(e),n=[],i=o(this.mappings);try{for(i.s();!(t=i.n()).done;){var s=a(t.value,2),c=s[0],l=s[1],f=this.calculateSimilarity(r,c);f>=this.settings.confidenceThreshold&&n.push(u(u({},l),{},{similarity:f}))}}catch(e){i.e(e)}finally{i.f()}return n.sort(function(e,t){return t.similarity!==e.similarity?t.similarity-e.similarity:(t.usageCount||0)-(e.usageCount||0)}).slice(0,this.settings.maxSuggestions)}},{key:"calculateSimilarity",value:function(e,t){return.5*this.jaroWinklerSimilarity(e,t)+.3*this.lcsSimilarity(e,t)+.2*this.initialMatchingSimilarity(e,t)}},{key:"jaroWinklerSimilarity",value:function(e,t){if(e===t)return 1;if(!e||!t)return 0;for(var r=[],n=e.length,a=t.length,o=Math.floor(Math.max(n,a)/2)-1,i=0,u=0,s=new Array(n).fill(!1),c=new Array(a).fill(!1),l=0;l<n;l++)for(var f=Math.max(0,l-o),p=Math.min(l+o+1,a),y=f;y<p;y++)if(!c[y]&&e[l]===t[y]){s[l]=c[y]=!0,i++,r.push(e[l]);break}if(0===i)return 0;for(var m=0,h=0;h<n;h++)if(s[h]){for(;!c[m];)m++;e[h]!==t[m]&&u++,m++}for(var v=(i/n+i/a+(i-u/2)/i)/3,d=0,g=Math.min(4,Math.min(e.length,t.length)),b=0;b<g&&e[b]===t[b];b++)d++;return v+.1*d*(1-v)}},{key:"lcsSimilarity",value:function(e,t){var r=this;if(!e||!t)return 0;if(e===t)return 1;var n,a=e.split(/\s+/),i=t.split(/\s+/),u=0,s=o(a);try{var c=function(){var e=n.value;i.some(function(t){return r.isSimilarWord(e,t)})&&u++};for(s.s();!(n=s.n()).done;)c()}catch(e){s.e(e)}finally{s.f()}var l=Math.max(a.length,i.length);return l>0?u/l:0}},{key:"isSimilarWord",value:function(e,t){if((e=e.replace(/\./g,""))===(t=t.replace(/\./g,"")))return!0;if(1===e.length&&t.startsWith(e)||1===t.length&&e.startsWith(t))return!0;var r={jose:"joseph",joseph:"joe",robert:"rob",charles:"chuck",william:"will",jonathan:"jon"};return r[e]===t||r[t]===e}},{key:"areWordsSimilar",value:function(e,t){return this.isSimilarWord(e,t)}},{key:"isAbbreviation",value:function(e,t){if(e.length>=t.length)return!1;for(var r=0;r<e.length;r++)if(t[r]!==e[r])return!1;return!0}},{key:"initialMatchingSimilarity",value:function(e,t){var r=e.split(/\s+/),n=t.split(/\s+/);return 0===r.length||0===n.length?0:(this.compareNameParts(r[0],n[0])+this.compareNameParts(r[r.length-1],n[n.length-1]))/2}},{key:"compareNameParts",value:function(e,t){if(!e||!t)return 0;if(e.toLowerCase()===t.toLowerCase())return 1;var r=e.replace(/\./g,"").toLowerCase(),n=t.replace(/\./g,"").toLowerCase();return 1===r.length&&n.startsWith(r)||1===n.length&&r.startsWith(n)?.8:this.jaroWinklerSimilarity(r,n)}},{key:"exportMappings",value:function(){return{version:"1.0",timestamp:Date.now(),mappings:c(this.mappings.entries()),settings:this.settings}}},{key:"importMappings",value:function(e){if("1.0"!==e.version)throw new Error("Unsupported import data version");this.mappings=new Map(e.mappings),e.settings&&(this.settings=u(u({},this.settings),e.settings),this.saveSettings()),this.saveMappings()}},{key:"getStatistics",value:function(){var e,t=this.mappings.size,r=0,n=0,a=o(this.mappings.values());try{for(a.s();!(e=a.n()).done;){var i=e.value;r+=i.usageCount||0,n+=i.confidence||0}}catch(e){a.e(e)}finally{a.f()}return{totalMappings:t,totalUsage:r,averageUsage:t>0?r/t:0,averageConfidence:n=t>0?n/t:0}}}],t&&v(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,n,i,s,l,f,y,m,d}();e.exports&&(e.exports=g)},208:e=>{function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t(e)}function r(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return n(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?n(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var a=0,o=function(){};return{s:o,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,u=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return u=e.done,e},e:function(e){s=!0,i=e},f:function(){try{u||null==r.return||r.return()}finally{if(s)throw i}}}}function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function a(){var e,t,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",i=r.toStringTag||"@@toStringTag";function u(r,n,a,i){var u=n&&n.prototype instanceof c?n:c,l=Object.create(u.prototype);return o(l,"_invoke",function(r,n,a){var o,i,u,c=0,l=a||[],f=!1,p={p:0,n:0,v:e,a:y,f:y.bind(e,4),d:function(t,r){return o=t,i=0,u=e,p.n=r,s}};function y(r,n){for(i=r,u=n,t=0;!f&&c&&!a&&t<l.length;t++){var a,o=l[t],y=p.p,m=o[2];r>3?(a=m===n)&&(u=o[(i=o[4])?5:(i=3,3)],o[4]=o[5]=e):o[0]<=y&&((a=r<2&&y<o[1])?(i=0,p.v=n,p.n=o[1]):y<m&&(a=r<3||o[0]>n||n>m)&&(o[4]=r,o[5]=n,p.n=m,i=0))}if(a||r>1)return s;throw f=!0,n}return function(a,l,m){if(c>1)throw TypeError("Generator is already running");for(f&&1===l&&y(l,m),i=l,u=m;(t=i<2?e:u)||!f;){o||(i?i<3?(i>1&&(p.n=-1),y(i,u)):p.n=u:p.v=u);try{if(c=2,o){if(i||(a="next"),t=o[a]){if(!(t=t.call(o,u)))throw TypeError("iterator result is not an object");if(!t.done)return t;u=t.value,i<2&&(i=0)}else 1===i&&(t=o.return)&&t.call(o),i<2&&(u=TypeError("The iterator does not provide a '"+a+"' method"),i=1);o=e}else if((t=(f=p.n<0)?u:r.call(n,p))!==s)break}catch(t){o=e,i=1,u=t}finally{c=1}}return{value:t,done:f}}}(r,a,i),!0),l}var s={};function c(){}function l(){}function f(){}t=Object.getPrototypeOf;var p=[][n]?t(t([][n]())):(o(t={},n,function(){return this}),t),y=f.prototype=c.prototype=Object.create(p);function m(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,f):(e.__proto__=f,o(e,i,"GeneratorFunction")),e.prototype=Object.create(y),e}return l.prototype=f,o(y,"constructor",f),o(f,"constructor",l),l.displayName="GeneratorFunction",o(f,i,"GeneratorFunction"),o(y),o(y,i,"Generator"),o(y,n,function(){return this}),o(y,"toString",function(){return"[object Generator]"}),(a=function(){return{w:u,m}})()}function o(e,t,r,n){var a=Object.defineProperty;try{a({},"",{})}catch(e){a=0}o=function(e,t,r,n){function i(t,r){o(e,t,function(e){return this._invoke(t,r,e)})}t?a?a(e,t,{value:r,enumerable:!n,configurable:!n,writable:!n}):e[t]=r:(i("next",0),i("throw",1),i("return",2))},o(e,t,r,n)}function i(e,t,r,n,a,o,i){try{var u=e[o](i),s=u.value}catch(e){return void r(e)}u.done?t(s):Promise.resolve(s).then(n,a)}function u(e){return function(){var t=this,r=arguments;return new Promise(function(n,a){var o=e.apply(t,r);function u(e){i(o,n,a,u,s,"next",e)}function s(e){i(o,n,a,u,s,"throw",e)}u(void 0)})}}function s(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,c(n.key),n)}}function c(e){var r=function(e){if("object"!=t(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!=t(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==t(r)?r:r+""}var l=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.model=null,this.isInitialized=!1,this.entities=["person","first_name","middle_name","last_name","prefix","suffix"]},t=[{key:"initialize",value:(i=u(a().m(function e(){var t=this;return a().w(function(e){for(;;)switch(e.n){case 0:console.log("Initializing GLINER model handler...");try{"undefined"!=typeof ort?console.log("ONNX model loaded successfully"):(console.log("ONNX runtime not available, using mock implementation"),this.model={run:function(){var e=u(a().m(function e(r){return a().w(function(e){for(;;)if(0===e.n)return e.a(2,t.mockNERResult(r))},e)}));return function(t){return e.apply(this,arguments)}}()}),this.isInitialized=!0,console.log("GLINER model handler initialized")}catch(e){console.error("Error initializing GLINER model:",e),this.model=null,this.isInitialized=!1}case 1:return e.a(2)}},e,this)})),function(){return i.apply(this,arguments)})},{key:"mockNERResult",value:function(e){for(var t=e.text||e[0]||"",r=t.split(/\s+/),n=[],a=0;a<r.length;a++){var o=r[a],i="O";/^[A-Z]\.?$/.test(o)?i="initial":/^[A-Z][a-z]+/.test(o)&&0===a?i="first_name":/^[A-Z][a-z]+/.test(o)&&a===r.length-1?i="last_name":["van","de","la","von","del","di","du","le","lo"].includes(o.toLowerCase())&&(i="prefix"),n.push({word:o,start:t.indexOf(o),end:t.indexOf(o)+o.length,label:i})}return{entities:n}}},{key:"runNER",value:(o=u(a().m(function e(t){var r,n,o;return a().w(function(e){for(;;)switch(e.p=e.n){case 0:if(this.isInitialized){e.n=1;break}return e.n=1,this.initialize();case 1:if(this.model){e.n=2;break}return e.a(2,this.ruleBasedNER(t));case 2:return e.p=2,r={text:t},e.n=3,this.model.run(r);case 3:return n=e.v,e.a(2,n.entities||[]);case 4:return e.p=4,o=e.v,console.error("Error running NER:",o),e.a(2,this.ruleBasedNER(t))}},e,this,[[2,4]])})),function(e){return o.apply(this,arguments)})},{key:"ruleBasedNER",value:function(e){for(var t=e.split(/\s+/),r=[],n=["van","de","la","von","del","di","du","le","lo","da","des","dos","das","el","al"],a=["Jr","Sr","II","III","IV","PhD","MD","Jr.","Sr."],o=function(){var o=t[i].replace(/[.,]/g,""),u=t[i],s="O";a.some(function(e){return e.toLowerCase()===o.toLowerCase()})?s="suffix":n.includes(o.toLowerCase())?s="prefix":/^[A-Z]\.?$/.test(o)?s="initial":0===i?s="first_name":i===t.length-1?s="last_name":i>0&&i<t.length-1&&(s="middle_name"),r.push({text:u,start:e.indexOf(u),end:e.indexOf(u)+u.length,label:s})},i=0;i<t.length;i++)o();return r}},{key:"runBatchNER",value:(n=u(a().m(function e(t){var n,o,i,u,s,c;return a().w(function(e){for(;;)switch(e.p=e.n){case 0:n=[],o=r(t),e.p=1,o.s();case 2:if((i=o.n()).done){e.n=5;break}return u=i.value,e.n=3,this.runNER(u);case 3:s=e.v,n.push({text:u,entities:s});case 4:e.n=2;break;case 5:e.n=7;break;case 6:e.p=6,c=e.v,o.e(c);case 7:return e.p=7,o.f(),e.f(7);case 8:return e.a(2,n)}},e,this,[[1,6,7,8]])})),function(e){return n.apply(this,arguments)})}],t&&s(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,n,o,i}();e.exports=l},388:(e,t,r)=>{function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function a(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return o(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?o(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,u=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return u=e.done,e},e:function(e){s=!0,i=e},f:function(){try{u||null==r.return||r.return()}finally{if(s)throw i}}}}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function i(){var e,t,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",a=r.toStringTag||"@@toStringTag";function o(r,n,a,o){var i=n&&n.prototype instanceof c?n:c,l=Object.create(i.prototype);return u(l,"_invoke",function(r,n,a){var o,i,u,c=0,l=a||[],f=!1,p={p:0,n:0,v:e,a:y,f:y.bind(e,4),d:function(t,r){return o=t,i=0,u=e,p.n=r,s}};function y(r,n){for(i=r,u=n,t=0;!f&&c&&!a&&t<l.length;t++){var a,o=l[t],y=p.p,m=o[2];r>3?(a=m===n)&&(u=o[(i=o[4])?5:(i=3,3)],o[4]=o[5]=e):o[0]<=y&&((a=r<2&&y<o[1])?(i=0,p.v=n,p.n=o[1]):y<m&&(a=r<3||o[0]>n||n>m)&&(o[4]=r,o[5]=n,p.n=m,i=0))}if(a||r>1)return s;throw f=!0,n}return function(a,l,m){if(c>1)throw TypeError("Generator is already running");for(f&&1===l&&y(l,m),i=l,u=m;(t=i<2?e:u)||!f;){o||(i?i<3?(i>1&&(p.n=-1),y(i,u)):p.n=u:p.v=u);try{if(c=2,o){if(i||(a="next"),t=o[a]){if(!(t=t.call(o,u)))throw TypeError("iterator result is not an object");if(!t.done)return t;u=t.value,i<2&&(i=0)}else 1===i&&(t=o.return)&&t.call(o),i<2&&(u=TypeError("The iterator does not provide a '"+a+"' method"),i=1);o=e}else if((t=(f=p.n<0)?u:r.call(n,p))!==s)break}catch(t){o=e,i=1,u=t}finally{c=1}}return{value:t,done:f}}}(r,a,o),!0),l}var s={};function c(){}function l(){}function f(){}t=Object.getPrototypeOf;var p=[][n]?t(t([][n]())):(u(t={},n,function(){return this}),t),y=f.prototype=c.prototype=Object.create(p);function m(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,f):(e.__proto__=f,u(e,a,"GeneratorFunction")),e.prototype=Object.create(y),e}return l.prototype=f,u(y,"constructor",f),u(f,"constructor",l),l.displayName="GeneratorFunction",u(f,a,"GeneratorFunction"),u(y),u(y,a,"Generator"),u(y,n,function(){return this}),u(y,"toString",function(){return"[object Generator]"}),(i=function(){return{w:o,m}})()}function u(e,t,r,n){var a=Object.defineProperty;try{a({},"",{})}catch(e){a=0}u=function(e,t,r,n){function o(t,r){u(e,t,function(e){return this._invoke(t,r,e)})}t?a?a(e,t,{value:r,enumerable:!n,configurable:!n,writable:!n}):e[t]=r:(o("next",0),o("throw",1),o("return",2))},u(e,t,r,n)}function s(e,t,r,n,a,o,i){try{var u=e[o](i),s=u.value}catch(e){return void r(e)}u.done?t(s):Promise.resolve(s).then(n,a)}function c(e){return function(){var t=this,r=arguments;return new Promise(function(n,a){var o=e.apply(t,r);function i(e){s(o,n,a,i,u,"next",e)}function u(e){s(o,n,a,i,u,"throw",e)}i(void 0)})}}function l(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,f(n.key),n)}}function f(e){var t=function(e){if("object"!=n(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=n(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==n(t)?t:t+""}var p=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.glinerHandler=null,this.isInitialized=!1,this.entities=["PERSON","FIRST_NAME","MIDDLE_NAME","LAST_NAME","PREFIX","SUFFIX"]},t=[{key:"initialize",value:(s=c(i().m(function e(){var t,n;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:return t=r(208),this.glinerHandler=new t,e.p=1,e.n=2,this.glinerHandler.initialize();case 2:console.log("NER Processor initialized with GLINER handler"),e.n=4;break;case 3:e.p=3,n=e.v,console.error("Error initializing GLINER handler:",n),console.log("Using fallback rule-based processing");case 4:this.isInitialized=!0;case 5:return e.a(2)}},e,this,[[1,3]])})),function(){return s.apply(this,arguments)})},{key:"processText",value:(u=c(i().m(function e(t){return i().w(function(e){for(;;)switch(e.n){case 0:if(this.isInitialized){e.n=1;break}return e.n=1,this.initialize();case 1:if(!this.glinerHandler||!this.glinerHandler.isInitialized){e.n=3;break}return e.n=2,this.glinerHandler.runNER(t);case 2:return e.a(2,e.v);case 3:return e.a(2,this.fallbackNER(t));case 4:return e.a(2)}},e,this)})),function(e){return u.apply(this,arguments)})},{key:"fallbackNER",value:function(e){for(var t=e.split(/\s+/),r=[],n=["van","de","la","von","del","di","du","le","lo","da","des","dos","das","el","al"],a=["Jr","Sr","II","III","IV","PhD","MD","Jr.","Sr."],o=function(){var o=t[i].replace(/[.,]/g,""),u=t[i],s="O";a.some(function(e){return e.toLowerCase()===o.toLowerCase()})?s="suffix":n.includes(o.toLowerCase())?s="prefix":/^[A-Z]\.?$/.test(o)?s="initial":0===i?s="first_name":i===t.length-1?s="last_name":i>0&&i<t.length-1&&(s="middle_name"),r.push({text:u,start:e.indexOf(u),end:e.indexOf(u)+u.length,label:s})},i=0;i<t.length;i++)o();return r}},{key:"parseName",value:(o=c(i().m(function e(t){var r;return i().w(function(e){for(;;)switch(e.n){case 0:if(this.isInitialized){e.n=1;break}return e.n=1,this.initialize();case 1:return e.n=2,this.processText(t);case 2:return r=e.v,e.a(2,this.structureNameComponents(t,r))}},e,this)})),function(e){return o.apply(this,arguments)})},{key:"structureNameComponents",value:function(e,t){var n,o=(new(r(889))).parse(e),i=a(t);try{for(i.s();!(n=i.n()).done;){var u=n.value;"prefix"===u.label?o.prefix=u.text:"suffix"===u.label&&(o.suffix=u.text)}}catch(e){i.e(e)}finally{i.f()}return o}},{key:"processBatch",value:(n=c(i().m(function e(t){var r,n,o,u,s,c;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:if(this.isInitialized){e.n=1;break}return e.n=1,this.initialize();case 1:if(!this.glinerHandler||!this.glinerHandler.isInitialized){e.n=3;break}return e.n=2,this.glinerHandler.runBatchNER(t);case 2:return e.a(2,e.v);case 3:r=[],n=a(t),e.p=4,n.s();case 5:if((o=n.n()).done){e.n=8;break}return u=o.value,e.n=6,this.fallbackNER(u);case 6:s=e.v,r.push({text:u,entities:s});case 7:e.n=5;break;case 8:e.n=10;break;case 9:e.p=9,c=e.v,n.e(c);case 10:return e.p=10,n.f(),e.f(10);case 11:return e.a(2,r);case 12:return e.a(2)}},e,this,[[4,9,10,11]])})),function(e){return n.apply(this,arguments)})},{key:"getConfidence",value:function(e){var t=.5;return e.firstName&&e.lastName&&(t+=.3),e.prefix&&(t+=.1),e.suffix&&(t+=.1),e.firstName&&e.firstName.length>2&&(t+=.05),e.lastName&&e.lastName.length>2&&(t+=.05),Math.min(t,1)}},{key:"findVariantsBySimilarity",value:function(e,t){var r,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.8,o=[],i=a(t);try{for(i.s();!(r=i.n()).done;){var u=r.value,s=this.levenshteinDistance(e,u),c=1-s/Math.max(e.length,u.length);c>=n&&o.push({name:u,similarity:c,distance:s})}}catch(e){i.e(e)}finally{i.f()}return o.sort(function(e,t){return t.similarity-e.similarity})}},{key:"levenshteinDistance",value:function(e,t){var r=[];if(0===e.length)return t.length;if(0===t.length)return e.length;for(var n=0;n<=t.length;n++)r[n]=[n];for(var a=0;a<=e.length;a++)r[0][a]=a;for(var o=1;o<=t.length;o++)for(var i=1;i<=e.length;i++)t.charAt(o-1)===e.charAt(i-1)?r[o][i]=r[o-1][i-1]:r[o][i]=Math.min(r[o-1][i-1]+1,r[o][i-1]+1,r[o-1][i]+1);return r[t.length][e.length]}},{key:"extractNameFrequencies",value:function(e){var t,n={},o={},i=new(r(889)),u=a(e);try{for(u.s();!(t=u.n()).done;){var s=t.value,c=i.parse(s);if(c.lastName){var l=c.lastName.toLowerCase().trim();n[l]=(n[l]||0)+1}if(c.firstName){var f=c.firstName.toLowerCase().trim();o[f]=(o[f]||0)+1}}}catch(e){u.e(e)}finally{u.f()}return{surnames:n,firstNames:o}}}],t&&l(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,n,o,u,s}();e.exports&&(e.exports=p)},441:e=>{function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t(e)}function r(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,n(a.key),a)}}function n(e){var r=function(e){if("object"!=t(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!=t(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==t(r)?r:r+""}var a=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.variationPatterns=[this.fullForm,this.initialForm,this.lastOnlyForm,this.firstInitialLastForm,this.firstInitialsLastForm]},(t=[{key:"generateVariants",value:function(e){var t=this,r=new Set;return this.variationPatterns.forEach(function(n){var a=n.call(t,e);a&&r.add(a)}),r.add(e.original),Array.from(r)}},{key:"fullForm",value:function(e){var t=[];return e.firstName&&t.push(e.firstName),e.middleName&&t.push(e.middleName),e.prefix&&t.push(e.prefix),e.lastName&&t.push(e.lastName),t.join(" ").trim()}},{key:"initialForm",value:function(e){if(!e.firstName||!e.lastName)return null;var t=e.firstName.charAt(0).toUpperCase()+".",r="";e.middleName&&(r=e.middleName.split(/\s+/).map(function(e){return e.charAt(0).toUpperCase()+"."}).join(" "));var n=[];return n.push(t),r&&n.push(r),e.prefix&&n.push(e.prefix),n.push(e.lastName),n.join(" ").trim()}},{key:"lastOnlyForm",value:function(e){return e.lastName?e.lastName.trim():null}},{key:"firstInitialLastForm",value:function(e){if(!e.firstName||!e.lastName)return null;var t=e.firstName.charAt(0).toUpperCase()+".",r=[];return r.push(t),e.prefix&&r.push(e.prefix),r.push(e.lastName),r.join(" ").trim()}},{key:"firstInitialsLastForm",value:function(e){if(!e.firstName||!e.lastName)return null;var t=e.firstName.charAt(0).toUpperCase()+".",r="";e.middleName&&(r=e.middleName.split(/\s+/).map(function(e){return e.charAt(0).toUpperCase()+"."}).join(""));var n=[];return n.push(t+r),e.prefix&&n.push(e.prefix),n.push(e.lastName),n.join(" ").trim().replace(/\.{2,}/g,".")}},{key:"generateCanonical",value:function(e){var t=[];return e.lastName&&t.push(e.lastName.toUpperCase()),e.firstName&&t.push(e.firstName.toUpperCase()),e.middleName&&e.middleName.split(/\s+/).forEach(function(e){return t.push(e.toUpperCase())}),t.join(" ").trim()}}])&&r(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();e.exports&&(e.exports=a)},491:(e,t,r)=>{function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function a(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function o(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?a(Object(r),!0).forEach(function(t){i(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function i(e,t,r){return(t=m(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function u(){var e,t,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",a=r.toStringTag||"@@toStringTag";function o(r,n,a,o){var u=n&&n.prototype instanceof c?n:c,l=Object.create(u.prototype);return s(l,"_invoke",function(r,n,a){var o,u,s,c=0,l=a||[],f=!1,p={p:0,n:0,v:e,a:y,f:y.bind(e,4),d:function(t,r){return o=t,u=0,s=e,p.n=r,i}};function y(r,n){for(u=r,s=n,t=0;!f&&c&&!a&&t<l.length;t++){var a,o=l[t],y=p.p,m=o[2];r>3?(a=m===n)&&(s=o[(u=o[4])?5:(u=3,3)],o[4]=o[5]=e):o[0]<=y&&((a=r<2&&y<o[1])?(u=0,p.v=n,p.n=o[1]):y<m&&(a=r<3||o[0]>n||n>m)&&(o[4]=r,o[5]=n,p.n=m,u=0))}if(a||r>1)return i;throw f=!0,n}return function(a,l,m){if(c>1)throw TypeError("Generator is already running");for(f&&1===l&&y(l,m),u=l,s=m;(t=u<2?e:s)||!f;){o||(u?u<3?(u>1&&(p.n=-1),y(u,s)):p.n=s:p.v=s);try{if(c=2,o){if(u||(a="next"),t=o[a]){if(!(t=t.call(o,s)))throw TypeError("iterator result is not an object");if(!t.done)return t;s=t.value,u<2&&(u=0)}else 1===u&&(t=o.return)&&t.call(o),u<2&&(s=TypeError("The iterator does not provide a '"+a+"' method"),u=1);o=e}else if((t=(f=p.n<0)?s:r.call(n,p))!==i)break}catch(t){o=e,u=1,s=t}finally{c=1}}return{value:t,done:f}}}(r,a,o),!0),l}var i={};function c(){}function l(){}function f(){}t=Object.getPrototypeOf;var p=[][n]?t(t([][n]())):(s(t={},n,function(){return this}),t),y=f.prototype=c.prototype=Object.create(p);function m(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,f):(e.__proto__=f,s(e,a,"GeneratorFunction")),e.prototype=Object.create(y),e}return l.prototype=f,s(y,"constructor",f),s(f,"constructor",l),l.displayName="GeneratorFunction",s(f,a,"GeneratorFunction"),s(y),s(y,a,"Generator"),s(y,n,function(){return this}),s(y,"toString",function(){return"[object Generator]"}),(u=function(){return{w:o,m}})()}function s(e,t,r,n){var a=Object.defineProperty;try{a({},"",{})}catch(e){a=0}s=function(e,t,r,n){function o(t,r){s(e,t,function(e){return this._invoke(t,r,e)})}t?a?a(e,t,{value:r,enumerable:!n,configurable:!n,writable:!n}):e[t]=r:(o("next",0),o("throw",1),o("return",2))},s(e,t,r,n)}function c(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return l(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?l(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,u=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return i=e.done,e},e:function(e){u=!0,o=e},f:function(){try{i||null==r.return||r.return()}finally{if(u)throw o}}}}function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function f(e,t,r,n,a,o,i){try{var u=e[o](i),s=u.value}catch(e){return void r(e)}u.done?t(s):Promise.resolve(s).then(n,a)}function p(e){return function(){var t=this,r=arguments;return new Promise(function(n,a){var o=e.apply(t,r);function i(e){f(o,n,a,i,u,"next",e)}function u(e){f(o,n,a,i,u,"throw",e)}i(void 0)})}}function y(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,m(n.key),n)}}function m(e){var t=function(e){if("object"!=n(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=n(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==n(t)?t:t+""}var h=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.learningEngine=new(r(95)),this.variantGenerator=new(r(441)),this.nameParser=new(r(889))},t=[{key:"showDialog",value:(i=p(u().m(function e(t){var r,n,a,o,i,s;return u().w(function(e){for(;;)switch(e.p=e.n){case 0:console.log("Showing normalization dialog for",t.length,"items"),r=[],n=c(t),e.p=1,n.s();case 2:if((a=n.n()).done){e.n=5;break}return o=a.value,e.n=3,this.processItem(o);case 3:i=e.v,r.push(i);case 4:e.n=2;break;case 5:e.n=7;break;case 6:e.p=6,s=e.v,n.e(s);case 7:return e.p=7,n.f(),e.f(7);case 8:return e.n=9,this.presentOptions(r);case 9:return e.a(2,e.v)}},e,this,[[1,6,7,8]])})),function(e){return i.apply(this,arguments)})},{key:"processItem",value:(a=p(u().m(function e(t){var r,n,a,i,s,l,f,p,y,m,h;return u().w(function(e){for(;;)switch(e.p=e.n){case 0:r=t.getCreators?t.getCreators():[],n=[],a=c(r),e.p=1,a.s();case 2:if((i=a.n()).done){e.n=5;break}if(!(s=i.value).firstName&&!s.lastName){e.n=4;break}if(l=this.buildRawName(s),!(f=this.learningEngine.getMapping(l))){e.n=3;break}return n.push({original:o({},s),normalized:f,type:s.creatorType,alreadyLearned:!0,status:"learned"}),e.a(3,4);case 3:p=this.learningEngine.findSimilar(l),y=this.nameParser.parse(l),m=this.variantGenerator.generateVariants(y),n.push({original:o({},s),rawName:l,variants:m,similars:p,type:s.creatorType,alreadyLearned:!1,parsed:y,status:"new"});case 4:e.n=2;break;case 5:e.n=7;break;case 6:e.p=6,h=e.v,a.e(h);case 7:return e.p=7,a.f(),e.f(7);case 8:return e.a(2,{itemID:t.id,title:t.getField?t.getField("title"):"Unknown Title",creators:n})}},e,this,[[1,6,7,8]])})),function(e){return a.apply(this,arguments)})},{key:"buildRawName",value:function(e){return"".concat(e.firstName||""," ").concat(e.lastName||"").trim()}},{key:"presentOptions",value:(n=p(u().m(function e(t){var r,n,a,o,i,s,l,f,p;return u().w(function(e){for(;;)if(0===e.n){console.log("Presenting options to user:"),r=[],n=c(t);try{for(n.s();!(a=n.n()).done;){o=a.value,i={itemID:o.itemID,title:o.title,creators:[]},s=c(o.creators);try{for(s.s();!(l=s.n()).done;)(f=l.value).alreadyLearned?i.creators.push({original:f.original,normalized:f.normalized,type:f.type,accepted:!0,source:"learned"}):(p=f.variants[0],i.creators.push({original:f.original,normalized:p,type:f.type,accepted:!0,source:"user_selected",selectedFrom:"variants"}))}catch(e){s.e(e)}finally{s.f()}r.push(i)}}catch(e){n.e(e)}finally{n.f()}return e.a(2,r)}},e)})),function(e){return n.apply(this,arguments)})},{key:"renderUIDemo",value:function(e){var t,r='<div class="ner-normalizer-dialog"><h2>Author Name Normalization</h2>',n=c(e);try{for(n.s();!(t=n.n()).done;){var a=t.value;r+='<div class="item-section" data-item-id="'.concat(a.itemID,'">'),r+="<h3>".concat(a.title,"</h3>");var o,i=c(a.creators);try{for(i.s();!(o=i.n()).done;){var u=o.value;if(r+='<div class="creator-section">',u.alreadyLearned)r+="<p><strong>Learned:</strong> ".concat(u.rawName,"  ").concat(u.normalized,"</p>");else{r+="<p><strong>Original:</strong> ".concat(u.rawName,"</p>"),r+='<div class="variants-section">',r+="<h4>Variant Suggestions:</h4><ul>";var s,l=c(u.variants);try{for(l.s();!(s=l.n()).done;){var f=s.value;r+='<li><label><input type="radio" name="selection-'.concat(u.rawName,'" value="').concat(f,'"> ').concat(f,"</label></li>")}}catch(e){l.e(e)}finally{l.f()}if(r+="</ul></div>",u.similars.length>0){r+='<div class="similar-section">',r+="<h4>Similar Previously Learned Names:</h4><ul>";var p,y=c(u.similars);try{for(y.s();!(p=y.n()).done;){var m=p.value;r+='<li><label><input type="radio" name="selection-'.concat(u.rawName,'" value="').concat(m.normalized,'"> ').concat(m.raw,"  ").concat(m.normalized," (confidence: ").concat((100*m.similarity).toFixed(1),"%)</label></li>")}}catch(e){y.e(e)}finally{y.f()}r+="</ul></div>"}}r+="</div>"}}catch(e){i.e(e)}finally{i.f()}r+="</div>"}}catch(e){n.e(e)}finally{n.f()}return r+='<div class="dialog-actions">',r+='<button id="accept-all-btn">Accept All</button>',(r+='<button id="cancel-btn">Cancel</button>')+"</div></div>"}}],t&&y(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,n,a,i}();e.exports&&(e.exports=h)},588:e=>{function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t(e)}function r(e){return function(e){if(Array.isArray(e))return n(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return n(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?n(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function a(){var e,t,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",i=r.toStringTag||"@@toStringTag";function u(r,n,a,i){var u=n&&n.prototype instanceof c?n:c,l=Object.create(u.prototype);return o(l,"_invoke",function(r,n,a){var o,i,u,c=0,l=a||[],f=!1,p={p:0,n:0,v:e,a:y,f:y.bind(e,4),d:function(t,r){return o=t,i=0,u=e,p.n=r,s}};function y(r,n){for(i=r,u=n,t=0;!f&&c&&!a&&t<l.length;t++){var a,o=l[t],y=p.p,m=o[2];r>3?(a=m===n)&&(u=o[(i=o[4])?5:(i=3,3)],o[4]=o[5]=e):o[0]<=y&&((a=r<2&&y<o[1])?(i=0,p.v=n,p.n=o[1]):y<m&&(a=r<3||o[0]>n||n>m)&&(o[4]=r,o[5]=n,p.n=m,i=0))}if(a||r>1)return s;throw f=!0,n}return function(a,l,m){if(c>1)throw TypeError("Generator is already running");for(f&&1===l&&y(l,m),i=l,u=m;(t=i<2?e:u)||!f;){o||(i?i<3?(i>1&&(p.n=-1),y(i,u)):p.n=u:p.v=u);try{if(c=2,o){if(i||(a="next"),t=o[a]){if(!(t=t.call(o,u)))throw TypeError("iterator result is not an object");if(!t.done)return t;u=t.value,i<2&&(i=0)}else 1===i&&(t=o.return)&&t.call(o),i<2&&(u=TypeError("The iterator does not provide a '"+a+"' method"),i=1);o=e}else if((t=(f=p.n<0)?u:r.call(n,p))!==s)break}catch(t){o=e,i=1,u=t}finally{c=1}}return{value:t,done:f}}}(r,a,i),!0),l}var s={};function c(){}function l(){}function f(){}t=Object.getPrototypeOf;var p=[][n]?t(t([][n]())):(o(t={},n,function(){return this}),t),y=f.prototype=c.prototype=Object.create(p);function m(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,f):(e.__proto__=f,o(e,i,"GeneratorFunction")),e.prototype=Object.create(y),e}return l.prototype=f,o(y,"constructor",f),o(f,"constructor",l),l.displayName="GeneratorFunction",o(f,i,"GeneratorFunction"),o(y),o(y,i,"Generator"),o(y,n,function(){return this}),o(y,"toString",function(){return"[object Generator]"}),(a=function(){return{w:u,m}})()}function o(e,t,r,n){var a=Object.defineProperty;try{a({},"",{})}catch(e){a=0}o=function(e,t,r,n){function i(t,r){o(e,t,function(e){return this._invoke(t,r,e)})}t?a?a(e,t,{value:r,enumerable:!n,configurable:!n,writable:!n}):e[t]=r:(i("next",0),i("throw",1),i("return",2))},o(e,t,r,n)}function i(e,t,r,n,a,o,i){try{var u=e[o](i),s=u.value}catch(e){return void r(e)}u.done?t(s):Promise.resolve(s).then(n,a)}function u(e){return function(){var t=this,r=arguments;return new Promise(function(n,a){var o=e.apply(t,r);function u(e){i(o,n,a,u,s,"next",e)}function s(e){i(o,n,a,u,s,"throw",e)}u(void 0)})}}function s(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,c(n.key),n)}}function c(e){var r=function(e){if("object"!=t(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!=t(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==t(r)?r:r+""}var l=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.settingsKey="ner_normalizer_settings",this.mappingsKey="ner_normalizer_mappings"},t=[{key:"saveSettings",value:(l=u(a().m(function e(t){var r,n;return a().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,r=JSON.stringify(t),localStorage.setItem(this.settingsKey,r),e.a(2,!0);case 1:return e.p=1,n=e.v,console.error("Error saving settings:",n),e.a(2,!1)}},e,this,[[0,1]])})),function(e){return l.apply(this,arguments)})},{key:"loadSettings",value:(c=u(a().m(function e(){var t,r;return a().w(function(e){for(;;)switch(e.p=e.n){case 0:if(e.p=0,!(t=localStorage.getItem(this.settingsKey))){e.n=1;break}return e.a(2,JSON.parse(t));case 1:return e.a(2,this.getDefaultSettings());case 2:return e.p=2,r=e.v,console.error("Error loading settings:",r),e.a(2,this.getDefaultSettings())}},e,this,[[0,2]])})),function(){return c.apply(this,arguments)})},{key:"getDefaultSettings",value:function(){return{autoApplyLearned:!0,showSuggestionsThreshold:.8,enableSpanishSurnameDetection:!0}}},{key:"saveMappings",value:(i=u(a().m(function e(t){var n,o;return a().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,n=JSON.stringify(r(t.entries())),localStorage.setItem(this.mappingsKey,n),e.a(2,!0);case 1:return e.p=1,o=e.v,console.error("Error saving mappings:",o),e.a(2,!1)}},e,this,[[0,1]])})),function(e){return i.apply(this,arguments)})},{key:"loadMappings",value:(o=u(a().m(function e(){var t,r;return a().w(function(e){for(;;)switch(e.p=e.n){case 0:if(e.p=0,!(t=localStorage.getItem(this.mappingsKey))){e.n=1;break}return e.a(2,new Map(JSON.parse(t)));case 1:return e.a(2,new Map);case 2:return e.p=2,r=e.v,console.error("Error loading mappings:",r),e.a(2,new Map)}},e,this,[[0,2]])})),function(){return o.apply(this,arguments)})},{key:"clearAllData",value:(n=u(a().m(function e(){return a().w(function(e){for(;;)switch(e.n){case 0:localStorage.removeItem(this.settingsKey),localStorage.removeItem(this.mappingsKey);case 1:return e.a(2)}},e,this)})),function(){return n.apply(this,arguments)})}],t&&s(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,n,o,i,c,l}();e.exports&&(e.exports=l)},672:(e,t,r)=>{function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function a(){var e,t,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",i=r.toStringTag||"@@toStringTag";function u(r,n,a,i){var u=n&&n.prototype instanceof c?n:c,l=Object.create(u.prototype);return o(l,"_invoke",function(r,n,a){var o,i,u,c=0,l=a||[],f=!1,p={p:0,n:0,v:e,a:y,f:y.bind(e,4),d:function(t,r){return o=t,i=0,u=e,p.n=r,s}};function y(r,n){for(i=r,u=n,t=0;!f&&c&&!a&&t<l.length;t++){var a,o=l[t],y=p.p,m=o[2];r>3?(a=m===n)&&(u=o[(i=o[4])?5:(i=3,3)],o[4]=o[5]=e):o[0]<=y&&((a=r<2&&y<o[1])?(i=0,p.v=n,p.n=o[1]):y<m&&(a=r<3||o[0]>n||n>m)&&(o[4]=r,o[5]=n,p.n=m,i=0))}if(a||r>1)return s;throw f=!0,n}return function(a,l,m){if(c>1)throw TypeError("Generator is already running");for(f&&1===l&&y(l,m),i=l,u=m;(t=i<2?e:u)||!f;){o||(i?i<3?(i>1&&(p.n=-1),y(i,u)):p.n=u:p.v=u);try{if(c=2,o){if(i||(a="next"),t=o[a]){if(!(t=t.call(o,u)))throw TypeError("iterator result is not an object");if(!t.done)return t;u=t.value,i<2&&(i=0)}else 1===i&&(t=o.return)&&t.call(o),i<2&&(u=TypeError("The iterator does not provide a '"+a+"' method"),i=1);o=e}else if((t=(f=p.n<0)?u:r.call(n,p))!==s)break}catch(t){o=e,i=1,u=t}finally{c=1}}return{value:t,done:f}}}(r,a,i),!0),l}var s={};function c(){}function l(){}function f(){}t=Object.getPrototypeOf;var p=[][n]?t(t([][n]())):(o(t={},n,function(){return this}),t),y=f.prototype=c.prototype=Object.create(p);function m(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,f):(e.__proto__=f,o(e,i,"GeneratorFunction")),e.prototype=Object.create(y),e}return l.prototype=f,o(y,"constructor",f),o(f,"constructor",l),l.displayName="GeneratorFunction",o(f,i,"GeneratorFunction"),o(y),o(y,i,"Generator"),o(y,n,function(){return this}),o(y,"toString",function(){return"[object Generator]"}),(a=function(){return{w:u,m}})()}function o(e,t,r,n){var a=Object.defineProperty;try{a({},"",{})}catch(e){a=0}o=function(e,t,r,n){function i(t,r){o(e,t,function(e){return this._invoke(t,r,e)})}t?a?a(e,t,{value:r,enumerable:!n,configurable:!n,writable:!n}):e[t]=r:(i("next",0),i("throw",1),i("return",2))},o(e,t,r,n)}function i(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return u(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?u(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return i=e.done,e},e:function(e){s=!0,o=e},f:function(){try{i||null==r.return||r.return()}finally{if(s)throw o}}}}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function s(e,t,r,n,a,o,i){try{var u=e[o](i),s=u.value}catch(e){return void r(e)}u.done?t(s):Promise.resolve(s).then(n,a)}function c(e){return function(){var t=this,r=arguments;return new Promise(function(n,a){var o=e.apply(t,r);function i(e){s(o,n,a,i,u,"next",e)}function u(e){s(o,n,a,i,u,"throw",e)}i(void 0)})}}function l(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,f(n.key),n)}}function f(e){var t=function(e){if("object"!=n(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=n(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==n(t)?t:t+""}var p=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.learningEngine=new(r(95))},t=[{key:"processBatch",value:(o=c(a().m(function e(t){var r,n,o,u;return a().w(function(e){for(;;)switch(e.p=e.n){case 0:console.log("Processing ".concat(t.length," items in batch")),r=i(t),e.p=1,r.s();case 2:if((n=r.n()).done){e.n=4;break}return o=n.value,e.n=3,this.processItem(o);case 3:e.n=2;break;case 4:e.n=6;break;case 5:e.p=5,u=e.v,r.e(u);case 6:return e.p=6,r.f(),e.f(6);case 7:return e.a(2,{success:!0,processedCount:t.length})}},e,this,[[1,5,6,7]])})),function(e){return o.apply(this,arguments)})},{key:"processItem",value:(n=c(a().m(function e(t){var r,n,o,u,s,c;return a().w(function(e){for(;;)switch(e.n){case 0:r=t.getCreators?t.getCreators():[],n=i(r);try{for(n.s();!(o=n.n()).done;)((u=o.value).firstName||u.lastName)&&(s="".concat(u.firstName||""," ").concat(u.lastName||"").trim(),(c=this.learningEngine.getMapping(s))?console.log("Applying learned normalization: ".concat(s," -> ").concat(c)):console.log("Need to process: ".concat(s)))}catch(e){n.e(e)}finally{n.f()}case 1:return e.a(2)}},e,this)})),function(e){return n.apply(this,arguments)})}],t&&l(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,n,o}();e.exports&&(e.exports=p)},827:(e,t,r)=>{function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function a(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return o(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?o(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,u=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return u=e.done,e},e:function(e){s=!0,i=e},f:function(){try{u||null==r.return||r.return()}finally{if(s)throw i}}}}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function i(){var e,t,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",a=r.toStringTag||"@@toStringTag";function o(r,n,a,o){var i=n&&n.prototype instanceof c?n:c,l=Object.create(i.prototype);return u(l,"_invoke",function(r,n,a){var o,i,u,c=0,l=a||[],f=!1,p={p:0,n:0,v:e,a:y,f:y.bind(e,4),d:function(t,r){return o=t,i=0,u=e,p.n=r,s}};function y(r,n){for(i=r,u=n,t=0;!f&&c&&!a&&t<l.length;t++){var a,o=l[t],y=p.p,m=o[2];r>3?(a=m===n)&&(u=o[(i=o[4])?5:(i=3,3)],o[4]=o[5]=e):o[0]<=y&&((a=r<2&&y<o[1])?(i=0,p.v=n,p.n=o[1]):y<m&&(a=r<3||o[0]>n||n>m)&&(o[4]=r,o[5]=n,p.n=m,i=0))}if(a||r>1)return s;throw f=!0,n}return function(a,l,m){if(c>1)throw TypeError("Generator is already running");for(f&&1===l&&y(l,m),i=l,u=m;(t=i<2?e:u)||!f;){o||(i?i<3?(i>1&&(p.n=-1),y(i,u)):p.n=u:p.v=u);try{if(c=2,o){if(i||(a="next"),t=o[a]){if(!(t=t.call(o,u)))throw TypeError("iterator result is not an object");if(!t.done)return t;u=t.value,i<2&&(i=0)}else 1===i&&(t=o.return)&&t.call(o),i<2&&(u=TypeError("The iterator does not provide a '"+a+"' method"),i=1);o=e}else if((t=(f=p.n<0)?u:r.call(n,p))!==s)break}catch(t){o=e,i=1,u=t}finally{c=1}}return{value:t,done:f}}}(r,a,o),!0),l}var s={};function c(){}function l(){}function f(){}t=Object.getPrototypeOf;var p=[][n]?t(t([][n]())):(u(t={},n,function(){return this}),t),y=f.prototype=c.prototype=Object.create(p);function m(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,f):(e.__proto__=f,u(e,a,"GeneratorFunction")),e.prototype=Object.create(y),e}return l.prototype=f,u(y,"constructor",f),u(f,"constructor",l),l.displayName="GeneratorFunction",u(f,a,"GeneratorFunction"),u(y),u(y,a,"Generator"),u(y,n,function(){return this}),u(y,"toString",function(){return"[object Generator]"}),(i=function(){return{w:o,m}})()}function u(e,t,r,n){var a=Object.defineProperty;try{a({},"",{})}catch(e){a=0}u=function(e,t,r,n){function o(t,r){u(e,t,function(e){return this._invoke(t,r,e)})}t?a?a(e,t,{value:r,enumerable:!n,configurable:!n,writable:!n}):e[t]=r:(o("next",0),o("throw",1),o("return",2))},u(e,t,r,n)}function s(e,t,r,n,a,o,i){try{var u=e[o](i),s=u.value}catch(e){return void r(e)}u.done?t(s):Promise.resolve(s).then(n,a)}function c(e){return function(){var t=this,r=arguments;return new Promise(function(n,a){var o=e.apply(t,r);function i(e){s(o,n,a,i,u,"next",e)}function u(e){s(o,n,a,i,u,"throw",e)}i(void 0)})}}function l(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,f(n.key),n)}}function f(e){var t=function(e){if("object"!=n(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=n(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==n(t)?t:t+""}var p=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.isInitialized=!1,this.model=null},t=[{key:"initialize",value:(u=c(i().m(function e(){return i().w(function(e){for(;;)switch(e.n){case 0:console.log("NER Worker initialized"),this.isInitialized=!0;case 1:return e.a(2)}},e,this)})),function(){return u.apply(this,arguments)})},{key:"processNames",value:(o=c(i().m(function e(t){var r,n,o,u,s,c;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:if(this.isInitialized){e.n=1;break}return e.n=1,this.initialize();case 1:r=[],n=a(t),e.p=2,n.s();case 3:if((o=n.n()).done){e.n=6;break}return u=o.value,e.n=4,this.processSingleName(u);case 4:s=e.v,r.push(s);case 5:e.n=3;break;case 6:e.n=8;break;case 7:e.p=7,c=e.v,n.e(c);case 8:return e.p=8,n.f(),e.f(8);case 9:return e.a(2,r)}},e,this,[[2,7,8,9]])})),function(e){return o.apply(this,arguments)})},{key:"processSingleName",value:(n=c(i().m(function e(t){var n,a;return i().w(function(e){for(;;)if(0===e.n)return n=r(889),a=new n,e.a(2,a.parse(t))},e)})),function(e){return n.apply(this,arguments)})}],t&&l(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,n,o,u}();e.exports&&(e.exports=p)},886:(e,t,r)=>{function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function a(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return o(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?o(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,u=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return u=e.done,e},e:function(e){s=!0,i=e},f:function(){try{u||null==r.return||r.return()}finally{if(s)throw i}}}}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function i(){var e,t,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",a=r.toStringTag||"@@toStringTag";function o(r,n,a,o){var i=n&&n.prototype instanceof c?n:c,l=Object.create(i.prototype);return u(l,"_invoke",function(r,n,a){var o,i,u,c=0,l=a||[],f=!1,p={p:0,n:0,v:e,a:y,f:y.bind(e,4),d:function(t,r){return o=t,i=0,u=e,p.n=r,s}};function y(r,n){for(i=r,u=n,t=0;!f&&c&&!a&&t<l.length;t++){var a,o=l[t],y=p.p,m=o[2];r>3?(a=m===n)&&(u=o[(i=o[4])?5:(i=3,3)],o[4]=o[5]=e):o[0]<=y&&((a=r<2&&y<o[1])?(i=0,p.v=n,p.n=o[1]):y<m&&(a=r<3||o[0]>n||n>m)&&(o[4]=r,o[5]=n,p.n=m,i=0))}if(a||r>1)return s;throw f=!0,n}return function(a,l,m){if(c>1)throw TypeError("Generator is already running");for(f&&1===l&&y(l,m),i=l,u=m;(t=i<2?e:u)||!f;){o||(i?i<3?(i>1&&(p.n=-1),y(i,u)):p.n=u:p.v=u);try{if(c=2,o){if(i||(a="next"),t=o[a]){if(!(t=t.call(o,u)))throw TypeError("iterator result is not an object");if(!t.done)return t;u=t.value,i<2&&(i=0)}else 1===i&&(t=o.return)&&t.call(o),i<2&&(u=TypeError("The iterator does not provide a '"+a+"' method"),i=1);o=e}else if((t=(f=p.n<0)?u:r.call(n,p))!==s)break}catch(t){o=e,i=1,u=t}finally{c=1}}return{value:t,done:f}}}(r,a,o),!0),l}var s={};function c(){}function l(){}function f(){}t=Object.getPrototypeOf;var p=[][n]?t(t([][n]())):(u(t={},n,function(){return this}),t),y=f.prototype=c.prototype=Object.create(p);function m(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,f):(e.__proto__=f,u(e,a,"GeneratorFunction")),e.prototype=Object.create(y),e}return l.prototype=f,u(y,"constructor",f),u(f,"constructor",l),l.displayName="GeneratorFunction",u(f,a,"GeneratorFunction"),u(y),u(y,a,"Generator"),u(y,n,function(){return this}),u(y,"toString",function(){return"[object Generator]"}),(i=function(){return{w:o,m}})()}function u(e,t,r,n){var a=Object.defineProperty;try{a({},"",{})}catch(e){a=0}u=function(e,t,r,n){function o(t,r){u(e,t,function(e){return this._invoke(t,r,e)})}t?a?a(e,t,{value:r,enumerable:!n,configurable:!n,writable:!n}):e[t]=r:(o("next",0),o("throw",1),o("return",2))},u(e,t,r,n)}function s(e,t,r,n,a,o,i){try{var u=e[o](i),s=u.value}catch(e){return void r(e)}u.done?t(s):Promise.resolve(s).then(n,a)}function c(e){return function(){var t=this,r=arguments;return new Promise(function(n,a){var o=e.apply(t,r);function i(e){s(o,n,a,i,u,"next",e)}function u(e){s(o,n,a,i,u,"throw",e)}i(void 0)})}}function l(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,f(n.key),n)}}function f(e){var t=function(e){if("object"!=n(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=n(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==n(t)?t:t+""}var p=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.itemProcessor=new(r(48)),this.zoteroDBAnalyzer=new(r(887))},t=[{key:"initialize",value:(s=c(i().m(function e(){return i().w(function(e){for(;;)switch(e.n){case 0:console.log("Initializing menu integration"),this.registerMenuItems();case 1:return e.a(2)}},e,this)})),function(){return s.apply(this,arguments)})},{key:"registerMenuItems",value:function(){console.log("Registered menu items for name normalization")}},{key:"handleNormalizeAction",value:(u=c(i().m(function e(t){var n,o,u,s,c,l,f,p,y,m,h;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:console.log("Handling normalize action for ".concat(t.length," items")),n=[],o=a(t),e.p=1,o.s();case 2:if((u=o.n()).done){e.n=5;break}return s=u.value,e.n=3,this.itemProcessor.processItemCreators(s);case 3:c=e.v,n.push({item:s,results:c});case 4:e.n=2;break;case 5:e.n=7;break;case 6:e.p=6,h=e.v,o.e(h);case 7:return e.p=7,o.f(),e.f(7);case 8:return l=new(r(491)),e.n=9,l.showDialog(t);case 9:f=e.v,p=0;case 10:if(!(p<t.length)){e.n=12;break}return y=t[p],m=f[p],e.n=11,this.itemProcessor.applyNormalizations(y,m.creators);case 11:p++,e.n=10;break;case 12:return e.a(2,{success:!0,processed:t.length})}},e,this,[[1,6,7,8]])})),function(e){return u.apply(this,arguments)})},{key:"performFullLibraryAnalysis",value:(o=c(i().m(function e(){var t,r;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:if("undefined"!=typeof Zotero){e.n=1;break}throw new Error("This feature requires Zotero context");case 1:return console.log("Starting full library analysis for name variants..."),e.p=2,e.n=3,this.zoteroDBAnalyzer.analyzeFullLibrary();case 3:return t=e.v,console.log("Analysis complete: Found ".concat(t.totalVariantGroups," potential variant groups")),e.a(2,t);case 4:throw e.p=4,r=e.v,console.error("Error in full library analysis:",r),r;case 5:return e.a(2)}},e,this,[[2,4]])})),function(){return o.apply(this,arguments)})},{key:"handleFullLibraryAnalysis",value:(n=c(i().m(function e(){var t,r;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,this.performFullLibraryAnalysis();case 1:return t=e.v,console.log("Full library analysis results:",{totalUniqueSurnames:t.totalUniqueSurnames,totalVariantGroups:t.totalVariantGroups,topSuggestions:t.suggestions.slice(0,10)}),e.a(2,t);case 2:throw e.p=2,r=e.v,console.error("Error handling full library analysis:",r),r;case 3:return e.a(2)}},e,this,[[0,2]])})),function(){return n.apply(this,arguments)})}],t&&l(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,n,o,u,s}();e.exports&&(e.exports=p)},887:(e,t,r)=>{function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function a(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function o(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?a(Object(r),!0).forEach(function(t){i(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function i(e,t,r){return(t=d(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function u(e){return function(e){if(Array.isArray(e))return y(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||p(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function s(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,a,o,i,u=[],s=!0,c=!1;try{if(o=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;s=!1}else for(;!(s=(n=o.call(r)).done)&&(u.push(n.value),u.length!==t);s=!0);}catch(e){c=!0,a=e}finally{try{if(!s&&null!=r.return&&(i=r.return(),Object(i)!==i))return}finally{if(c)throw a}}return u}}(e,t)||p(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function c(){var e,t,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",a=r.toStringTag||"@@toStringTag";function o(r,n,a,o){var s=n&&n.prototype instanceof u?n:u,c=Object.create(s.prototype);return l(c,"_invoke",function(r,n,a){var o,u,s,c=0,l=a||[],f=!1,p={p:0,n:0,v:e,a:y,f:y.bind(e,4),d:function(t,r){return o=t,u=0,s=e,p.n=r,i}};function y(r,n){for(u=r,s=n,t=0;!f&&c&&!a&&t<l.length;t++){var a,o=l[t],y=p.p,m=o[2];r>3?(a=m===n)&&(s=o[(u=o[4])?5:(u=3,3)],o[4]=o[5]=e):o[0]<=y&&((a=r<2&&y<o[1])?(u=0,p.v=n,p.n=o[1]):y<m&&(a=r<3||o[0]>n||n>m)&&(o[4]=r,o[5]=n,p.n=m,u=0))}if(a||r>1)return i;throw f=!0,n}return function(a,l,m){if(c>1)throw TypeError("Generator is already running");for(f&&1===l&&y(l,m),u=l,s=m;(t=u<2?e:s)||!f;){o||(u?u<3?(u>1&&(p.n=-1),y(u,s)):p.n=s:p.v=s);try{if(c=2,o){if(u||(a="next"),t=o[a]){if(!(t=t.call(o,s)))throw TypeError("iterator result is not an object");if(!t.done)return t;s=t.value,u<2&&(u=0)}else 1===u&&(t=o.return)&&t.call(o),u<2&&(s=TypeError("The iterator does not provide a '"+a+"' method"),u=1);o=e}else if((t=(f=p.n<0)?s:r.call(n,p))!==i)break}catch(t){o=e,u=1,s=t}finally{c=1}}return{value:t,done:f}}}(r,a,o),!0),c}var i={};function u(){}function s(){}function f(){}t=Object.getPrototypeOf;var p=[][n]?t(t([][n]())):(l(t={},n,function(){return this}),t),y=f.prototype=u.prototype=Object.create(p);function m(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,f):(e.__proto__=f,l(e,a,"GeneratorFunction")),e.prototype=Object.create(y),e}return s.prototype=f,l(y,"constructor",f),l(f,"constructor",s),s.displayName="GeneratorFunction",l(f,a,"GeneratorFunction"),l(y),l(y,a,"Generator"),l(y,n,function(){return this}),l(y,"toString",function(){return"[object Generator]"}),(c=function(){return{w:o,m}})()}function l(e,t,r,n){var a=Object.defineProperty;try{a({},"",{})}catch(e){a=0}l=function(e,t,r,n){function o(t,r){l(e,t,function(e){return this._invoke(t,r,e)})}t?a?a(e,t,{value:r,enumerable:!n,configurable:!n,writable:!n}):e[t]=r:(o("next",0),o("throw",1),o("return",2))},l(e,t,r,n)}function f(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=p(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,u=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return i=e.done,e},e:function(e){u=!0,o=e},f:function(){try{i||null==r.return||r.return()}finally{if(u)throw o}}}}function p(e,t){if(e){if("string"==typeof e)return y(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?y(e,t):void 0}}function y(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function m(e,t,r,n,a,o,i){try{var u=e[o](i),s=u.value}catch(e){return void r(e)}u.done?t(s):Promise.resolve(s).then(n,a)}function h(e){return function(){var t=this,r=arguments;return new Promise(function(n,a){var o=e.apply(t,r);function i(e){m(o,n,a,i,u,"next",e)}function u(e){m(o,n,a,i,u,"throw",e)}i(void 0)})}}function v(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,d(n.key),n)}}function d(e){var t=function(e){if("object"!=n(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=n(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==n(t)?t:t+""}var g=Object.freeze({frederic:"frederick",frederick:"frederick",fred:"frederick",freddie:"frederick",freddy:"frederick",harry:"harry",harold:"harold",henry:"henry",hal:"harold",bob:"robert",bobby:"robert",rob:"robert",robert:"robert",robbie:"robert",william:"william",will:"william",bill:"william",billy:"william",willie:"william",elizabeth:"elizabeth",liz:"elizabeth",lizzie:"elizabeth",beth:"elizabeth",betty:"elizabeth",jon:"jonathan",jonathan:"jonathan",john:"john",jack:"john",kate:"katherine",katherine:"katherine",catherine:"catherine",cathy:"catherine",kathy:"catherine",alex:"alexander",alexander:"alexander",alexandra:"alexandra",sandy:"alexander",sasha:"alexander",maggie:"margaret",margaret:"margaret",peggy:"margaret",meg:"margaret",megan:"margaret",mike:"michael",michael:"michael",mick:"michael",mickey:"michael"}),b=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.candidateFinder=new(r(22)),this.learningEngine=new(r(95))},t=[{key:"analyzeFullLibrary",value:(y=h(c().m(function e(){var t,r,n,a,o,i,u,s,l,p,y,m,h,v,d,g,b,w,S,N,k,j,O,P,A,x,E,C,T,I,z,F,G,_,M,L,D,Z,q,U,B,V,R,W,J,K,$,H,X,Y,Q=arguments;return c().w(function(e){for(;;)switch(e.p=e.n){case 0:if(t=Q.length>0&&void 0!==Q[0]?Q[0]:null,r=Q.length>1&&void 0!==Q[1]?Q[1]:null,Zotero.debug("ZoteroDBAnalyzer: analyzeFullLibrary started"),"undefined"!=typeof Zotero){e.n=1;break}throw Zotero.debug("ZoteroDBAnalyzer: Zotero undefined, throwing error"),new Error("This method must be run in the Zotero context");case 1:return console.log("Starting full library analysis..."),e.p=2,Zotero.debug("ZoteroDBAnalyzer: Creating search for libraryID: "+Zotero.Libraries.userLibraryID),(n=new Zotero.Search).addCondition("libraryID","is",Zotero.Libraries.userLibraryID),e.n=3,n.search();case 3:if(a=e.v,Zotero.debug("ZoteroDBAnalyzer: Search returned "+(a?a.length:0)+" item IDs"),console.log("Found ".concat(a.length," total items in library")),a&&0!==a.length){e.n=4;break}return console.log("No items found in library"),e.a(2,{surnameFrequencies:{},potentialVariants:[],suggestions:[],totalUniqueSurnames:0,totalVariantGroups:0});case 4:o=[],i=200,Zotero.debug("ZoteroDBAnalyzer: Starting item filtering for creators, total items: "+a.length),console.log("Filtering ".concat(a.length," items to find those with creators...")),u=0;case 5:if(!(u<a.length)){e.n=8;break}return s=a.slice(u,u+i),e.n=6,Zotero.Items.getAsync(s);case 6:l=e.v,p=f(l);try{for(p.s();!(y=p.n()).done;){m=y.value;try{if((h=m.getCreators?m.getCreators():[])&&Array.isArray(h)&&h.length>0){v=h.filter(function(e){return e&&(e.firstName||e.lastName)}),v.length>0&&o.push(m),d=f(h);try{for(d.s();!(g=d.n()).done;)b=g.value,this.addCreatorOccurrence(x,b,m)}catch(e){d.e(e)}finally{d.f()}}}catch(e){console.warn("Error processing item creators:",e)}}}catch(e){p.e(e)}finally{p.f()}t&&t({stage:"filtering_items",processed:u+s.length,total:a.length,percent:Math.round((u+s.length)/a.length*100)});case 7:u+=i,e.n=5;break;case 8:if(Zotero.debug("ZoteroDBAnalyzer: Filtering complete, items with creators: "+o.length),console.log("Found ".concat(o.length," items with valid creators")),0!==o.length){e.n=16;break}return console.log("WARNING: No items with valid creators found!"),console.log("This might indicate:"),console.log("1. Items exist but have no creators"),console.log("2. Creator data is malformed"),console.log("3. Search conditions are too restrictive"),console.log("Trying fallback search to verify database access..."),(w=new Zotero.Search).addCondition("libraryID","is",Zotero.Libraries.userLibraryID),w.addCondition("limit","is",10),e.p=9,e.n=10,w.search();case 10:if(!((S=e.v)&&S.length>0)){e.n=12;break}return e.n=11,Zotero.Items.getAsync(S);case 11:N=e.v,console.log("Fallback found ".concat(N.length," items")),k=f(N.slice(0,3));try{for(k.s();!(j=k.n()).done;){O=j.value;try{P=O.getCreators?O.getCreators():[],console.log('Item "'.concat(O.getField?O.getField("title"):"Unknown",'" has ').concat(P.length," creators:"),P)}catch(e){console.log("Error getting creators for item:",e)}}}catch(e){k.e(e)}finally{k.f()}e.n=13;break;case 12:console.log("Fallback search also found no items");case 13:e.n=15;break;case 14:e.p=14,X=e.v,console.error("Fallback search failed:",X);case 15:Zotero.debug("ZoteroDBAnalyzer: No items with creators found, fallback search initiated");case 16:A=100,x={},E=0,C=0;case 17:if(!(C<a.length)){e.n=21;break}if(!r||!r()){e.n=18;break}throw console.log("Analysis cancelled by user"),new Error("Analysis cancelled");case 18:return T=a.slice(C,C+i),e.n=19,Zotero.Items.getAsync(T);case 19:I=e.v,z=f(I);try{for(z.s();!(F=z.n()).done;){G=F.value;try{_=G.getCreators?G.getCreators():[],M=f(_);try{for(M.s();!(L=M.n()).done;)D=L.value,this.addCreatorOccurrence(x,D,G)}catch(e){M.e(e)}finally{M.f()}}catch(e){console.warn("Error processing item creators:",e)}}}catch(e){z.e(e)}finally{z.f()}E+=T.length,t&&t({stage:"processing_items",processed:E,total:a.length,percent:Math.round(E/a.length*100)});case 20:C+=A,e.n=17;break;case 21:Zotero.debug("ZoteroDBAnalyzer: Starting creator extraction from "+o.length+" items"),console.log("Found ".concat(o.length," items with creators, now extracting creator data...")),Z=0;case 22:if(!(Z<o.length)){e.n=25;break}if(!r||!r()){e.n=23;break}throw new Error("Analysis cancelled");case 23:q=o.slice(Z,Z+A),U=f(q);try{for(U.s();!(B=U.n()).done;){V=B.value;try{R=V.getCreators?V.getCreators():[],W=f(R);try{for(W.s();!(J=W.n()).done;)K=J.value,this.addCreatorOccurrence(x,K,V)}catch(e){W.e(e)}finally{W.f()}}catch(e){console.warn("Error processing item creators:",e)}}}catch(e){U.e(e)}finally{U.f()}t&&t({stage:"extracting_creators",processed:Z+q.length,total:o.length,percent:Math.round((Z+q.length)/o.length*100)});case 24:Z+=A,e.n=22;break;case 25:return $=Object.values(x),Zotero.debug("ZoteroDBAnalyzer: Extracted "+$.length+" unique creators"),console.log("Found ".concat($.length," unique creator combinations")),$.length>0?(Zotero.debug("ZoteroDBAnalyzer: Sample creators: "+JSON.stringify($.slice(0,3))),console.log("Sample creators:",$.slice(0,5))):(Zotero.debug("ZoteroDBAnalyzer: WARNING - No creators extracted at all"),console.log("WARNING: No creators found! This indicates an issue with creator extraction.")),Zotero.debug("ZoteroDBAnalyzer: Starting analyzeCreators with "+$.length+" creators"),e.n=26,this.analyzeCreators($,t,r);case 26:return H=e.v,Zotero.debug("ZoteroDBAnalyzer: analyzeCreators completed, suggestions count: "+(H.suggestions?H.suggestions.length:0)),console.log("Analysis complete: processed ".concat($.length," unique creator entries")),e.a(2,H);case 27:if(e.p=27,Y=e.v,console.error("Error in database analysis:",Y),"Analysis cancelled"!==Y.message){e.n=28;break}throw Y;case 28:return e.a(2,{surnameFrequencies:{},potentialVariants:[],suggestions:[],totalUniqueSurnames:0,totalVariantGroups:0})}},e,this,[[9,14],[2,27]])})),function(){return y.apply(this,arguments)})},{key:"addCreatorOccurrence",value:function(e,t,r){if(t&&(t.firstName||t.lastName)){var n="".concat(t.firstName||"","|").concat(t.lastName||"","|").concat(t.fieldMode||0);if(!e[n]){var a=this.parseName("".concat(t.firstName||""," ").concat(t.lastName||"").trim()||t.lastName||"");e[n]={key:n,firstName:t.firstName||"",lastName:t.lastName||"",fieldMode:t.fieldMode||0,count:0,items:[],parsedName:a}}if(e[n].count=(e[n].count||0)+1,r){var o=this.buildItemSummary(r);o&&(e[n].items||[]).length<25&&e[n].items.push(o)}}}},{key:"buildItemSummary",value:function(e){if(!e)return null;try{var t="function"==typeof e.getField?e.getField.bind(e):null,r=t?t("title"):e.title||"",n=t?t("date"):e.date||"",a=this.extractYear(n),o="function"==typeof e.getCreators?(e.getCreators()||[]).length:void 0;return{id:e.id||null,key:e.key||null,title:r||"Untitled",date:n||"",year:a,itemType:e.itemType||(t?t("itemType"):""),creatorsCount:o}}catch(e){return console.warn("Unable to summarize item for creator mapping:",e),null}}},{key:"extractYear",value:function(e){if(!e||"string"!=typeof e)return"";var t=e.match(/(\d{4})/);return t?t[1]:""}},{key:"analyzeCreators",value:(p=h(c().m(function e(t){var r,n,a,o,i,u,s,l,p,y,m,h,v,d,g,b=arguments;return c().w(function(e){for(;;)if(0===e.n){r=b.length>1&&void 0!==b[1]?b[1]:null,n=b.length>2&&void 0!==b[2]?b[2]:null,Zotero.debug("ZoteroDBAnalyzer: analyzeCreators started with "+(t?t.length:0)+" creators"),a={},o={},i=f(t);try{for(i.s();!(u=i.n()).done;)s=u.value,l="".concat(s.firstName," ").concat(s.lastName).trim(),(p=this.parseName(l)).lastName&&(y=p.lastName.toLowerCase().trim(),a[y]=(a[y]||0)+(s.count||1),o[y]=this.mergeItemSummaries(o[y],s.items))}catch(e){i.e(e)}finally{i.f()}return m=Object.keys(a),Zotero.debug("ZoteroDBAnalyzer: Found "+m.length+" unique surnames"),console.log("Analyzing ".concat(m.length," unique surnames for variants...")),(h=this.findVariantsEfficiently(a,r,n)).sort(function(e,t){var r=e.variant1.frequency+e.variant2.frequency;return t.variant1.frequency+t.variant2.frequency-r}),v=this.groupCreatorsBySurnameForVariants(t),d=this.findGivenNameVariantGroups(v),g=this.generateNormalizationSuggestions(h,d,o),e.a(2,{surnameFrequencies:a,potentialVariants:h,suggestions:g,totalUniqueSurnames:m.length,totalVariantGroups:g.length,givenNameVariantGroups:d})}},e,this)})),function(e){return p.apply(this,arguments)})},{key:"findVariantsEfficiently",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=[],a=Object.keys(e).sort(function(t,r){return e[r]-e[t]}),o=Math.min(1e4,5*a.length),i=0,u=0;u<a.length&&i<o;u++){if(r&&r())throw new Error("Analysis cancelled");for(var s=a[u],c=s.length,l=Math.max(3,c-2),f=c+2,p=u+1;p<a.length&&i<o;p++){var y=a[p];if(!(y.length<l||y.length>f)){i++;var m=this.calculateStringSimilarity(s,y);m>=.8&&n.push({variant1:{name:s,frequency:e[s]},variant2:{name:y,frequency:e[y]},similarity:m,recommendedNormalization:e[s]>=e[y]?s:y})}}t&&u%10==0&&t({stage:"analyzing_surnames",processed:u,total:a.length,percent:Math.round(u/a.length*100)})}return Zotero.debug("ZoteroDBAnalyzer: Variant detection complete, compared "+i+" pairs, found "+n.length+" variants"),console.log("Compared ".concat(i," surname pairs, found ").concat(n.length," potential variants")),n}},{key:"groupCreatorsBySurnameForVariants",value:function(e){var t,r={},n=f(e);try{for(n.s();!(t=n.n()).done;){var a=t.value;if(a&&a.lastName){var o=(a.lastName||"").toLowerCase().trim();r[o]||(r[o]=[]),r[o].push(a)}}}catch(e){n.e(e)}finally{n.f()}return r}},{key:"parseGivenNameTokens",value:function(e){var t=(e||"").trim();if(!t)return[];var r,n=t.split(/[\s-]+/).filter(Boolean),a=[],o=f(n);try{for(o.s();!(r=o.n()).done;){var i=r.value,u=i.replace(/[^A-Za-z]/g,"");u&&(this.isLikelyInitialSequence(u,i)?u.toUpperCase().split("").forEach(function(e){a.push({type:"initial",value:e})}):1===u.length?a.push({type:"initial",value:u.toUpperCase()}):a.push({type:"word",value:this.toTitleCase(u)}))}}catch(e){o.e(e)}finally{o.f()}return a}},{key:"isLikelyInitialSequence",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";if(!e)return!1;var r=e.toUpperCase();return!(r.length<2||r.length>4||/[^A-Z]/.test(r)||!/\./.test(t)&&/[AEIOUY]/.test(r))}},{key:"selectCanonicalGivenNameData",value:function(e,t){var r,n=t&&!t.startsWith("initial:")?this.toTitleCase(t):"",a=[],o=-1/0,i=f(e||[]);try{for(i.s();!(r=i.n()).done;){var u,s=r.value,c=((null===(u=s.parsedName)||void 0===u?void 0:u.firstName)||s.firstName||"").trim();if(c){var l=this.parseGivenNameTokens(c);if(0!==l.length){var p=l.some(function(e){return"word"===e.type}),y=(s.count||1)+l.length;p&&(y+=1e3),y>o&&(a=l,o=y)}}}}catch(e){i.e(e)}finally{i.f()}var m,h=a.find(function(e){return"word"===e.type}),v=h?h.value:n,d=[],g=[],b=!1,w=f(a);try{for(w.s();!(m=w.n()).done;){var S=m.value;if("word"===S.type){if(!(b||h&&S.value!==h.value)){b=!0;continue}d.includes(S.value)||d.push(S.value)}else if("initial"===S.type){var N=S.value.toUpperCase();g.includes(N)||g.push(N)}}}catch(e){w.e(e)}finally{w.f()}return{baseWord:v,extraWords:d,initials:g}}},{key:"composeGivenNameFromTokens",value:function(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=r.baseWord||"",a=r.extraWords||[],o=r.initials||[],i="",u=[],s=[],c=f(e||[]);try{for(c.s();!(t=c.n()).done;){var l=t.value;if("word"===l.type)i?u.includes(l.value)||u.push(l.value):i=l.value;else if("initial"===l.type){var p=l.value.toUpperCase();s.includes(p)||s.push(p)}}}catch(e){c.e(e)}finally{c.f()}!i&&n&&(i=n);var y=i?i.charAt(0).toUpperCase():"";!i&&s.length>0&&(i="".concat(s[0],"."),s.shift()),a.forEach(function(e){e&&(u.includes(e)||e===i||u.push(e))});var m=[],h=new Set,v=function(e){if(e){var t=e.toUpperCase();t!==y||h.has(t)?h.has(t)||(m.push("".concat(t,".")),h.add(t)):h.add(t)}};s.forEach(function(e){return v(e)}),o.forEach(function(e){return v(e)});var d=[];return i&&d.push(i),d.push.apply(d,u),d.push.apply(d,m),d.join(" ").replace(/\s+/g," ").trim()}},{key:"findGivenNameVariantGroups",value:function(e){for(var t=[],r=0,n=Object.entries(e);r<n.length;r++){var a=s(n[r],2),o=a[0],i=a[1];if(i&&!(i.length<2)){var c=this.findGivenNameVariantsForSurname(o,i);c.length>0&&t.push.apply(t,u(c))}}return t}},{key:"findGivenNameVariantsForSurname",value:function(e,t){var r,n=[],a=new Map,o=new Map,i=f(t);try{for(i.s();!(r=i.n()).done;){var u,c=r.value,l=((null===(u=c.parsedName)||void 0===u?void 0:u.firstName)||c.firstName||"").trim();if(l){var p=this.normalizeGivenName(l)||l.toLowerCase();a.has(p)||a.set(p,[]),a.get(p).push(c);var y="".concat(l,"|").concat(c.lastName);o.has(y)||o.set(y,c.items||[])}}}catch(e){i.e(e)}finally{i.f()}this.mergeInitialBuckets(a);var m,h=f(a.entries());try{for(h.s();!(m=h.n()).done;){var v=s(m.value,2),d=v[0],g=v[1];if(!(g.length<2)){var b,w=this.selectCanonicalGivenNameData(g,d),S=new Map,N=0,k=f(g);try{for(k.s();!(b=k.n()).done;){var j,O=b.value,P=((null===(j=O.parsedName)||void 0===j?void 0:j.firstName)||O.firstName||"").trim(),A=this.parseGivenNameTokens(P),x=this.composeGivenNameFromTokens(A,w)||w.baseWord||P,E="".concat(x,"|").concat(O.lastName).toLowerCase(),C=S.get(E)||{firstName:x,lastName:O.lastName,frequency:0,items:[]};C.frequency+=O.count||1,N+=O.count||1;var T="".concat(P,"|").concat(O.lastName);o.has(T)&&(C.items=this.mergeItemSummaries(C.items,o.get(T))),S.set(E,C)}}catch(e){k.e(e)}finally{k.f()}if(!(S.size<2)){var I=Array.from(S.values()),z=this.buildGivenNameRecommendation(I,e,w);n.push({surname:e,normalizedKey:d,variants:I,totalFrequency:N,recommendedFirstName:z.firstName,recommendedFullName:z.fullName})}}}}catch(e){h.e(e)}finally{h.f()}return n}},{key:"normalizeGivenName",value:function(e){var t=e.trim();if(!t)return"";var r=t.split(/[\s-]+/).filter(Boolean),n=r.map(function(e){return e.replace(/\./g,"")});if(0===n.length)return"";var a=n[0].toLowerCase();return n.every(function(e){return 1===e.length})?"initial:".concat(n.join("")):1===n.length&&this.isLikelyInitialSequence(n[0],r[0])?"initial:".concat(n[0].toUpperCase()):g[a]?g[a]:a}},{key:"mergeItemSummaries",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(!t||0===t.length)return e;var r,n=new Map,a=f(e);try{for(a.s();!(r=a.n()).done;){var o=r.value;if(o){var i=o.key||o.id||JSON.stringify(o);if(n.has(i)||n.set(i,o),n.size>=25)break}}}catch(e){a.e(e)}finally{a.f()}var u,s=f(t);try{for(s.s();!(u=s.n()).done;){var c=u.value;if(c){var l=c.key||c.id||JSON.stringify(c);if(!n.has(l)&&n.size<25&&n.set(l,c),n.size>=25)break}}}catch(e){s.e(e)}finally{s.f()}return Array.from(n.values())}},{key:"mergeInitialBuckets",value:function(e){var t=Array.from(e.keys()).filter(function(e){return!e.startsWith("initial:")});if(0===t.length)return e;for(var r=function(){var r=s(a[n],2),o=r[0],i=r[1];if(!o.startsWith("initial:"))return 0;var u=o.replace("initial:","");if(!u)return 0;var c=u.charAt(0).toLowerCase(),l=t.find(function(e){return e.charAt(0).toLowerCase()===c});if(l){var f=e.get(l);i.forEach(function(e){return f.push(e)}),e.delete(o)}},n=0,a=Array.from(e.entries());n<a.length;n++)r();return e}},{key:"buildGivenNameRecommendation",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!e||0===e.length)return{firstName:"",fullName:t||""};var n,a=function(e,t){t&&(e.includes(t)||e.push(t))},o=r.baseWord?this.toTitleCase(r.baseWord):"",i=[],u=[],s=f(e);try{for(s.s();!(n=s.n()).done;){var c,l=n.value,p=this.parseGivenNameTokens(l.firstName||""),y=!1,m=f(p);try{for(m.s();!(c=m.n()).done;){var h=c.value;"word"===h.type?y?a(i,h.value):(y=!0,o||(o=h.value)):"initial"===h.type&&a(u,h.value.toUpperCase())}}catch(e){m.e(e)}finally{m.f()}}}catch(e){s.e(e)}finally{s.f()}if((r.extraWords||[]).forEach(function(e){return a(i,e)}),(r.initials||[]).forEach(function(e){return a(u,e.toUpperCase())}),!o){var v=this.parseGivenNameTokens(e[0].firstName||""),d=v.find(function(e){return"word"===e.type});if(d)o=d.value;else{var g=v.find(function(e){return"initial"===e.type});if(g){var b=g.value.toUpperCase();o="".concat(b,".");var w=u.indexOf(b);-1!==w&&u.splice(w,1)}}}var S=o?o.charAt(0).toUpperCase():"";if(S){var N=u.indexOf(S);-1!==N&&u.splice(N,1)}var k=[];o&&k.push(o),k.push.apply(k,i),u.forEach(function(e){return k.push("".concat(e,"."))});var j=k.filter(Boolean).join(" ").replace(/\s+/g," ").trim();return{firstName:j,fullName:t?"".concat(j," ").concat(t).trim():j}}},{key:"scoreGivenNameVariant",value:function(e){var t;if(!e)return 0;var r=e.frequency||0,n=(e.firstName||"").trim();if(!n)return r;var a=n.replace(/\./g,"");/[a-z]{2,}/i.test(a)&&(r+=1e3),n.includes(".")||(r+=200);var o=(null===(t=a.split(/[\s-]+/)[0])||void 0===t?void 0:t.toLowerCase())||"";return g[o]&&(r+=50),r+Math.min(a.length,20)}},{key:"toTitleCase",value:function(e){return e?e.split(/[\s-]+/).filter(Boolean).map(function(e){return e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()}).join(" "):""}},{key:"parseName",value:function(e){return(new(r(889))).parse(e)}},{key:"calculateStringSimilarity",value:function(e,t){var r=[],n=e.length,a=t.length;if(0===n)return 0===a?1:0;if(0===a)return 0;for(var o=0;o<=a;o++)r[o]=[o];for(var i=0;i<=n;i++)r[0][i]=i;for(var u=1;u<=a;u++)for(var s=1;s<=n;s++)t.charAt(u-1)===e.charAt(s-1)?r[u][s]=r[u-1][s-1]:r[u][s]=Math.min(r[u-1][s-1]+1,r[u][s-1]+1,r[u-1][s]+1);return 1-r[a][n]/Math.max(n,a)}},{key:"generateNormalizationSuggestions",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Zotero.debug("ZoteroDBAnalyzer: generateNormalizationSuggestions called with "+(e?e.length:0)+" surname variants and "+(r?r.length:0)+" given-name groups");var a,o=[],i=new Set,u=f(e||[]);try{for(u.s();!(a=u.n()).done;){var s=a.value,c=s.variant1.name,l=s.variant2.name;if(!i.has(c)&&!i.has(l)){var p={type:"surname",primary:s.recommendedNormalization,variants:[{name:s.variant1.name,frequency:s.variant1.frequency,items:n[s.variant1.name]||[]},{name:s.variant2.name,frequency:s.variant2.frequency,items:n[s.variant2.name]||[]}],similarity:s.similarity};this.enrichSuggestionWithGivenNameData(p,r),o.push(p),i.add(c),i.add(l)}}}catch(e){u.e(e)}finally{u.f()}var y,m=f(r||[]);try{var h=function(){var e=y.value;if(!e||!e.surname||!Array.isArray(e.variants)||e.variants.length<2)return 1;var r,n=o.find(function(t){return"given-name"===t.type&&(t.surname||"").toLowerCase()===e.surname.toLowerCase()}),a=e.variants.map(function(t){return{name:"".concat(t.firstName," ").concat(e.surname).trim(),firstName:t.firstName,lastName:e.surname,frequency:t.frequency,items:t.items||[]}});n?(n.variants=t.mergeVariantLists(n.variants,a),n.totalFrequency=(n.totalFrequency||0)+(e.totalFrequency||0)):o.push({type:"given-name",surname:e.surname,normalizedGivenNameKey:e.normalizedKey,variants:a,totalFrequency:e.totalFrequency,recommendedFirstName:e.recommendedFirstName,recommendedFullName:e.recommendedFullName,primary:e.recommendedFullName||"".concat((null===(r=a[0])||void 0===r?void 0:r.name)||"")})};for(m.s();!(y=m.n()).done;)h()}catch(e){m.e(e)}finally{m.f()}return Zotero.debug("ZoteroDBAnalyzer: Generated "+o.length+" normalization suggestions (combined)"),o}},{key:"enrichSuggestionWithGivenNameData",value:function(e,t){if(!e||!t||0===t.length)return e;var r=(e.primary||"").toLowerCase();if(!r)return e;var n=t.find(function(e){return e&&(e.surname||"").toLowerCase()===r});return n?(e.relatedGivenNameVariants=n.variants.map(function(e){return{firstName:e.firstName,frequency:e.frequency,items:e.items||[]}}),e.relatedGivenNameKey=n.normalizedKey,e.relatedGivenNameTotal=n.totalFrequency,e):e}},{key:"mergeVariantLists",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(!t||0===t.length)return e||[];var r,n=new Map,a=f(e||[]);try{for(a.s();!(r=a.n()).done;){var i=r.value;if(i){var s=i.name?i.name.toLowerCase():JSON.stringify(i);n.has(s)||n.set(s,o(o({},i),{},{items:i.items?u(i.items):[]}))}}}catch(e){a.e(e)}finally{a.f()}var c,l=f(t);try{for(l.s();!(c=l.n()).done;){var p=c.value;if(p){var y=p.name?p.name.toLowerCase():JSON.stringify(p);if(n.has(y)){var m=n.get(y);m.frequency=(m.frequency||0)+(p.frequency||0),m.items=this.mergeItemSummaries(m.items,p.items)}else n.set(y,o(o({},p),{},{items:p.items?u(p.items):[]}))}}}catch(e){l.e(e)}finally{l.f()}return Array.from(n.values()).sort(function(e,t){return(t.frequency||0)-(e.frequency||0)})}},{key:"getNormalizationForSurname",value:(l=h(c().m(function e(t){var r,n,a,o,u;return c().w(function(e){for(;;)switch(e.p=e.n){case 0:if("undefined"!=typeof Zotero){e.n=1;break}return e.a(2,null);case 1:return e.n=2,this.analyzeFullLibrary();case 2:r=e.v,n=f(r.potentialVariants),e.p=3,n.s();case 4:if((a=n.n()).done){e.n=6;break}if((o=a.value).variant1.name!==t&&o.variant2.name!==t){e.n=5;break}return e.a(2,{recommended:o.recommendedNormalization,alternatives:[o.variant1.name,o.variant2.name],similarity:o.similarity,frequencies:i(i({},o.variant1.name,o.variant1.frequency),o.variant2.name,o.variant2.frequency)});case 5:e.n=4;break;case 6:e.n=8;break;case 7:e.p=7,u=e.v,n.e(u);case 8:return e.p=8,n.f(),e.f(8);case 9:return e.a(2,null)}},e,this,[[3,7,8,9]])})),function(e){return l.apply(this,arguments)})},{key:"applyNormalizationSuggestions",value:(a=h(c().m(function e(t){var r,n,a,o,i,u,s,l,p,y,m,h,v,d=arguments;return c().w(function(e){for(;;)switch(e.p=e.n){case 0:if(r=d.length>1&&void 0!==d[1]&&d[1],"undefined"!=typeof Zotero){e.n=1;break}throw new Error("This method must be run in the Zotero context");case 1:n={totalSuggestions:t.length,applied:0,skipped:0,errors:0},e.p=2,a=f(t),e.p=3,a.s();case 4:if((o=a.n()).done){e.n=19;break}if(i=o.value,e.p=5,p=r){e.n=7;break}return e.n=6,this.confirmNormalization(i);case 6:p=e.v;case 7:if(!p){e.n=15;break}u=f(i.variants),e.p=8,u.s();case 9:if((s=u.n()).done){e.n=11;break}if((l=s.value).name===i.primary){e.n=10;break}return e.n=10,this.learningEngine.storeMapping(l.name,i.primary,i.similarity);case 10:e.n=9;break;case 11:e.n=13;break;case 12:e.p=12,y=e.v,u.e(y);case 13:return e.p=13,u.f(),e.f(13);case 14:n.applied++,e.n=16;break;case 15:n.skipped++;case 16:e.n=18;break;case 17:e.p=17,m=e.v,console.error("Error applying normalization:",m),n.errors++;case 18:e.n=4;break;case 19:e.n=21;break;case 20:e.p=20,h=e.v,a.e(h);case 21:return e.p=21,a.f(),e.f(21);case 22:e.n=24;break;case 23:e.p=23,v=e.v,console.error("Error in applyNormalizationSuggestions:",v),n.errors++;case 24:return e.a(2,n)}},e,this,[[8,12,13,14],[5,17],[3,20,21,22],[2,23]])})),function(e){return a.apply(this,arguments)})},{key:"confirmNormalization",value:(n=h(c().m(function e(){return c().w(function(e){for(;;)if(0===e.n)return e.a(2,!0)},e)})),function(){return n.apply(this,arguments)})}],t&&v(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,n,a,l,p,y}();e.exports&&(e.exports=b)},889:e=>{function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t(e)}function r(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,n(a.key),a)}}function n(e){var r=function(e){if("object"!=t(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!=t(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==t(r)?r:r+""}var a=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.prefixes=["van","de","la","von","del","di","du","le","lo","da","des","dos","das","el","al"],this.suffixes=["Jr","Sr","II","III","IV","PhD","MD","Jr.","Sr."],this.initialPattern=/^[A-Z]\.?$/,this.initialsPattern=/^[A-Z]\.[A-Z]\.?$/},(t=[{key:"parse",value:function(e){var t=e||"",r=t.trim().replace(/[,\\s]+$/,"").split(/\s+/),n={firstName:"",middleName:"",lastName:"",prefix:"",suffix:"",original:t};if(1===r.length&&""!==r[0])return this.prefixes.includes(r[0].toLowerCase())?n.prefix=r[0]:n.lastName=r[0],n;if(1===r.length&&""===r[0])return n;if(r.length>=2){n.firstName=r[0];for(var a=1;a<r.length-1&&this.prefixes.includes(r[a].toLowerCase());)n.prefix?n.prefix="".concat(n.prefix," ").concat(r[a]):n.prefix=r[a],a++;n.prefix&&a<r.length-1&&this.isNextWordForPrefix(n.prefix,r[a])&&(n.prefix="".concat(n.prefix," ").concat(r[a]),a++);for(var o=r.length-1;o>a&&this.suffixes.some(function(e){return r[o].toLowerCase()===e.toLowerCase()||r[o].toLowerCase()===e.toLowerCase()+"."});)n.suffix?n.suffix="".concat(r[o]," ").concat(n.suffix):n.suffix=r[o],o--;if(o>=a&&(n.lastName=r[o]),a<o){var i=r.slice(a,o);i.length>0&&(n.middleName=i.join(" "))}}return n}},{key:"isNextWordForPrefix",value:function(e,t){return!!["del","de","da","das","dos","do","du","des","di"].includes(e)&&/^[A-Z][a-zA-Z]+$/.test(t)&&t.length>1}}])&&r(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();e.exports&&(e.exports=a)}},t={};function r(n){var a=t[n];if(void 0!==a)return a.exports;var o=t[n]={exports:{}};return e[n](o,o.exports,r),o.exports}r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var n={};return(()=>{"use strict";r.r(n),r.d(n,{BatchProcessor:()=>k.a,CandidateFinder:()=>f.a,DataManager:()=>O.a,GLINERHandler:()=>y.a,ItemProcessor:()=>h.a,LearningEngine:()=>c.a,MenuIntegration:()=>d.a,NERProcessor:()=>t.a,NERWorker:()=>A.a,NameParser:()=>o.a,NormalizerDialog:()=>S.a,VariantGenerator:()=>u.a,ZoteroDBAnalyzer:()=>b.a,default:()=>E});var e=r(388),t=r.n(e),a=r(889),o=r.n(a),i=r(441),u=r.n(i),s=r(95),c=r.n(s),l=r(22),f=r.n(l),p=r(208),y=r.n(p),m=r(48),h=r.n(m),v=r(886),d=r.n(v),g=r(887),b=r.n(g),w=r(491),S=r.n(w),N=r(672),k=r.n(N),j=r(588),O=r.n(j),P=r(827),A=r.n(P),x={NERProcessor:t(),NameParser:o(),VariantGenerator:u(),LearningEngine:c(),CandidateFinder:f(),GLINERHandler:y(),ItemProcessor:h(),MenuIntegration:d(),ZoteroDBAnalyzer:b(),NormalizerDialog:S(),BatchProcessor:k(),DataManager:O(),NERWorker:A()};"undefined"!=typeof window&&(window.ZoteroNER=x);const E=x})(),n})());