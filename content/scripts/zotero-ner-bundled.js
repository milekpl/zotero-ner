/*! For license information please see zotero-ner-bundled.js.LICENSE.txt */
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.ZoteroNER=e():t.ZoteroNER=e()}(this,()=>(()=>{var t={22:(t,e,r)=>{function n(t){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},n(t)}function o(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=c(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,u=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return i=t.done,t},e:function(t){u=!0,a=t},f:function(){try{i||null==r.return||r.return()}finally{if(u)throw a}}}}function a(){var t,e,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",o=r.toStringTag||"@@toStringTag";function u(r,n,o,a){var u=n&&n.prototype instanceof s?n:s,l=Object.create(u.prototype);return i(l,"_invoke",function(r,n,o){var a,i,u,s=0,l=o||[],f=!1,p={p:0,n:0,v:t,a:y,f:y.bind(t,4),d:function(e,r){return a=e,i=0,u=t,p.n=r,c}};function y(r,n){for(i=r,u=n,e=0;!f&&s&&!o&&e<l.length;e++){var o,a=l[e],y=p.p,m=a[2];r>3?(o=m===n)&&(u=a[(i=a[4])?5:(i=3,3)],a[4]=a[5]=t):a[0]<=y&&((o=r<2&&y<a[1])?(i=0,p.v=n,p.n=a[1]):y<m&&(o=r<3||a[0]>n||n>m)&&(a[4]=r,a[5]=n,p.n=m,i=0))}if(o||r>1)return c;throw f=!0,n}return function(o,l,m){if(s>1)throw TypeError("Generator is already running");for(f&&1===l&&y(l,m),i=l,u=m;(e=i<2?t:u)||!f;){a||(i?i<3?(i>1&&(p.n=-1),y(i,u)):p.n=u:p.v=u);try{if(s=2,a){if(i||(o="next"),e=a[o]){if(!(e=e.call(a,u)))throw TypeError("iterator result is not an object");if(!e.done)return e;u=e.value,i<2&&(i=0)}else 1===i&&(e=a.return)&&e.call(a),i<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),i=1);a=t}else if((e=(f=p.n<0)?u:r.call(n,p))!==c)break}catch(e){a=t,i=1,u=e}finally{s=1}}return{value:e,done:f}}}(r,o,a),!0),l}var c={};function s(){}function l(){}function f(){}e=Object.getPrototypeOf;var p=[][n]?e(e([][n]())):(i(e={},n,function(){return this}),e),y=f.prototype=s.prototype=Object.create(p);function m(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,f):(t.__proto__=f,i(t,o,"GeneratorFunction")),t.prototype=Object.create(y),t}return l.prototype=f,i(y,"constructor",f),i(f,"constructor",l),l.displayName="GeneratorFunction",i(f,o,"GeneratorFunction"),i(y),i(y,o,"Generator"),i(y,n,function(){return this}),i(y,"toString",function(){return"[object Generator]"}),(a=function(){return{w:u,m}})()}function i(t,e,r,n){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}i=function(t,e,r,n){function a(e,r){i(t,e,function(t){return this._invoke(e,r,t)})}e?o?o(t,e,{value:r,enumerable:!n,configurable:!n,writable:!n}):t[e]=r:(a("next",0),a("throw",1),a("return",2))},i(t,e,r,n)}function u(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,o,a,i,u=[],c=!0,s=!1;try{if(a=(r=r.call(t)).next,0===e){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=a.call(r)).done)&&(u.push(n.value),u.length!==e);c=!0);}catch(t){s=!0,o=t}finally{try{if(!c&&null!=r.return&&(i=r.return(),Object(i)!==i))return}finally{if(s)throw o}}return u}}(t,e)||c(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function c(t,e){if(t){if("string"==typeof t)return s(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?s(t,e):void 0}}function s(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}function l(t,e,r,n,o,a,i){try{var u=t[a](i),c=u.value}catch(t){return void r(t)}u.done?e(c):Promise.resolve(c).then(n,o)}function f(t){return function(){var e=this,r=arguments;return new Promise(function(n,o){var a=t.apply(e,r);function i(t){l(a,n,o,i,u,"next",t)}function u(t){l(a,n,o,i,u,"throw",t)}i(void 0)})}}function p(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,y(n.key),n)}}function y(t){var e=function(t){if("object"!=n(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=n(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==n(e)?e:e+""}var m=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.nerProcessor=new(r(388)),this.learningEngine=new(r(95)),this.nameParser=new(r(889)),this.variantGenerator=new(r(441))},e=[{key:"findNameVariants",value:(l=f(a().m(function t(e){var r,n,o,i,c,s,l,f,p,y,m;return a().w(function(t){for(;;)switch(t.p=t.n){case 0:if(e){t.n=1;break}throw new Error("Zotero database object required for candidate finding");case 1:return t.p=1,t.n=2,this.fetchAllCreators(e);case 2:for(r=t.v,n=this.groupCreatorsBySurname(r),o={},i=0,c=0,s=Object.entries(n);c<s.length;c++)l=u(s[c],2),f=l[0],p=l[1],(y=this.findFirstInitialVariations(p)).length>0&&(o[f]=y,i+=y.length);return t.a(2,{surnameGroups:n,variationsBySurname:o,totalVariantGroups:i,totalSurnames:Object.keys(n).length});case 3:throw t.p=3,m=t.v,console.error("Error in findNameVariants:",m),m;case 4:return t.a(2)}},t,this,[[1,3]])})),function(t){return l.apply(this,arguments)})},{key:"fetchAllCreators",value:(s=f(a().m(function t(e){var r,n,i,u,c,s,l,f,p;return a().w(function(t){for(;;)switch(t.n){case 0:if("undefined"==typeof Zotero){t.n=2;break}return r=[],t.n=1,Zotero.Items.getAll();case 1:n=t.v,i=o(n);try{for(i.s();!(u=i.n()).done;){c=u.value,s=c.getCreators(),l=o(s);try{for(l.s();!(f=l.n()).done;)p=f.value,r.push(p)}catch(t){l.e(t)}finally{l.f()}}}catch(t){i.e(t)}finally{i.f()}return t.a(2,r);case 2:return t.a(2,[{firstName:"Jerry",lastName:"Fodor",creatorType:"author"},{firstName:"J.",lastName:"Fodor",creatorType:"author"},{firstName:"Jerry",lastName:"Fodor",creatorType:"author"},{firstName:"Jerry A.",lastName:"Fodor",creatorType:"author"},{firstName:"J.A.",lastName:"Fodor",creatorType:"author"},{firstName:"Eva",lastName:"van Dijk",creatorType:"author"},{firstName:"E.",lastName:"van Dijk",creatorType:"author"},{firstName:"John",lastName:"Smith",creatorType:"author"},{firstName:"J.",lastName:"Smith",creatorType:"author"},{firstName:"Johnny",lastName:"Smith",creatorType:"author"},{firstName:"J.B.",lastName:"Smith",creatorType:"author"},{firstName:"John B.",lastName:"Smith",creatorType:"author"}]);case 3:return t.a(2)}},t)})),function(t){return s.apply(this,arguments)})},{key:"groupCreatorsBySurname",value:function(t){var e,r={},n=o(t);try{for(n.s();!(e=n.n()).done;){var a=e.value,i=this.nameParser.parse("".concat(a.firstName||""," ").concat(a.lastName||"").trim());if(i.lastName){var u=i.lastName.toLowerCase().trim();r[u]||(r[u]=[]),r[u].push(a)}}}catch(t){n.e(t)}finally{n.f()}return r}},{key:"findFirstInitialVariations",value:function(t){var e,r={},n={},a=o(t);try{for(a.s();!(e=a.n()).done;){var i=e.value,u="".concat(i.firstName||""," ").concat(i.lastName||"").trim().toLowerCase();r[u]=(r[u]||0)+1,n[u]||(n[u]=i)}}catch(t){a.e(t)}finally{a.f()}var c,s={},l=o(t);try{for(l.s();!(c=l.n()).done;){var f=(c.value.firstName||"").trim().toLowerCase();f&&(s[f]||(s[f]=0),s[f]++)}}catch(t){l.e(t)}finally{l.f()}for(var p=Object.keys(s),y=[],m=0;m<p.length;m++)for(var h=m+1;h<p.length;h++){var v=p[m],g=p[h],d=this.calculateLevenshteinDistance(v,g),b=Math.max(v.length,g.length),w=b>0?1-d/b:1;w>=.6&&y.push({surname:t[0].lastName,variant1:{firstName:v,frequency:s[v]},variant2:{firstName:g,frequency:s[g]},similarity:w,distance:d})}return y.sort(function(t,e){var r=t.variant1.frequency+t.variant2.frequency;return e.variant1.frequency+e.variant2.frequency-r}),y}},{key:"findCanonicalForms",value:function(t){for(var e={},r=0,n=Object.entries(t);r<n.length;r++){var a,i=u(n[r],2),c=(i[0],o(i[1]));try{for(c.s();!(a=c.n()).done;){var s=a.value,l=s.variant1.frequency>=s.variant2.frequency?s.variant1.firstName:s.variant2.firstName,f="".concat(s.variant1.firstName," ").concat(s.surname).trim(),p="".concat(s.variant2.firstName," ").concat(s.surname).trim(),y="".concat(l," ").concat(s.surname).trim();e[f.toLowerCase()]=y,e[p.toLowerCase()]=y}}catch(t){c.e(t)}finally{c.f()}}return e}},{key:"calculateLevenshteinDistance",value:function(t,e){var r=[];if(0===t.length)return e.length;if(0===e.length)return t.length;for(var n=0;n<=e.length;n++)r[n]=[n];for(var o=0;o<=t.length;o++)r[0][o]=o;for(var a=1;a<=e.length;a++)for(var i=1;i<=t.length;i++)e.charAt(a-1)===t.charAt(i-1)?r[a][i]=r[a-1][i-1]:r[a][i]=Math.min(r[a-1][i-1]+1,r[a][i-1]+1,r[a-1][i]+1);return r[e.length][t.length]}},{key:"performFullAnalysis",value:(c=f(a().m(function t(e){var r,n,o;return a().w(function(t){for(;;)switch(t.n){case 0:return console.log("Starting full name variant analysis (first name/initial focus)..."),t.n=1,this.findNameVariants(e);case 1:return r=t.v,n=this.findCanonicalForms(r.variationsBySurname),t.n=2,this.generateNormalizationSuggestions(r.variationsBySurname,n);case 2:return o=t.v,console.log("Analysis complete: Found ".concat(r.totalVariantGroups," variant groups across ").concat(r.totalSurnames," surnames")),t.a(2,{surnameGroups:r.surnameGroups,variationsBySurname:r.variationsBySurname,canonicalForms:n,suggestions:o,totalVariantGroups:r.totalVariantGroups,totalSurnamesAnalyzed:r.totalSurnames})}},t,this)})),function(t){return c.apply(this,arguments)})},{key:"generateNormalizationSuggestions",value:(i=f(a().m(function t(e,r){var n,i,c,s,l,f,p,y,m,h;return a().w(function(t){for(;;)if(0===t.n){for(n=[],i=0,c=Object.entries(e);i<c.length;i++){(s=u(c[i],2))[0],l=s[1],f=o(l);try{for(f.s();!(p=f.n()).done;)y=p.value,m="".concat(y.variant1.firstName," ").concat(y.surname).trim(),h="".concat(y.variant2.firstName," ").concat(y.surname).trim(),n.push({surname:y.surname,canonicalForm:r[m.toLowerCase()]||r[h.toLowerCase()],variant1:{firstName:y.variant1.firstName,frequency:y.variant1.frequency},variant2:{firstName:y.variant2.firstName,frequency:y.variant2.frequency},similarity:y.similarity,recommendedNormalization:y.variant1.frequency>=y.variant2.frequency?y.variant1.firstName:y.variant2.firstName})}catch(t){f.e(t)}finally{f.f()}}return t.a(2,n)}},t)})),function(t,e){return i.apply(this,arguments)})},{key:"getAllVariations",value:(n=f(a().m(function t(e){var r;return a().w(function(t){for(;;)if(0===t.n)return r=this.nameParser.parse(e),t.a(2,this.variantGenerator.generateVariants(r))},t,this)})),function(t){return n.apply(this,arguments)})}],e&&p(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,n,i,c,s,l}();t.exports&&(t.exports=m)},48:(t,e,r)=>{function n(t){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},n(t)}function o(){var t,e,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",i=r.toStringTag||"@@toStringTag";function u(r,n,o,i){var u=n&&n.prototype instanceof s?n:s,l=Object.create(u.prototype);return a(l,"_invoke",function(r,n,o){var a,i,u,s=0,l=o||[],f=!1,p={p:0,n:0,v:t,a:y,f:y.bind(t,4),d:function(e,r){return a=e,i=0,u=t,p.n=r,c}};function y(r,n){for(i=r,u=n,e=0;!f&&s&&!o&&e<l.length;e++){var o,a=l[e],y=p.p,m=a[2];r>3?(o=m===n)&&(u=a[(i=a[4])?5:(i=3,3)],a[4]=a[5]=t):a[0]<=y&&((o=r<2&&y<a[1])?(i=0,p.v=n,p.n=a[1]):y<m&&(o=r<3||a[0]>n||n>m)&&(a[4]=r,a[5]=n,p.n=m,i=0))}if(o||r>1)return c;throw f=!0,n}return function(o,l,m){if(s>1)throw TypeError("Generator is already running");for(f&&1===l&&y(l,m),i=l,u=m;(e=i<2?t:u)||!f;){a||(i?i<3?(i>1&&(p.n=-1),y(i,u)):p.n=u:p.v=u);try{if(s=2,a){if(i||(o="next"),e=a[o]){if(!(e=e.call(a,u)))throw TypeError("iterator result is not an object");if(!e.done)return e;u=e.value,i<2&&(i=0)}else 1===i&&(e=a.return)&&e.call(a),i<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),i=1);a=t}else if((e=(f=p.n<0)?u:r.call(n,p))!==c)break}catch(e){a=t,i=1,u=e}finally{s=1}}return{value:e,done:f}}}(r,o,i),!0),l}var c={};function s(){}function l(){}function f(){}e=Object.getPrototypeOf;var p=[][n]?e(e([][n]())):(a(e={},n,function(){return this}),e),y=f.prototype=s.prototype=Object.create(p);function m(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,f):(t.__proto__=f,a(t,i,"GeneratorFunction")),t.prototype=Object.create(y),t}return l.prototype=f,a(y,"constructor",f),a(f,"constructor",l),l.displayName="GeneratorFunction",a(f,i,"GeneratorFunction"),a(y),a(y,i,"Generator"),a(y,n,function(){return this}),a(y,"toString",function(){return"[object Generator]"}),(o=function(){return{w:u,m}})()}function a(t,e,r,n){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}a=function(t,e,r,n){function i(e,r){a(t,e,function(t){return this._invoke(e,r,t)})}e?o?o(t,e,{value:r,enumerable:!n,configurable:!n,writable:!n}):t[e]=r:(i("next",0),i("throw",1),i("return",2))},a(t,e,r,n)}function i(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,n)}return r}function u(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?i(Object(r),!0).forEach(function(e){c(t,e,r[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})}return t}function c(t,e,r){return(e=m(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function s(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return l(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?l(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,u=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return i=t.done,t},e:function(t){u=!0,a=t},f:function(){try{i||null==r.return||r.return()}finally{if(u)throw a}}}}function l(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}function f(t,e,r,n,o,a,i){try{var u=t[a](i),c=u.value}catch(t){return void r(t)}u.done?e(c):Promise.resolve(c).then(n,o)}function p(t){return function(){var e=this,r=arguments;return new Promise(function(n,o){var a=t.apply(e,r);function i(t){f(a,n,o,i,u,"next",t)}function u(t){f(a,n,o,i,u,"throw",t)}i(void 0)})}}function y(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,m(n.key),n)}}function m(t){var e=function(t){if("object"!=n(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=n(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==n(e)?e:e+""}var h=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.nameParser=new(r(889)),this.variantGenerator=new(r(441)),this.learningEngine=new(r(95)),this.candidateFinder=new(r(22))},e=[{key:"processItemCreators",value:(c=p(o().m(function t(e){var r,n,a,i,c,l,f,p,y,m,h,v;return o().w(function(t){for(;;)switch(t.p=t.n){case 0:r=[],n=e.getCreators?e.getCreators():[],a=s(n),t.p=1,a.s();case 2:if((i=a.n()).done){t.n=6;break}if(!(c=i.value).firstName&&!c.lastName){t.n=5;break}if(l=this.buildRawName(c),!(f=this.learningEngine.getMapping(l))){t.n=3;break}return r.push({original:u({},c),normalized:this.parseNameFromFullString(f),type:c.creatorType,status:"learned",suggestion:f}),t.a(3,5);case 3:return p=this.learningEngine.findSimilar(l),y=this.nameParser.parse(l),m=this.variantGenerator.generateVariants(y),t.n=4,this.findLibraryWideVariants(y.lastName);case 4:h=t.v,r.push({original:u({},c),parsed:y,variants:m,similars:p,libraryVariants:h,type:c.creatorType,status:"new"});case 5:t.n=2;break;case 6:t.n=8;break;case 7:t.p=7,v=t.v,a.e(v);case 8:return t.p=8,a.f(),t.f(8);case 9:return t.a(2,r)}},t,this,[[1,7,8,9]])})),function(t){return c.apply(this,arguments)})},{key:"findLibraryWideVariants",value:(i=p(o().m(function t(e){var r;return o().w(function(t){for(;;)switch(t.p=t.n){case 0:if("undefined"==typeof Zotero){t.n=3;break}return t.p=1,t.a(2,[]);case 2:return t.p=2,r=t.v,console.warn("Could not perform library-wide variant scan:",r),t.a(2,[]);case 3:return t.a(2,[])}},t,null,[[1,2]])})),function(t){return i.apply(this,arguments)})},{key:"buildRawName",value:function(t){return"".concat(t.firstName||""," ").concat(t.lastName||"").trim()}},{key:"parseNameFromFullString",value:function(t){var e=this.nameParser.parse(t);return{firstName:e.firstName,lastName:e.lastName,fieldMode:0}}},{key:"applyNormalizations",value:(a=p(o().m(function t(e,r){var n,a,i,u;return o().w(function(t){for(;;)switch(t.n){case 0:n=0;case 1:if(!(n<r.length)){t.n=3;break}if(!(a=r[n]).accepted){t.n=2;break}return console.log("Applying normalization: ".concat(a.original.firstName," ").concat(a.original.lastName," -> ").concat(a.normalized.firstName," ").concat(a.normalized.lastName)),i=this.buildRawName(a.original),u=this.buildRawName(a.normalized),t.n=2,this.learningEngine.storeMapping(i,u);case 2:n++,t.n=1;break;case 3:console.log("Applied normalizations to item:",e.getField("title"));case 4:return t.a(2)}},t,this)})),function(t,e){return a.apply(this,arguments)})},{key:"performLibraryAnalysis",value:(n=p(o().m(function t(e){var r,n,a,i,u,c,l,f,p,y,m,h,v,g,d,b,w,S,N,k,j,O,P,x;return o().w(function(t){for(;;)if(0===t.n){r=[],n=s(e);try{for(n.s();!(a=n.n()).done;){i=a.value,u=i.getCreators?i.getCreators():[],c=s(u);try{for(c.s();!(l=c.n()).done;)((f=l.value).firstName||f.lastName)&&(p=this.buildRawName(f),r.push(p))}catch(t){c.e(t)}finally{c.f()}}}catch(t){n.e(t)}finally{n.f()}for(this.learningEngine.constructor.prototype.extractSurnamesWithFrequency||this.nameParser.constructor.prototype.extractSurnamesWithFrequency,y={},m=0,h=r;m<h.length;m++)v=h[m],(g=this.nameParser.parse(v)).lastName&&(d=g.lastName.toLowerCase().trim(),y[d]=(y[d]||0)+1);for(b=Object.keys(y),w=[],S=0;S<b.length;S++)for(N=S+1;N<b.length;N++)k=b[S],j=b[N],O=this.calculateLevenshteinDistance(k,j),P=Math.max(k.length,j.length),(x=P>0?1-O/P:1)>=.8&&w.push({name1:k,name2:j,frequency1:y[k],frequency2:y[j],similarity:x});return t.a(2,{surnameFrequencies:y,potentialVariants:w,totalNames:r.length,uniqueSurnames:b.length})}},t,this)})),function(t){return n.apply(this,arguments)})},{key:"calculateLevenshteinDistance",value:function(t,e){var r=[];if(0===t.length)return e.length;if(0===e.length)return t.length;for(var n=0;n<=e.length;n++)r[n]=[n];for(var o=0;o<=t.length;o++)r[0][o]=o;for(var a=1;a<=e.length;a++)for(var i=1;i<=t.length;i++)e.charAt(a-1)===t.charAt(i-1)?r[a][i]=r[a-1][i-1]:r[a][i]=Math.min(r[a-1][i-1]+1,r[a][i-1]+1,r[a-1][i]+1);return r[e.length][t.length]}}],e&&y(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,n,a,i,c}();t.exports&&(t.exports=h)},95:(t,e,r)=>{function n(t){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},n(t)}function o(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,o,a,i,u=[],c=!0,s=!1;try{if(a=(r=r.call(t)).next,0===e){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=a.call(r)).done)&&(u.push(n.value),u.length!==e);c=!0);}catch(t){s=!0,o=t}finally{try{if(!c&&null!=r.return&&(i=r.return(),Object(i)!==i))return}finally{if(s)throw o}}return u}}(t,e)||l(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function a(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=l(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,u=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return i=t.done,t},e:function(t){u=!0,a=t},f:function(){try{i||null==r.return||r.return()}finally{if(u)throw a}}}}function i(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,n)}return r}function u(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?i(Object(r),!0).forEach(function(e){c(t,e,r[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})}return t}function c(t,e,r){return(e=g(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function s(t){return function(t){if(Array.isArray(t))return f(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||l(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function l(t,e){if(t){if("string"==typeof t)return f(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?f(t,e):void 0}}function f(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}function p(){var t,e,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",o=r.toStringTag||"@@toStringTag";function a(r,n,o,a){var c=n&&n.prototype instanceof u?n:u,s=Object.create(c.prototype);return y(s,"_invoke",function(r,n,o){var a,u,c,s=0,l=o||[],f=!1,p={p:0,n:0,v:t,a:y,f:y.bind(t,4),d:function(e,r){return a=e,u=0,c=t,p.n=r,i}};function y(r,n){for(u=r,c=n,e=0;!f&&s&&!o&&e<l.length;e++){var o,a=l[e],y=p.p,m=a[2];r>3?(o=m===n)&&(c=a[(u=a[4])?5:(u=3,3)],a[4]=a[5]=t):a[0]<=y&&((o=r<2&&y<a[1])?(u=0,p.v=n,p.n=a[1]):y<m&&(o=r<3||a[0]>n||n>m)&&(a[4]=r,a[5]=n,p.n=m,u=0))}if(o||r>1)return i;throw f=!0,n}return function(o,l,m){if(s>1)throw TypeError("Generator is already running");for(f&&1===l&&y(l,m),u=l,c=m;(e=u<2?t:c)||!f;){a||(u?u<3?(u>1&&(p.n=-1),y(u,c)):p.n=c:p.v=c);try{if(s=2,a){if(u||(o="next"),e=a[o]){if(!(e=e.call(a,c)))throw TypeError("iterator result is not an object");if(!e.done)return e;c=e.value,u<2&&(u=0)}else 1===u&&(e=a.return)&&e.call(a),u<2&&(c=TypeError("The iterator does not provide a '"+o+"' method"),u=1);a=t}else if((e=(f=p.n<0)?c:r.call(n,p))!==i)break}catch(e){a=t,u=1,c=e}finally{s=1}}return{value:e,done:f}}}(r,o,a),!0),s}var i={};function u(){}function c(){}function s(){}e=Object.getPrototypeOf;var l=[][n]?e(e([][n]())):(y(e={},n,function(){return this}),e),f=s.prototype=u.prototype=Object.create(l);function m(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,s):(t.__proto__=s,y(t,o,"GeneratorFunction")),t.prototype=Object.create(f),t}return c.prototype=s,y(f,"constructor",s),y(s,"constructor",c),c.displayName="GeneratorFunction",y(s,o,"GeneratorFunction"),y(f),y(f,o,"Generator"),y(f,n,function(){return this}),y(f,"toString",function(){return"[object Generator]"}),(p=function(){return{w:a,m}})()}function y(t,e,r,n){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}y=function(t,e,r,n){function a(e,r){y(t,e,function(t){return this._invoke(e,r,t)})}e?o?o(t,e,{value:r,enumerable:!n,configurable:!n,writable:!n}):t[e]=r:(a("next",0),a("throw",1),a("return",2))},y(t,e,r,n)}function m(t,e,r,n,o,a,i){try{var u=t[a](i),c=u.value}catch(t){return void r(t)}u.done?e(c):Promise.resolve(c).then(n,o)}function h(t){return function(){var e=this,r=arguments;return new Promise(function(n,o){var a=t.apply(e,r);function i(t){m(a,n,o,i,u,"next",t)}function u(t){m(a,n,o,i,u,"throw",t)}i(void 0)})}}function v(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,g(n.key),n)}}function g(t){var e=function(t){if("object"!=n(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=n(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==n(e)?e:e+""}var d=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.storageKey="ner_normalizer_mappings",this.settingsKey="ner_normalizer_settings",this.mappings=new Map,this.settings=this.getDefaultSettings(),this.loadMappings(),this.loadSettings()},e=[{key:"getStorage",value:function(){return"undefined"!=typeof localStorage?localStorage:"undefined"!=typeof window&&window.localStorage?window.localStorage:(r.g._nerStorage||(r.g._nerStorage={}),{getItem:function(t){return r.g._nerStorage[t]||null},setItem:function(t,e){r.g._nerStorage[t]=e},removeItem:function(t){delete r.g._nerStorage[t]}})}},{key:"loadMappings",value:(g=h(p().m(function t(){var e,r,n;return p().w(function(t){for(;;)switch(t.n){case 0:try{e=this.getStorage(),(r=e.getItem(this.storageKey))&&(n=JSON.parse(r),this.mappings=new Map(n))}catch(t){console.error("Error loading mappings:",t),this.mappings=new Map}case 1:return t.a(2)}},t,this)})),function(){return g.apply(this,arguments)})},{key:"saveMappings",value:(m=h(p().m(function t(){var e,r;return p().w(function(t){for(;;)switch(t.n){case 0:try{e=this.getStorage(),r=JSON.stringify(s(this.mappings.entries())),e.setItem(this.storageKey,r)}catch(t){console.error("Error saving mappings:",t)}case 1:return t.a(2)}},t,this)})),function(){return m.apply(this,arguments)})},{key:"loadSettings",value:(y=h(p().m(function t(){var e,r;return p().w(function(t){for(;;)switch(t.n){case 0:try{e=this.getStorage(),(r=e.getItem(this.settingsKey))&&(this.settings=u(u({},this.getDefaultSettings()),JSON.parse(r)))}catch(t){console.error("Error loading settings:",t),this.settings=this.getDefaultSettings()}case 1:return t.a(2)}},t,this)})),function(){return y.apply(this,arguments)})},{key:"saveSettings",value:(f=h(p().m(function t(){return p().w(function(t){for(;;)switch(t.n){case 0:try{this.getStorage().setItem(this.settingsKey,JSON.stringify(this.settings))}catch(t){console.error("Error saving settings:",t)}case 1:return t.a(2)}},t,this)})),function(){return f.apply(this,arguments)})},{key:"getDefaultSettings",value:function(){return{autoApplyLearned:!0,confidenceThreshold:.8,enableSpanishSurnameDetection:!0,showSimilarityScore:!0,maxSuggestions:5}}},{key:"storeMapping",value:(l=h(p().m(function t(e,r){var n,o,a,i,c,s=arguments;return p().w(function(t){for(;;)switch(t.n){case 0:return n=s.length>2&&void 0!==s[2]?s[2]:1,o=s.length>3&&void 0!==s[3]?s[3]:{},a=this.createCanonicalKey(e),i=Date.now(),this.mappings.has(a)?((c=this.mappings.get(a)).normalized=r,c.confidence=Math.max(c.confidence,n),c.lastUsed=i,c.usageCount=(c.usageCount||0)+1,c.context=u(u({},c.context),o)):this.mappings.set(a,{raw:e,normalized:r,timestamp:i,lastUsed:i,confidence:n,usageCount:1,context:o}),t.n=1,this.saveMappings();case 1:return t.a(2)}},t,this)})),function(t,e){return l.apply(this,arguments)})},{key:"recordUsage",value:(c=h(p().m(function t(e){var r,n;return p().w(function(t){for(;;)switch(t.n){case 0:if(r=this.createCanonicalKey(e),!(n=this.mappings.get(r))){t.n=1;break}return n.lastUsed=Date.now(),n.usageCount=(n.usageCount||0)+1,t.n=1,this.saveMappings();case 1:return t.a(2)}},t,this)})),function(t){return c.apply(this,arguments)})},{key:"getMapping",value:function(t){var e=this.createCanonicalKey(t),r=this.mappings.get(e);return r?(this.recordUsage(t),r.normalized):null}},{key:"hasMapping",value:function(t){var e=this.createCanonicalKey(t);return this.mappings.has(e)}},{key:"getMappingDetails",value:function(t){var e=this.createCanonicalKey(t),r=this.mappings.get(e);return r?(this.recordUsage(t),u({},r)):null}},{key:"getAllMappings",value:function(){return new Map(this.mappings)}},{key:"removeMapping",value:(i=h(p().m(function t(e){var r;return p().w(function(t){for(;;)switch(t.n){case 0:return r=this.createCanonicalKey(e),this.mappings.delete(r),t.n=1,this.saveMappings();case 1:return t.a(2)}},t,this)})),function(t){return i.apply(this,arguments)})},{key:"clearAllMappings",value:(n=h(p().m(function t(){return p().w(function(t){for(;;)switch(t.n){case 0:return this.mappings.clear(),t.n=1,this.saveMappings();case 1:return t.a(2)}},t,this)})),function(){return n.apply(this,arguments)})},{key:"createCanonicalKey",value:function(t){return t.trim().toLowerCase().replace(/[.,]/g,"").replace(/\s+/g," ")}},{key:"findSimilar",value:function(t){var e,r=this.createCanonicalKey(t),n=[],i=a(this.mappings);try{for(i.s();!(e=i.n()).done;){var c=o(e.value,2),s=c[0],l=c[1],f=this.calculateSimilarity(r,s);f>=this.settings.confidenceThreshold&&n.push(u(u({},l),{},{similarity:f}))}}catch(t){i.e(t)}finally{i.f()}return n.sort(function(t,e){return e.similarity!==t.similarity?e.similarity-t.similarity:(e.usageCount||0)-(t.usageCount||0)}).slice(0,this.settings.maxSuggestions)}},{key:"calculateSimilarity",value:function(t,e){return.5*this.jaroWinklerSimilarity(t,e)+.3*this.lcsSimilarity(t,e)+.2*this.initialMatchingSimilarity(t,e)}},{key:"jaroWinklerSimilarity",value:function(t,e){if(t===e)return 1;if(!t||!e)return 0;for(var r=[],n=t.length,o=e.length,a=Math.floor(Math.max(n,o)/2)-1,i=0,u=0,c=new Array(n).fill(!1),s=new Array(o).fill(!1),l=0;l<n;l++)for(var f=Math.max(0,l-a),p=Math.min(l+a+1,o),y=f;y<p;y++)if(!s[y]&&t[l]===e[y]){c[l]=s[y]=!0,i++,r.push(t[l]);break}if(0===i)return 0;for(var m=0,h=0;h<n;h++)if(c[h]){for(;!s[m];)m++;t[h]!==e[m]&&u++,m++}for(var v=(i/n+i/o+(i-u/2)/i)/3,g=0,d=Math.min(4,Math.min(t.length,e.length)),b=0;b<d&&t[b]===e[b];b++)g++;return v+.1*g*(1-v)}},{key:"lcsSimilarity",value:function(t,e){var r=this;if(!t||!e)return 0;if(t===e)return 1;var n,o=t.split(/\s+/),i=e.split(/\s+/),u=0,c=a(o);try{var s=function(){var t=n.value;i.some(function(e){return r.isSimilarWord(t,e)})&&u++};for(c.s();!(n=c.n()).done;)s()}catch(t){c.e(t)}finally{c.f()}var l=Math.max(o.length,i.length);return l>0?u/l:0}},{key:"isSimilarWord",value:function(t,e){if((t=t.replace(/\./g,""))===(e=e.replace(/\./g,"")))return!0;if(1===t.length&&e.startsWith(t)||1===e.length&&t.startsWith(e))return!0;var r={jose:"joseph",joseph:"joe",robert:"rob",charles:"chuck",william:"will",jonathan:"jon"};return r[t]===e||r[e]===t}},{key:"areWordsSimilar",value:function(t,e){return this.isSimilarWord(t,e)}},{key:"isAbbreviation",value:function(t,e){if(t.length>=e.length)return!1;for(var r=0;r<t.length;r++)if(e[r]!==t[r])return!1;return!0}},{key:"initialMatchingSimilarity",value:function(t,e){var r=t.split(/\s+/),n=e.split(/\s+/);return 0===r.length||0===n.length?0:(this.compareNameParts(r[0],n[0])+this.compareNameParts(r[r.length-1],n[n.length-1]))/2}},{key:"compareNameParts",value:function(t,e){if(!t||!e)return 0;if(t.toLowerCase()===e.toLowerCase())return 1;var r=t.replace(/\./g,"").toLowerCase(),n=e.replace(/\./g,"").toLowerCase();return 1===r.length&&n.startsWith(r)||1===n.length&&r.startsWith(n)?.8:this.jaroWinklerSimilarity(r,n)}},{key:"exportMappings",value:function(){return{version:"1.0",timestamp:Date.now(),mappings:s(this.mappings.entries()),settings:this.settings}}},{key:"importMappings",value:function(t){if("1.0"!==t.version)throw new Error("Unsupported import data version");this.mappings=new Map(t.mappings),t.settings&&(this.settings=u(u({},this.settings),t.settings),this.saveSettings()),this.saveMappings()}},{key:"getStatistics",value:function(){var t,e=this.mappings.size,r=0,n=0,o=a(this.mappings.values());try{for(o.s();!(t=o.n()).done;){var i=t.value;r+=i.usageCount||0,n+=i.confidence||0}}catch(t){o.e(t)}finally{o.f()}return{totalMappings:e,totalUsage:r,averageUsage:e>0?r/e:0,averageConfidence:n=e>0?n/e:0}}}],e&&v(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,n,i,c,l,f,y,m,g}();t.exports&&(t.exports=d)},208:t=>{function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},e(t)}function r(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return n(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?n(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var o=0,a=function(){};return{s:a,n:function(){return o>=t.length?{done:!0}:{done:!1,value:t[o++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,u=!0,c=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return u=t.done,t},e:function(t){c=!0,i=t},f:function(){try{u||null==r.return||r.return()}finally{if(c)throw i}}}}function n(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}function o(){var t,e,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",i=r.toStringTag||"@@toStringTag";function u(r,n,o,i){var u=n&&n.prototype instanceof s?n:s,l=Object.create(u.prototype);return a(l,"_invoke",function(r,n,o){var a,i,u,s=0,l=o||[],f=!1,p={p:0,n:0,v:t,a:y,f:y.bind(t,4),d:function(e,r){return a=e,i=0,u=t,p.n=r,c}};function y(r,n){for(i=r,u=n,e=0;!f&&s&&!o&&e<l.length;e++){var o,a=l[e],y=p.p,m=a[2];r>3?(o=m===n)&&(u=a[(i=a[4])?5:(i=3,3)],a[4]=a[5]=t):a[0]<=y&&((o=r<2&&y<a[1])?(i=0,p.v=n,p.n=a[1]):y<m&&(o=r<3||a[0]>n||n>m)&&(a[4]=r,a[5]=n,p.n=m,i=0))}if(o||r>1)return c;throw f=!0,n}return function(o,l,m){if(s>1)throw TypeError("Generator is already running");for(f&&1===l&&y(l,m),i=l,u=m;(e=i<2?t:u)||!f;){a||(i?i<3?(i>1&&(p.n=-1),y(i,u)):p.n=u:p.v=u);try{if(s=2,a){if(i||(o="next"),e=a[o]){if(!(e=e.call(a,u)))throw TypeError("iterator result is not an object");if(!e.done)return e;u=e.value,i<2&&(i=0)}else 1===i&&(e=a.return)&&e.call(a),i<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),i=1);a=t}else if((e=(f=p.n<0)?u:r.call(n,p))!==c)break}catch(e){a=t,i=1,u=e}finally{s=1}}return{value:e,done:f}}}(r,o,i),!0),l}var c={};function s(){}function l(){}function f(){}e=Object.getPrototypeOf;var p=[][n]?e(e([][n]())):(a(e={},n,function(){return this}),e),y=f.prototype=s.prototype=Object.create(p);function m(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,f):(t.__proto__=f,a(t,i,"GeneratorFunction")),t.prototype=Object.create(y),t}return l.prototype=f,a(y,"constructor",f),a(f,"constructor",l),l.displayName="GeneratorFunction",a(f,i,"GeneratorFunction"),a(y),a(y,i,"Generator"),a(y,n,function(){return this}),a(y,"toString",function(){return"[object Generator]"}),(o=function(){return{w:u,m}})()}function a(t,e,r,n){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}a=function(t,e,r,n){function i(e,r){a(t,e,function(t){return this._invoke(e,r,t)})}e?o?o(t,e,{value:r,enumerable:!n,configurable:!n,writable:!n}):t[e]=r:(i("next",0),i("throw",1),i("return",2))},a(t,e,r,n)}function i(t,e,r,n,o,a,i){try{var u=t[a](i),c=u.value}catch(t){return void r(t)}u.done?e(c):Promise.resolve(c).then(n,o)}function u(t){return function(){var e=this,r=arguments;return new Promise(function(n,o){var a=t.apply(e,r);function u(t){i(a,n,o,u,c,"next",t)}function c(t){i(a,n,o,u,c,"throw",t)}u(void 0)})}}function c(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,s(n.key),n)}}function s(t){var r=function(t){if("object"!=e(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=e(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==e(r)?r:r+""}var l=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.model=null,this.isInitialized=!1,this.entities=["person","first_name","middle_name","last_name","prefix","suffix"]},e=[{key:"initialize",value:(i=u(o().m(function t(){var e=this;return o().w(function(t){for(;;)switch(t.n){case 0:console.log("Initializing GLINER model handler...");try{"undefined"!=typeof ort?console.log("ONNX model loaded successfully"):(console.log("ONNX runtime not available, using mock implementation"),this.model={run:function(){var t=u(o().m(function t(r){return o().w(function(t){for(;;)if(0===t.n)return t.a(2,e.mockNERResult(r))},t)}));return function(e){return t.apply(this,arguments)}}()}),this.isInitialized=!0,console.log("GLINER model handler initialized")}catch(t){console.error("Error initializing GLINER model:",t),this.model=null,this.isInitialized=!1}case 1:return t.a(2)}},t,this)})),function(){return i.apply(this,arguments)})},{key:"mockNERResult",value:function(t){for(var e=t.text||t[0]||"",r=e.split(/\s+/),n=[],o=0;o<r.length;o++){var a=r[o],i="O";/^[A-Z]\.?$/.test(a)?i="initial":/^[A-Z][a-z]+/.test(a)&&0===o?i="first_name":/^[A-Z][a-z]+/.test(a)&&o===r.length-1?i="last_name":["van","de","la","von","del","di","du","le","lo"].includes(a.toLowerCase())&&(i="prefix"),n.push({word:a,start:e.indexOf(a),end:e.indexOf(a)+a.length,label:i})}return{entities:n}}},{key:"runNER",value:(a=u(o().m(function t(e){var r,n,a;return o().w(function(t){for(;;)switch(t.p=t.n){case 0:if(this.isInitialized){t.n=1;break}return t.n=1,this.initialize();case 1:if(this.model){t.n=2;break}return t.a(2,this.ruleBasedNER(e));case 2:return t.p=2,r={text:e},t.n=3,this.model.run(r);case 3:return n=t.v,t.a(2,n.entities||[]);case 4:return t.p=4,a=t.v,console.error("Error running NER:",a),t.a(2,this.ruleBasedNER(e))}},t,this,[[2,4]])})),function(t){return a.apply(this,arguments)})},{key:"ruleBasedNER",value:function(t){for(var e=t.split(/\s+/),r=[],n=["van","de","la","von","del","di","du","le","lo","da","des","dos","das","el","al"],o=["Jr","Sr","II","III","IV","PhD","MD","Jr.","Sr."],a=function(){var a=e[i].replace(/[.,]/g,""),u=e[i],c="O";o.some(function(t){return t.toLowerCase()===a.toLowerCase()})?c="suffix":n.includes(a.toLowerCase())?c="prefix":/^[A-Z]\.?$/.test(a)?c="initial":0===i?c="first_name":i===e.length-1?c="last_name":i>0&&i<e.length-1&&(c="middle_name"),r.push({text:u,start:t.indexOf(u),end:t.indexOf(u)+u.length,label:c})},i=0;i<e.length;i++)a();return r}},{key:"runBatchNER",value:(n=u(o().m(function t(e){var n,a,i,u,c,s;return o().w(function(t){for(;;)switch(t.p=t.n){case 0:n=[],a=r(e),t.p=1,a.s();case 2:if((i=a.n()).done){t.n=5;break}return u=i.value,t.n=3,this.runNER(u);case 3:c=t.v,n.push({text:u,entities:c});case 4:t.n=2;break;case 5:t.n=7;break;case 6:t.p=6,s=t.v,a.e(s);case 7:return t.p=7,a.f(),t.f(7);case 8:return t.a(2,n)}},t,this,[[1,6,7,8]])})),function(t){return n.apply(this,arguments)})}],e&&c(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,n,a,i}();t.exports=l},388:(t,e,r)=>{function n(t){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},n(t)}function o(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return a(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?a(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,u=!0,c=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return u=t.done,t},e:function(t){c=!0,i=t},f:function(){try{u||null==r.return||r.return()}finally{if(c)throw i}}}}function a(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}function i(){var t,e,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",o=r.toStringTag||"@@toStringTag";function a(r,n,o,a){var i=n&&n.prototype instanceof s?n:s,l=Object.create(i.prototype);return u(l,"_invoke",function(r,n,o){var a,i,u,s=0,l=o||[],f=!1,p={p:0,n:0,v:t,a:y,f:y.bind(t,4),d:function(e,r){return a=e,i=0,u=t,p.n=r,c}};function y(r,n){for(i=r,u=n,e=0;!f&&s&&!o&&e<l.length;e++){var o,a=l[e],y=p.p,m=a[2];r>3?(o=m===n)&&(u=a[(i=a[4])?5:(i=3,3)],a[4]=a[5]=t):a[0]<=y&&((o=r<2&&y<a[1])?(i=0,p.v=n,p.n=a[1]):y<m&&(o=r<3||a[0]>n||n>m)&&(a[4]=r,a[5]=n,p.n=m,i=0))}if(o||r>1)return c;throw f=!0,n}return function(o,l,m){if(s>1)throw TypeError("Generator is already running");for(f&&1===l&&y(l,m),i=l,u=m;(e=i<2?t:u)||!f;){a||(i?i<3?(i>1&&(p.n=-1),y(i,u)):p.n=u:p.v=u);try{if(s=2,a){if(i||(o="next"),e=a[o]){if(!(e=e.call(a,u)))throw TypeError("iterator result is not an object");if(!e.done)return e;u=e.value,i<2&&(i=0)}else 1===i&&(e=a.return)&&e.call(a),i<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),i=1);a=t}else if((e=(f=p.n<0)?u:r.call(n,p))!==c)break}catch(e){a=t,i=1,u=e}finally{s=1}}return{value:e,done:f}}}(r,o,a),!0),l}var c={};function s(){}function l(){}function f(){}e=Object.getPrototypeOf;var p=[][n]?e(e([][n]())):(u(e={},n,function(){return this}),e),y=f.prototype=s.prototype=Object.create(p);function m(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,f):(t.__proto__=f,u(t,o,"GeneratorFunction")),t.prototype=Object.create(y),t}return l.prototype=f,u(y,"constructor",f),u(f,"constructor",l),l.displayName="GeneratorFunction",u(f,o,"GeneratorFunction"),u(y),u(y,o,"Generator"),u(y,n,function(){return this}),u(y,"toString",function(){return"[object Generator]"}),(i=function(){return{w:a,m}})()}function u(t,e,r,n){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}u=function(t,e,r,n){function a(e,r){u(t,e,function(t){return this._invoke(e,r,t)})}e?o?o(t,e,{value:r,enumerable:!n,configurable:!n,writable:!n}):t[e]=r:(a("next",0),a("throw",1),a("return",2))},u(t,e,r,n)}function c(t,e,r,n,o,a,i){try{var u=t[a](i),c=u.value}catch(t){return void r(t)}u.done?e(c):Promise.resolve(c).then(n,o)}function s(t){return function(){var e=this,r=arguments;return new Promise(function(n,o){var a=t.apply(e,r);function i(t){c(a,n,o,i,u,"next",t)}function u(t){c(a,n,o,i,u,"throw",t)}i(void 0)})}}function l(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,f(n.key),n)}}function f(t){var e=function(t){if("object"!=n(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=n(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==n(e)?e:e+""}var p=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.glinerHandler=null,this.isInitialized=!1,this.entities=["PERSON","FIRST_NAME","MIDDLE_NAME","LAST_NAME","PREFIX","SUFFIX"]},e=[{key:"initialize",value:(c=s(i().m(function t(){var e,n;return i().w(function(t){for(;;)switch(t.p=t.n){case 0:return e=r(208),this.glinerHandler=new e,t.p=1,t.n=2,this.glinerHandler.initialize();case 2:console.log("NER Processor initialized with GLINER handler"),t.n=4;break;case 3:t.p=3,n=t.v,console.error("Error initializing GLINER handler:",n),console.log("Using fallback rule-based processing");case 4:this.isInitialized=!0;case 5:return t.a(2)}},t,this,[[1,3]])})),function(){return c.apply(this,arguments)})},{key:"processText",value:(u=s(i().m(function t(e){return i().w(function(t){for(;;)switch(t.n){case 0:if(this.isInitialized){t.n=1;break}return t.n=1,this.initialize();case 1:if(!this.glinerHandler||!this.glinerHandler.isInitialized){t.n=3;break}return t.n=2,this.glinerHandler.runNER(e);case 2:return t.a(2,t.v);case 3:return t.a(2,this.fallbackNER(e));case 4:return t.a(2)}},t,this)})),function(t){return u.apply(this,arguments)})},{key:"fallbackNER",value:function(t){for(var e=t.split(/\s+/),r=[],n=["van","de","la","von","del","di","du","le","lo","da","des","dos","das","el","al"],o=["Jr","Sr","II","III","IV","PhD","MD","Jr.","Sr."],a=function(){var a=e[i].replace(/[.,]/g,""),u=e[i],c="O";o.some(function(t){return t.toLowerCase()===a.toLowerCase()})?c="suffix":n.includes(a.toLowerCase())?c="prefix":/^[A-Z]\.?$/.test(a)?c="initial":0===i?c="first_name":i===e.length-1?c="last_name":i>0&&i<e.length-1&&(c="middle_name"),r.push({text:u,start:t.indexOf(u),end:t.indexOf(u)+u.length,label:c})},i=0;i<e.length;i++)a();return r}},{key:"parseName",value:(a=s(i().m(function t(e){var r;return i().w(function(t){for(;;)switch(t.n){case 0:if(this.isInitialized){t.n=1;break}return t.n=1,this.initialize();case 1:return t.n=2,this.processText(e);case 2:return r=t.v,t.a(2,this.structureNameComponents(e,r))}},t,this)})),function(t){return a.apply(this,arguments)})},{key:"structureNameComponents",value:function(t,e){var n,a=(new(r(889))).parse(t),i=o(e);try{for(i.s();!(n=i.n()).done;){var u=n.value;"prefix"===u.label?a.prefix=u.text:"suffix"===u.label&&(a.suffix=u.text)}}catch(t){i.e(t)}finally{i.f()}return a}},{key:"processBatch",value:(n=s(i().m(function t(e){var r,n,a,u,c,s;return i().w(function(t){for(;;)switch(t.p=t.n){case 0:if(this.isInitialized){t.n=1;break}return t.n=1,this.initialize();case 1:if(!this.glinerHandler||!this.glinerHandler.isInitialized){t.n=3;break}return t.n=2,this.glinerHandler.runBatchNER(e);case 2:return t.a(2,t.v);case 3:r=[],n=o(e),t.p=4,n.s();case 5:if((a=n.n()).done){t.n=8;break}return u=a.value,t.n=6,this.fallbackNER(u);case 6:c=t.v,r.push({text:u,entities:c});case 7:t.n=5;break;case 8:t.n=10;break;case 9:t.p=9,s=t.v,n.e(s);case 10:return t.p=10,n.f(),t.f(10);case 11:return t.a(2,r);case 12:return t.a(2)}},t,this,[[4,9,10,11]])})),function(t){return n.apply(this,arguments)})},{key:"getConfidence",value:function(t){var e=.5;return t.firstName&&t.lastName&&(e+=.3),t.prefix&&(e+=.1),t.suffix&&(e+=.1),t.firstName&&t.firstName.length>2&&(e+=.05),t.lastName&&t.lastName.length>2&&(e+=.05),Math.min(e,1)}},{key:"findVariantsBySimilarity",value:function(t,e){var r,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.8,a=[],i=o(e);try{for(i.s();!(r=i.n()).done;){var u=r.value,c=this.levenshteinDistance(t,u),s=1-c/Math.max(t.length,u.length);s>=n&&a.push({name:u,similarity:s,distance:c})}}catch(t){i.e(t)}finally{i.f()}return a.sort(function(t,e){return e.similarity-t.similarity})}},{key:"levenshteinDistance",value:function(t,e){var r=[];if(0===t.length)return e.length;if(0===e.length)return t.length;for(var n=0;n<=e.length;n++)r[n]=[n];for(var o=0;o<=t.length;o++)r[0][o]=o;for(var a=1;a<=e.length;a++)for(var i=1;i<=t.length;i++)e.charAt(a-1)===t.charAt(i-1)?r[a][i]=r[a-1][i-1]:r[a][i]=Math.min(r[a-1][i-1]+1,r[a][i-1]+1,r[a-1][i]+1);return r[e.length][t.length]}},{key:"extractNameFrequencies",value:function(t){var e,n={},a={},i=new(r(889)),u=o(t);try{for(u.s();!(e=u.n()).done;){var c=e.value,s=i.parse(c);if(s.lastName){var l=s.lastName.toLowerCase().trim();n[l]=(n[l]||0)+1}if(s.firstName){var f=s.firstName.toLowerCase().trim();a[f]=(a[f]||0)+1}}}catch(t){u.e(t)}finally{u.f()}return{surnames:n,firstNames:a}}}],e&&l(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,n,a,u,c}();t.exports&&(t.exports=p)},441:t=>{function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},e(t)}function r(t,e){for(var r=0;r<e.length;r++){var o=e[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,n(o.key),o)}}function n(t){var r=function(t){if("object"!=e(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=e(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==e(r)?r:r+""}var o=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.variationPatterns=[this.fullForm,this.initialForm,this.lastOnlyForm,this.firstInitialLastForm,this.firstInitialsLastForm]},(e=[{key:"generateVariants",value:function(t){var e=this,r=new Set;return this.variationPatterns.forEach(function(n){var o=n.call(e,t);o&&r.add(o)}),r.add(t.original),Array.from(r)}},{key:"fullForm",value:function(t){var e=[];return t.firstName&&e.push(t.firstName),t.middleName&&e.push(t.middleName),t.prefix&&e.push(t.prefix),t.lastName&&e.push(t.lastName),e.join(" ").trim()}},{key:"initialForm",value:function(t){if(!t.firstName||!t.lastName)return null;var e=t.firstName.charAt(0).toUpperCase()+".",r="";t.middleName&&(r=t.middleName.split(/\s+/).map(function(t){return t.charAt(0).toUpperCase()+"."}).join(" "));var n=[];return n.push(e),r&&n.push(r),t.prefix&&n.push(t.prefix),n.push(t.lastName),n.join(" ").trim()}},{key:"lastOnlyForm",value:function(t){return t.lastName?t.lastName.trim():null}},{key:"firstInitialLastForm",value:function(t){if(!t.firstName||!t.lastName)return null;var e=t.firstName.charAt(0).toUpperCase()+".",r=[];return r.push(e),t.prefix&&r.push(t.prefix),r.push(t.lastName),r.join(" ").trim()}},{key:"firstInitialsLastForm",value:function(t){if(!t.firstName||!t.lastName)return null;var e=t.firstName.charAt(0).toUpperCase()+".",r="";t.middleName&&(r=t.middleName.split(/\s+/).map(function(t){return t.charAt(0).toUpperCase()+"."}).join(""));var n=[];return n.push(e+r),t.prefix&&n.push(t.prefix),n.push(t.lastName),n.join(" ").trim().replace(/\.{2,}/g,".")}},{key:"generateCanonical",value:function(t){var e=[];return t.lastName&&e.push(t.lastName.toUpperCase()),t.firstName&&e.push(t.firstName.toUpperCase()),t.middleName&&t.middleName.split(/\s+/).forEach(function(t){return e.push(t.toUpperCase())}),e.join(" ").trim()}}])&&r(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();t.exports&&(t.exports=o)},491:(t,e,r)=>{function n(t){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},n(t)}function o(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,n)}return r}function a(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?o(Object(r),!0).forEach(function(e){i(t,e,r[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})}return t}function i(t,e,r){return(e=m(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function u(){var t,e,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",o=r.toStringTag||"@@toStringTag";function a(r,n,o,a){var u=n&&n.prototype instanceof s?n:s,l=Object.create(u.prototype);return c(l,"_invoke",function(r,n,o){var a,u,c,s=0,l=o||[],f=!1,p={p:0,n:0,v:t,a:y,f:y.bind(t,4),d:function(e,r){return a=e,u=0,c=t,p.n=r,i}};function y(r,n){for(u=r,c=n,e=0;!f&&s&&!o&&e<l.length;e++){var o,a=l[e],y=p.p,m=a[2];r>3?(o=m===n)&&(c=a[(u=a[4])?5:(u=3,3)],a[4]=a[5]=t):a[0]<=y&&((o=r<2&&y<a[1])?(u=0,p.v=n,p.n=a[1]):y<m&&(o=r<3||a[0]>n||n>m)&&(a[4]=r,a[5]=n,p.n=m,u=0))}if(o||r>1)return i;throw f=!0,n}return function(o,l,m){if(s>1)throw TypeError("Generator is already running");for(f&&1===l&&y(l,m),u=l,c=m;(e=u<2?t:c)||!f;){a||(u?u<3?(u>1&&(p.n=-1),y(u,c)):p.n=c:p.v=c);try{if(s=2,a){if(u||(o="next"),e=a[o]){if(!(e=e.call(a,c)))throw TypeError("iterator result is not an object");if(!e.done)return e;c=e.value,u<2&&(u=0)}else 1===u&&(e=a.return)&&e.call(a),u<2&&(c=TypeError("The iterator does not provide a '"+o+"' method"),u=1);a=t}else if((e=(f=p.n<0)?c:r.call(n,p))!==i)break}catch(e){a=t,u=1,c=e}finally{s=1}}return{value:e,done:f}}}(r,o,a),!0),l}var i={};function s(){}function l(){}function f(){}e=Object.getPrototypeOf;var p=[][n]?e(e([][n]())):(c(e={},n,function(){return this}),e),y=f.prototype=s.prototype=Object.create(p);function m(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,f):(t.__proto__=f,c(t,o,"GeneratorFunction")),t.prototype=Object.create(y),t}return l.prototype=f,c(y,"constructor",f),c(f,"constructor",l),l.displayName="GeneratorFunction",c(f,o,"GeneratorFunction"),c(y),c(y,o,"Generator"),c(y,n,function(){return this}),c(y,"toString",function(){return"[object Generator]"}),(u=function(){return{w:a,m}})()}function c(t,e,r,n){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}c=function(t,e,r,n){function a(e,r){c(t,e,function(t){return this._invoke(e,r,t)})}e?o?o(t,e,{value:r,enumerable:!n,configurable:!n,writable:!n}):t[e]=r:(a("next",0),a("throw",1),a("return",2))},c(t,e,r,n)}function s(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return l(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?l(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,u=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return i=t.done,t},e:function(t){u=!0,a=t},f:function(){try{i||null==r.return||r.return()}finally{if(u)throw a}}}}function l(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}function f(t,e,r,n,o,a,i){try{var u=t[a](i),c=u.value}catch(t){return void r(t)}u.done?e(c):Promise.resolve(c).then(n,o)}function p(t){return function(){var e=this,r=arguments;return new Promise(function(n,o){var a=t.apply(e,r);function i(t){f(a,n,o,i,u,"next",t)}function u(t){f(a,n,o,i,u,"throw",t)}i(void 0)})}}function y(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,m(n.key),n)}}function m(t){var e=function(t){if("object"!=n(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=n(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==n(e)?e:e+""}var h=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.learningEngine=new(r(95)),this.variantGenerator=new(r(441)),this.nameParser=new(r(889))},e=[{key:"showDialog",value:(i=p(u().m(function t(e){var r,n,o,a,i,c;return u().w(function(t){for(;;)switch(t.p=t.n){case 0:console.log("Showing normalization dialog for",e.length,"items"),r=[],n=s(e),t.p=1,n.s();case 2:if((o=n.n()).done){t.n=5;break}return a=o.value,t.n=3,this.processItem(a);case 3:i=t.v,r.push(i);case 4:t.n=2;break;case 5:t.n=7;break;case 6:t.p=6,c=t.v,n.e(c);case 7:return t.p=7,n.f(),t.f(7);case 8:return t.n=9,this.presentOptions(r);case 9:return t.a(2,t.v)}},t,this,[[1,6,7,8]])})),function(t){return i.apply(this,arguments)})},{key:"processItem",value:(o=p(u().m(function t(e){var r,n,o,i,c,l,f,p,y,m,h;return u().w(function(t){for(;;)switch(t.p=t.n){case 0:r=e.getCreators?e.getCreators():[],n=[],o=s(r),t.p=1,o.s();case 2:if((i=o.n()).done){t.n=5;break}if(!(c=i.value).firstName&&!c.lastName){t.n=4;break}if(l=this.buildRawName(c),!(f=this.learningEngine.getMapping(l))){t.n=3;break}return n.push({original:a({},c),normalized:f,type:c.creatorType,alreadyLearned:!0,status:"learned"}),t.a(3,4);case 3:p=this.learningEngine.findSimilar(l),y=this.nameParser.parse(l),m=this.variantGenerator.generateVariants(y),n.push({original:a({},c),rawName:l,variants:m,similars:p,type:c.creatorType,alreadyLearned:!1,parsed:y,status:"new"});case 4:t.n=2;break;case 5:t.n=7;break;case 6:t.p=6,h=t.v,o.e(h);case 7:return t.p=7,o.f(),t.f(7);case 8:return t.a(2,{itemID:e.id,title:e.getField?e.getField("title"):"Unknown Title",creators:n})}},t,this,[[1,6,7,8]])})),function(t){return o.apply(this,arguments)})},{key:"buildRawName",value:function(t){return"".concat(t.firstName||""," ").concat(t.lastName||"").trim()}},{key:"presentOptions",value:(n=p(u().m(function t(e){var r,n,o,a,i,c,l,f,p;return u().w(function(t){for(;;)if(0===t.n){console.log("Presenting options to user:"),r=[],n=s(e);try{for(n.s();!(o=n.n()).done;){a=o.value,i={itemID:a.itemID,title:a.title,creators:[]},c=s(a.creators);try{for(c.s();!(l=c.n()).done;)(f=l.value).alreadyLearned?i.creators.push({original:f.original,normalized:f.normalized,type:f.type,accepted:!0,source:"learned"}):(p=f.variants[0],i.creators.push({original:f.original,normalized:p,type:f.type,accepted:!0,source:"user_selected",selectedFrom:"variants"}))}catch(t){c.e(t)}finally{c.f()}r.push(i)}}catch(t){n.e(t)}finally{n.f()}return t.a(2,r)}},t)})),function(t){return n.apply(this,arguments)})},{key:"renderUIDemo",value:function(t){var e,r='<div class="ner-normalizer-dialog"><h2>Author Name Normalization</h2>',n=s(t);try{for(n.s();!(e=n.n()).done;){var o=e.value;r+='<div class="item-section" data-item-id="'.concat(o.itemID,'">'),r+="<h3>".concat(o.title,"</h3>");var a,i=s(o.creators);try{for(i.s();!(a=i.n()).done;){var u=a.value;if(r+='<div class="creator-section">',u.alreadyLearned)r+="<p><strong>Learned:</strong> ".concat(u.rawName,"  ").concat(u.normalized,"</p>");else{r+="<p><strong>Original:</strong> ".concat(u.rawName,"</p>"),r+='<div class="variants-section">',r+="<h4>Variant Suggestions:</h4><ul>";var c,l=s(u.variants);try{for(l.s();!(c=l.n()).done;){var f=c.value;r+='<li><label><input type="radio" name="selection-'.concat(u.rawName,'" value="').concat(f,'"> ').concat(f,"</label></li>")}}catch(t){l.e(t)}finally{l.f()}if(r+="</ul></div>",u.similars.length>0){r+='<div class="similar-section">',r+="<h4>Similar Previously Learned Names:</h4><ul>";var p,y=s(u.similars);try{for(y.s();!(p=y.n()).done;){var m=p.value;r+='<li><label><input type="radio" name="selection-'.concat(u.rawName,'" value="').concat(m.normalized,'"> ').concat(m.raw,"  ").concat(m.normalized," (confidence: ").concat((100*m.similarity).toFixed(1),"%)</label></li>")}}catch(t){y.e(t)}finally{y.f()}r+="</ul></div>"}}r+="</div>"}}catch(t){i.e(t)}finally{i.f()}r+="</div>"}}catch(t){n.e(t)}finally{n.f()}return r+='<div class="dialog-actions">',r+='<button id="accept-all-btn">Accept All</button>',(r+='<button id="cancel-btn">Cancel</button>')+"</div></div>"}}],e&&y(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,n,o,i}();t.exports&&(t.exports=h)},588:t=>{function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},e(t)}function r(t){return function(t){if(Array.isArray(t))return n(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return n(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?n(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function n(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}function o(){var t,e,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",i=r.toStringTag||"@@toStringTag";function u(r,n,o,i){var u=n&&n.prototype instanceof s?n:s,l=Object.create(u.prototype);return a(l,"_invoke",function(r,n,o){var a,i,u,s=0,l=o||[],f=!1,p={p:0,n:0,v:t,a:y,f:y.bind(t,4),d:function(e,r){return a=e,i=0,u=t,p.n=r,c}};function y(r,n){for(i=r,u=n,e=0;!f&&s&&!o&&e<l.length;e++){var o,a=l[e],y=p.p,m=a[2];r>3?(o=m===n)&&(u=a[(i=a[4])?5:(i=3,3)],a[4]=a[5]=t):a[0]<=y&&((o=r<2&&y<a[1])?(i=0,p.v=n,p.n=a[1]):y<m&&(o=r<3||a[0]>n||n>m)&&(a[4]=r,a[5]=n,p.n=m,i=0))}if(o||r>1)return c;throw f=!0,n}return function(o,l,m){if(s>1)throw TypeError("Generator is already running");for(f&&1===l&&y(l,m),i=l,u=m;(e=i<2?t:u)||!f;){a||(i?i<3?(i>1&&(p.n=-1),y(i,u)):p.n=u:p.v=u);try{if(s=2,a){if(i||(o="next"),e=a[o]){if(!(e=e.call(a,u)))throw TypeError("iterator result is not an object");if(!e.done)return e;u=e.value,i<2&&(i=0)}else 1===i&&(e=a.return)&&e.call(a),i<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),i=1);a=t}else if((e=(f=p.n<0)?u:r.call(n,p))!==c)break}catch(e){a=t,i=1,u=e}finally{s=1}}return{value:e,done:f}}}(r,o,i),!0),l}var c={};function s(){}function l(){}function f(){}e=Object.getPrototypeOf;var p=[][n]?e(e([][n]())):(a(e={},n,function(){return this}),e),y=f.prototype=s.prototype=Object.create(p);function m(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,f):(t.__proto__=f,a(t,i,"GeneratorFunction")),t.prototype=Object.create(y),t}return l.prototype=f,a(y,"constructor",f),a(f,"constructor",l),l.displayName="GeneratorFunction",a(f,i,"GeneratorFunction"),a(y),a(y,i,"Generator"),a(y,n,function(){return this}),a(y,"toString",function(){return"[object Generator]"}),(o=function(){return{w:u,m}})()}function a(t,e,r,n){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}a=function(t,e,r,n){function i(e,r){a(t,e,function(t){return this._invoke(e,r,t)})}e?o?o(t,e,{value:r,enumerable:!n,configurable:!n,writable:!n}):t[e]=r:(i("next",0),i("throw",1),i("return",2))},a(t,e,r,n)}function i(t,e,r,n,o,a,i){try{var u=t[a](i),c=u.value}catch(t){return void r(t)}u.done?e(c):Promise.resolve(c).then(n,o)}function u(t){return function(){var e=this,r=arguments;return new Promise(function(n,o){var a=t.apply(e,r);function u(t){i(a,n,o,u,c,"next",t)}function c(t){i(a,n,o,u,c,"throw",t)}u(void 0)})}}function c(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,s(n.key),n)}}function s(t){var r=function(t){if("object"!=e(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=e(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==e(r)?r:r+""}var l=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.settingsKey="ner_normalizer_settings",this.mappingsKey="ner_normalizer_mappings"},e=[{key:"saveSettings",value:(l=u(o().m(function t(e){var r,n;return o().w(function(t){for(;;)switch(t.p=t.n){case 0:return t.p=0,r=JSON.stringify(e),localStorage.setItem(this.settingsKey,r),t.a(2,!0);case 1:return t.p=1,n=t.v,console.error("Error saving settings:",n),t.a(2,!1)}},t,this,[[0,1]])})),function(t){return l.apply(this,arguments)})},{key:"loadSettings",value:(s=u(o().m(function t(){var e,r;return o().w(function(t){for(;;)switch(t.p=t.n){case 0:if(t.p=0,!(e=localStorage.getItem(this.settingsKey))){t.n=1;break}return t.a(2,JSON.parse(e));case 1:return t.a(2,this.getDefaultSettings());case 2:return t.p=2,r=t.v,console.error("Error loading settings:",r),t.a(2,this.getDefaultSettings())}},t,this,[[0,2]])})),function(){return s.apply(this,arguments)})},{key:"getDefaultSettings",value:function(){return{autoApplyLearned:!0,showSuggestionsThreshold:.8,enableSpanishSurnameDetection:!0}}},{key:"saveMappings",value:(i=u(o().m(function t(e){var n,a;return o().w(function(t){for(;;)switch(t.p=t.n){case 0:return t.p=0,n=JSON.stringify(r(e.entries())),localStorage.setItem(this.mappingsKey,n),t.a(2,!0);case 1:return t.p=1,a=t.v,console.error("Error saving mappings:",a),t.a(2,!1)}},t,this,[[0,1]])})),function(t){return i.apply(this,arguments)})},{key:"loadMappings",value:(a=u(o().m(function t(){var e,r;return o().w(function(t){for(;;)switch(t.p=t.n){case 0:if(t.p=0,!(e=localStorage.getItem(this.mappingsKey))){t.n=1;break}return t.a(2,new Map(JSON.parse(e)));case 1:return t.a(2,new Map);case 2:return t.p=2,r=t.v,console.error("Error loading mappings:",r),t.a(2,new Map)}},t,this,[[0,2]])})),function(){return a.apply(this,arguments)})},{key:"clearAllData",value:(n=u(o().m(function t(){return o().w(function(t){for(;;)switch(t.n){case 0:localStorage.removeItem(this.settingsKey),localStorage.removeItem(this.mappingsKey);case 1:return t.a(2)}},t,this)})),function(){return n.apply(this,arguments)})}],e&&c(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,n,a,i,s,l}();t.exports&&(t.exports=l)},672:(t,e,r)=>{function n(t){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},n(t)}function o(){var t,e,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",i=r.toStringTag||"@@toStringTag";function u(r,n,o,i){var u=n&&n.prototype instanceof s?n:s,l=Object.create(u.prototype);return a(l,"_invoke",function(r,n,o){var a,i,u,s=0,l=o||[],f=!1,p={p:0,n:0,v:t,a:y,f:y.bind(t,4),d:function(e,r){return a=e,i=0,u=t,p.n=r,c}};function y(r,n){for(i=r,u=n,e=0;!f&&s&&!o&&e<l.length;e++){var o,a=l[e],y=p.p,m=a[2];r>3?(o=m===n)&&(u=a[(i=a[4])?5:(i=3,3)],a[4]=a[5]=t):a[0]<=y&&((o=r<2&&y<a[1])?(i=0,p.v=n,p.n=a[1]):y<m&&(o=r<3||a[0]>n||n>m)&&(a[4]=r,a[5]=n,p.n=m,i=0))}if(o||r>1)return c;throw f=!0,n}return function(o,l,m){if(s>1)throw TypeError("Generator is already running");for(f&&1===l&&y(l,m),i=l,u=m;(e=i<2?t:u)||!f;){a||(i?i<3?(i>1&&(p.n=-1),y(i,u)):p.n=u:p.v=u);try{if(s=2,a){if(i||(o="next"),e=a[o]){if(!(e=e.call(a,u)))throw TypeError("iterator result is not an object");if(!e.done)return e;u=e.value,i<2&&(i=0)}else 1===i&&(e=a.return)&&e.call(a),i<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),i=1);a=t}else if((e=(f=p.n<0)?u:r.call(n,p))!==c)break}catch(e){a=t,i=1,u=e}finally{s=1}}return{value:e,done:f}}}(r,o,i),!0),l}var c={};function s(){}function l(){}function f(){}e=Object.getPrototypeOf;var p=[][n]?e(e([][n]())):(a(e={},n,function(){return this}),e),y=f.prototype=s.prototype=Object.create(p);function m(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,f):(t.__proto__=f,a(t,i,"GeneratorFunction")),t.prototype=Object.create(y),t}return l.prototype=f,a(y,"constructor",f),a(f,"constructor",l),l.displayName="GeneratorFunction",a(f,i,"GeneratorFunction"),a(y),a(y,i,"Generator"),a(y,n,function(){return this}),a(y,"toString",function(){return"[object Generator]"}),(o=function(){return{w:u,m}})()}function a(t,e,r,n){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}a=function(t,e,r,n){function i(e,r){a(t,e,function(t){return this._invoke(e,r,t)})}e?o?o(t,e,{value:r,enumerable:!n,configurable:!n,writable:!n}):t[e]=r:(i("next",0),i("throw",1),i("return",2))},a(t,e,r,n)}function i(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return u(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?u(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,c=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return i=t.done,t},e:function(t){c=!0,a=t},f:function(){try{i||null==r.return||r.return()}finally{if(c)throw a}}}}function u(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}function c(t,e,r,n,o,a,i){try{var u=t[a](i),c=u.value}catch(t){return void r(t)}u.done?e(c):Promise.resolve(c).then(n,o)}function s(t){return function(){var e=this,r=arguments;return new Promise(function(n,o){var a=t.apply(e,r);function i(t){c(a,n,o,i,u,"next",t)}function u(t){c(a,n,o,i,u,"throw",t)}i(void 0)})}}function l(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,f(n.key),n)}}function f(t){var e=function(t){if("object"!=n(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=n(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==n(e)?e:e+""}var p=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.learningEngine=new(r(95))},e=[{key:"processBatch",value:(a=s(o().m(function t(e){var r,n,a,u;return o().w(function(t){for(;;)switch(t.p=t.n){case 0:console.log("Processing ".concat(e.length," items in batch")),r=i(e),t.p=1,r.s();case 2:if((n=r.n()).done){t.n=4;break}return a=n.value,t.n=3,this.processItem(a);case 3:t.n=2;break;case 4:t.n=6;break;case 5:t.p=5,u=t.v,r.e(u);case 6:return t.p=6,r.f(),t.f(6);case 7:return t.a(2,{success:!0,processedCount:e.length})}},t,this,[[1,5,6,7]])})),function(t){return a.apply(this,arguments)})},{key:"processItem",value:(n=s(o().m(function t(e){var r,n,a,u,c,s;return o().w(function(t){for(;;)switch(t.n){case 0:r=e.getCreators?e.getCreators():[],n=i(r);try{for(n.s();!(a=n.n()).done;)((u=a.value).firstName||u.lastName)&&(c="".concat(u.firstName||""," ").concat(u.lastName||"").trim(),(s=this.learningEngine.getMapping(c))?console.log("Applying learned normalization: ".concat(c," -> ").concat(s)):console.log("Need to process: ".concat(c)))}catch(t){n.e(t)}finally{n.f()}case 1:return t.a(2)}},t,this)})),function(t){return n.apply(this,arguments)})}],e&&l(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,n,a}();t.exports&&(t.exports=p)},827:(t,e,r)=>{function n(t){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},n(t)}function o(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return a(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?a(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,u=!0,c=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return u=t.done,t},e:function(t){c=!0,i=t},f:function(){try{u||null==r.return||r.return()}finally{if(c)throw i}}}}function a(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}function i(){var t,e,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",o=r.toStringTag||"@@toStringTag";function a(r,n,o,a){var i=n&&n.prototype instanceof s?n:s,l=Object.create(i.prototype);return u(l,"_invoke",function(r,n,o){var a,i,u,s=0,l=o||[],f=!1,p={p:0,n:0,v:t,a:y,f:y.bind(t,4),d:function(e,r){return a=e,i=0,u=t,p.n=r,c}};function y(r,n){for(i=r,u=n,e=0;!f&&s&&!o&&e<l.length;e++){var o,a=l[e],y=p.p,m=a[2];r>3?(o=m===n)&&(u=a[(i=a[4])?5:(i=3,3)],a[4]=a[5]=t):a[0]<=y&&((o=r<2&&y<a[1])?(i=0,p.v=n,p.n=a[1]):y<m&&(o=r<3||a[0]>n||n>m)&&(a[4]=r,a[5]=n,p.n=m,i=0))}if(o||r>1)return c;throw f=!0,n}return function(o,l,m){if(s>1)throw TypeError("Generator is already running");for(f&&1===l&&y(l,m),i=l,u=m;(e=i<2?t:u)||!f;){a||(i?i<3?(i>1&&(p.n=-1),y(i,u)):p.n=u:p.v=u);try{if(s=2,a){if(i||(o="next"),e=a[o]){if(!(e=e.call(a,u)))throw TypeError("iterator result is not an object");if(!e.done)return e;u=e.value,i<2&&(i=0)}else 1===i&&(e=a.return)&&e.call(a),i<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),i=1);a=t}else if((e=(f=p.n<0)?u:r.call(n,p))!==c)break}catch(e){a=t,i=1,u=e}finally{s=1}}return{value:e,done:f}}}(r,o,a),!0),l}var c={};function s(){}function l(){}function f(){}e=Object.getPrototypeOf;var p=[][n]?e(e([][n]())):(u(e={},n,function(){return this}),e),y=f.prototype=s.prototype=Object.create(p);function m(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,f):(t.__proto__=f,u(t,o,"GeneratorFunction")),t.prototype=Object.create(y),t}return l.prototype=f,u(y,"constructor",f),u(f,"constructor",l),l.displayName="GeneratorFunction",u(f,o,"GeneratorFunction"),u(y),u(y,o,"Generator"),u(y,n,function(){return this}),u(y,"toString",function(){return"[object Generator]"}),(i=function(){return{w:a,m}})()}function u(t,e,r,n){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}u=function(t,e,r,n){function a(e,r){u(t,e,function(t){return this._invoke(e,r,t)})}e?o?o(t,e,{value:r,enumerable:!n,configurable:!n,writable:!n}):t[e]=r:(a("next",0),a("throw",1),a("return",2))},u(t,e,r,n)}function c(t,e,r,n,o,a,i){try{var u=t[a](i),c=u.value}catch(t){return void r(t)}u.done?e(c):Promise.resolve(c).then(n,o)}function s(t){return function(){var e=this,r=arguments;return new Promise(function(n,o){var a=t.apply(e,r);function i(t){c(a,n,o,i,u,"next",t)}function u(t){c(a,n,o,i,u,"throw",t)}i(void 0)})}}function l(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,f(n.key),n)}}function f(t){var e=function(t){if("object"!=n(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=n(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==n(e)?e:e+""}var p=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.isInitialized=!1,this.model=null},e=[{key:"initialize",value:(u=s(i().m(function t(){return i().w(function(t){for(;;)switch(t.n){case 0:console.log("NER Worker initialized"),this.isInitialized=!0;case 1:return t.a(2)}},t,this)})),function(){return u.apply(this,arguments)})},{key:"processNames",value:(a=s(i().m(function t(e){var r,n,a,u,c,s;return i().w(function(t){for(;;)switch(t.p=t.n){case 0:if(this.isInitialized){t.n=1;break}return t.n=1,this.initialize();case 1:r=[],n=o(e),t.p=2,n.s();case 3:if((a=n.n()).done){t.n=6;break}return u=a.value,t.n=4,this.processSingleName(u);case 4:c=t.v,r.push(c);case 5:t.n=3;break;case 6:t.n=8;break;case 7:t.p=7,s=t.v,n.e(s);case 8:return t.p=8,n.f(),t.f(8);case 9:return t.a(2,r)}},t,this,[[2,7,8,9]])})),function(t){return a.apply(this,arguments)})},{key:"processSingleName",value:(n=s(i().m(function t(e){var n,o;return i().w(function(t){for(;;)if(0===t.n)return n=r(889),o=new n,t.a(2,o.parse(e))},t)})),function(t){return n.apply(this,arguments)})}],e&&l(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,n,a,u}();t.exports&&(t.exports=p)},886:(t,e,r)=>{function n(t){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},n(t)}function o(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return a(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?a(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,u=!0,c=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return u=t.done,t},e:function(t){c=!0,i=t},f:function(){try{u||null==r.return||r.return()}finally{if(c)throw i}}}}function a(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}function i(){var t,e,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",o=r.toStringTag||"@@toStringTag";function a(r,n,o,a){var i=n&&n.prototype instanceof s?n:s,l=Object.create(i.prototype);return u(l,"_invoke",function(r,n,o){var a,i,u,s=0,l=o||[],f=!1,p={p:0,n:0,v:t,a:y,f:y.bind(t,4),d:function(e,r){return a=e,i=0,u=t,p.n=r,c}};function y(r,n){for(i=r,u=n,e=0;!f&&s&&!o&&e<l.length;e++){var o,a=l[e],y=p.p,m=a[2];r>3?(o=m===n)&&(u=a[(i=a[4])?5:(i=3,3)],a[4]=a[5]=t):a[0]<=y&&((o=r<2&&y<a[1])?(i=0,p.v=n,p.n=a[1]):y<m&&(o=r<3||a[0]>n||n>m)&&(a[4]=r,a[5]=n,p.n=m,i=0))}if(o||r>1)return c;throw f=!0,n}return function(o,l,m){if(s>1)throw TypeError("Generator is already running");for(f&&1===l&&y(l,m),i=l,u=m;(e=i<2?t:u)||!f;){a||(i?i<3?(i>1&&(p.n=-1),y(i,u)):p.n=u:p.v=u);try{if(s=2,a){if(i||(o="next"),e=a[o]){if(!(e=e.call(a,u)))throw TypeError("iterator result is not an object");if(!e.done)return e;u=e.value,i<2&&(i=0)}else 1===i&&(e=a.return)&&e.call(a),i<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),i=1);a=t}else if((e=(f=p.n<0)?u:r.call(n,p))!==c)break}catch(e){a=t,i=1,u=e}finally{s=1}}return{value:e,done:f}}}(r,o,a),!0),l}var c={};function s(){}function l(){}function f(){}e=Object.getPrototypeOf;var p=[][n]?e(e([][n]())):(u(e={},n,function(){return this}),e),y=f.prototype=s.prototype=Object.create(p);function m(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,f):(t.__proto__=f,u(t,o,"GeneratorFunction")),t.prototype=Object.create(y),t}return l.prototype=f,u(y,"constructor",f),u(f,"constructor",l),l.displayName="GeneratorFunction",u(f,o,"GeneratorFunction"),u(y),u(y,o,"Generator"),u(y,n,function(){return this}),u(y,"toString",function(){return"[object Generator]"}),(i=function(){return{w:a,m}})()}function u(t,e,r,n){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}u=function(t,e,r,n){function a(e,r){u(t,e,function(t){return this._invoke(e,r,t)})}e?o?o(t,e,{value:r,enumerable:!n,configurable:!n,writable:!n}):t[e]=r:(a("next",0),a("throw",1),a("return",2))},u(t,e,r,n)}function c(t,e,r,n,o,a,i){try{var u=t[a](i),c=u.value}catch(t){return void r(t)}u.done?e(c):Promise.resolve(c).then(n,o)}function s(t){return function(){var e=this,r=arguments;return new Promise(function(n,o){var a=t.apply(e,r);function i(t){c(a,n,o,i,u,"next",t)}function u(t){c(a,n,o,i,u,"throw",t)}i(void 0)})}}function l(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,f(n.key),n)}}function f(t){var e=function(t){if("object"!=n(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=n(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==n(e)?e:e+""}var p=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.itemProcessor=new(r(48)),this.zoteroDBAnalyzer=new(r(887))},e=[{key:"initialize",value:(c=s(i().m(function t(){return i().w(function(t){for(;;)switch(t.n){case 0:console.log("Initializing menu integration"),this.registerMenuItems();case 1:return t.a(2)}},t,this)})),function(){return c.apply(this,arguments)})},{key:"registerMenuItems",value:function(){console.log("Registered menu items for name normalization")}},{key:"handleNormalizeAction",value:(u=s(i().m(function t(e){var n,a,u,c,s,l,f,p,y,m,h;return i().w(function(t){for(;;)switch(t.p=t.n){case 0:console.log("Handling normalize action for ".concat(e.length," items")),n=[],a=o(e),t.p=1,a.s();case 2:if((u=a.n()).done){t.n=5;break}return c=u.value,t.n=3,this.itemProcessor.processItemCreators(c);case 3:s=t.v,n.push({item:c,results:s});case 4:t.n=2;break;case 5:t.n=7;break;case 6:t.p=6,h=t.v,a.e(h);case 7:return t.p=7,a.f(),t.f(7);case 8:return l=new(r(491)),t.n=9,l.showDialog(e);case 9:f=t.v,p=0;case 10:if(!(p<e.length)){t.n=12;break}return y=e[p],m=f[p],t.n=11,this.itemProcessor.applyNormalizations(y,m.creators);case 11:p++,t.n=10;break;case 12:return t.a(2,{success:!0,processed:e.length})}},t,this,[[1,6,7,8]])})),function(t){return u.apply(this,arguments)})},{key:"performFullLibraryAnalysis",value:(a=s(i().m(function t(){var e,r;return i().w(function(t){for(;;)switch(t.p=t.n){case 0:if("undefined"!=typeof Zotero){t.n=1;break}throw new Error("This feature requires Zotero context");case 1:return console.log("Starting full library analysis for name variants..."),t.p=2,t.n=3,this.zoteroDBAnalyzer.analyzeFullLibrary();case 3:return e=t.v,console.log("Analysis complete: Found ".concat(e.totalVariantGroups," potential variant groups")),t.a(2,e);case 4:throw t.p=4,r=t.v,console.error("Error in full library analysis:",r),r;case 5:return t.a(2)}},t,this,[[2,4]])})),function(){return a.apply(this,arguments)})},{key:"handleFullLibraryAnalysis",value:(n=s(i().m(function t(){var e,r;return i().w(function(t){for(;;)switch(t.p=t.n){case 0:return t.p=0,t.n=1,this.performFullLibraryAnalysis();case 1:return e=t.v,console.log("Full library analysis results:",{totalUniqueSurnames:e.totalUniqueSurnames,totalVariantGroups:e.totalVariantGroups,topSuggestions:e.suggestions.slice(0,10)}),t.a(2,e);case 2:throw t.p=2,r=t.v,console.error("Error handling full library analysis:",r),r;case 3:return t.a(2)}},t,this,[[0,2]])})),function(){return n.apply(this,arguments)})}],e&&l(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,n,a,u,c}();t.exports&&(t.exports=p)},887:(t,e,r)=>{function n(t){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},n(t)}function o(t,e,r){return(e=p(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function a(){var t,e,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",o=r.toStringTag||"@@toStringTag";function u(r,n,o,a){var u=n&&n.prototype instanceof s?n:s,l=Object.create(u.prototype);return i(l,"_invoke",function(r,n,o){var a,i,u,s=0,l=o||[],f=!1,p={p:0,n:0,v:t,a:y,f:y.bind(t,4),d:function(e,r){return a=e,i=0,u=t,p.n=r,c}};function y(r,n){for(i=r,u=n,e=0;!f&&s&&!o&&e<l.length;e++){var o,a=l[e],y=p.p,m=a[2];r>3?(o=m===n)&&(u=a[(i=a[4])?5:(i=3,3)],a[4]=a[5]=t):a[0]<=y&&((o=r<2&&y<a[1])?(i=0,p.v=n,p.n=a[1]):y<m&&(o=r<3||a[0]>n||n>m)&&(a[4]=r,a[5]=n,p.n=m,i=0))}if(o||r>1)return c;throw f=!0,n}return function(o,l,m){if(s>1)throw TypeError("Generator is already running");for(f&&1===l&&y(l,m),i=l,u=m;(e=i<2?t:u)||!f;){a||(i?i<3?(i>1&&(p.n=-1),y(i,u)):p.n=u:p.v=u);try{if(s=2,a){if(i||(o="next"),e=a[o]){if(!(e=e.call(a,u)))throw TypeError("iterator result is not an object");if(!e.done)return e;u=e.value,i<2&&(i=0)}else 1===i&&(e=a.return)&&e.call(a),i<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),i=1);a=t}else if((e=(f=p.n<0)?u:r.call(n,p))!==c)break}catch(e){a=t,i=1,u=e}finally{s=1}}return{value:e,done:f}}}(r,o,a),!0),l}var c={};function s(){}function l(){}function f(){}e=Object.getPrototypeOf;var p=[][n]?e(e([][n]())):(i(e={},n,function(){return this}),e),y=f.prototype=s.prototype=Object.create(p);function m(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,f):(t.__proto__=f,i(t,o,"GeneratorFunction")),t.prototype=Object.create(y),t}return l.prototype=f,i(y,"constructor",f),i(f,"constructor",l),l.displayName="GeneratorFunction",i(f,o,"GeneratorFunction"),i(y),i(y,o,"Generator"),i(y,n,function(){return this}),i(y,"toString",function(){return"[object Generator]"}),(a=function(){return{w:u,m}})()}function i(t,e,r,n){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}i=function(t,e,r,n){function a(e,r){i(t,e,function(t){return this._invoke(e,r,t)})}e?o?o(t,e,{value:r,enumerable:!n,configurable:!n,writable:!n}):t[e]=r:(a("next",0),a("throw",1),a("return",2))},i(t,e,r,n)}function u(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return c(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?c(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,u=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return i=t.done,t},e:function(t){u=!0,a=t},f:function(){try{i||null==r.return||r.return()}finally{if(u)throw a}}}}function c(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}function s(t,e,r,n,o,a,i){try{var u=t[a](i),c=u.value}catch(t){return void r(t)}u.done?e(c):Promise.resolve(c).then(n,o)}function l(t){return function(){var e=this,r=arguments;return new Promise(function(n,o){var a=t.apply(e,r);function i(t){s(a,n,o,i,u,"next",t)}function u(t){s(a,n,o,i,u,"throw",t)}i(void 0)})}}function f(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,p(n.key),n)}}function p(t){var e=function(t){if("object"!=n(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=n(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==n(e)?e:e+""}var y=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.candidateFinder=new(r(22)),this.learningEngine=new(r(95))},e=[{key:"analyzeFullLibrary",value:(p=l(a().m(function t(){var e,r,n,o,i,c,s,l,f,p,y,m,h,v,g,d,b,w,S,N,k,j,O,P,x,A,E,T,I,C,z,F,_,G,M,D,L,Z,q,R,B,U,V,J,W,K,$,H,X,Q,Y,tt=arguments;return a().w(function(t){for(;;)switch(t.p=t.n){case 0:if(e=tt.length>0&&void 0!==tt[0]?tt[0]:null,r=tt.length>1&&void 0!==tt[1]?tt[1]:null,Zotero.debug("ZoteroDBAnalyzer: analyzeFullLibrary started"),"undefined"!=typeof Zotero){t.n=1;break}throw Zotero.debug("ZoteroDBAnalyzer: Zotero undefined, throwing error"),new Error("This method must be run in the Zotero context");case 1:return console.log("Starting full library analysis..."),t.p=2,Zotero.debug("ZoteroDBAnalyzer: Creating search for libraryID: "+Zotero.Libraries.userLibraryID),(n=new Zotero.Search).addCondition("libraryID","is",Zotero.Libraries.userLibraryID),t.n=3,n.search();case 3:if(o=t.v,Zotero.debug("ZoteroDBAnalyzer: Search returned "+(o?o.length:0)+" item IDs"),console.log("Found ".concat(o.length," total items in library")),o&&0!==o.length){t.n=4;break}return console.log("No items found in library"),t.a(2,{surnameFrequencies:{},potentialVariants:[],suggestions:[],totalUniqueSurnames:0,totalVariantGroups:0});case 4:i=[],c=200,Zotero.debug("ZoteroDBAnalyzer: Starting item filtering for creators, total items: "+o.length),console.log("Filtering ".concat(o.length," items to find those with creators...")),s=0;case 5:if(!(s<o.length)){t.n=8;break}return l=o.slice(s,s+c),t.n=6,Zotero.Items.getAsync(l);case 6:f=t.v,p=u(f);try{for(p.s();!(y=p.n()).done;){m=y.value;try{(h=m.getCreators?m.getCreators():[])&&Array.isArray(h)&&h.length>0&&(v=h.filter(function(t){return t&&(t.firstName||t.lastName)}),v.length>0&&i.push(m))}catch(t){console.warn("Error processing item creators:",t)}}}catch(t){p.e(t)}finally{p.f()}e&&e({stage:"filtering_items",processed:s+l.length,total:o.length,percent:Math.round((s+l.length)/o.length*100)});case 7:s+=c,t.n=5;break;case 8:if(Zotero.debug("ZoteroDBAnalyzer: Filtering complete, items with creators: "+i.length),console.log("Found ".concat(i.length," items with valid creators")),0!==i.length){t.n=16;break}return console.log("WARNING: No items with valid creators found!"),console.log("This might indicate:"),console.log("1. Items exist but have no creators"),console.log("2. Creator data is malformed"),console.log("3. Search conditions are too restrictive"),console.log("Trying fallback search to verify database access..."),(g=new Zotero.Search).addCondition("libraryID","is",Zotero.Libraries.userLibraryID),g.addCondition("limit","is",10),t.p=9,t.n=10,g.search();case 10:if(!((d=t.v)&&d.length>0)){t.n=12;break}return t.n=11,Zotero.Items.getAsync(d);case 11:b=t.v,console.log("Fallback found ".concat(b.length," items")),w=u(b.slice(0,3));try{for(w.s();!(S=w.n()).done;){N=S.value;try{k=N.getCreators?N.getCreators():[],console.log('Item "'.concat(N.getField?N.getField("title"):"Unknown",'" has ').concat(k.length," creators:"),k)}catch(t){console.log("Error getting creators for item:",t)}}}catch(t){w.e(t)}finally{w.f()}t.n=13;break;case 12:console.log("Fallback search also found no items");case 13:t.n=15;break;case 14:t.p=14,Q=t.v,console.error("Fallback search failed:",Q);case 15:Zotero.debug("ZoteroDBAnalyzer: No items with creators found, fallback search initiated");case 16:j=100,O={},P=0,x=0;case 17:if(!(x<o.length)){t.n=21;break}if(!r||!r()){t.n=18;break}throw console.log("Analysis cancelled by user"),new Error("Analysis cancelled");case 18:return A=o.slice(x,x+c),t.n=19,Zotero.Items.getAsync(A);case 19:E=t.v,T=u(E);try{for(T.s();!(I=T.n()).done;){C=I.value;try{z=C.getCreators?C.getCreators():[],F=u(z);try{for(F.s();!(_=F.n()).done;)(G=_.value)&&(G.firstName||G.lastName)&&(D="".concat(G.firstName||"","|").concat(G.lastName||"","|").concat(G.fieldMode||0),O[D]={firstName:G.firstName||"",lastName:G.lastName||"",fieldMode:G.fieldMode||0,count:((null===(M=O[D])||void 0===M?void 0:M.count)||0)+1})}catch(t){F.e(t)}finally{F.f()}}catch(t){console.warn("Error processing item creators:",t)}}}catch(t){T.e(t)}finally{T.f()}P+=A.length,e&&e({stage:"processing_items",processed:P,total:o.length,percent:Math.round(P/o.length*100)});case 20:x+=j,t.n=17;break;case 21:Zotero.debug("ZoteroDBAnalyzer: Starting creator extraction from "+i.length+" items"),console.log("Found ".concat(i.length," items with creators, now extracting creator data...")),L=0;case 22:if(!(L<i.length)){t.n=25;break}if(!r||!r()){t.n=23;break}throw new Error("Analysis cancelled");case 23:Z=i.slice(L,L+j),q=u(Z);try{for(q.s();!(R=q.n()).done;){B=R.value;try{U=B.getCreators?B.getCreators():[],V=u(U);try{for(V.s();!(J=V.n()).done;)(W=J.value)&&(W.firstName||W.lastName)&&($="".concat(W.firstName||"","|").concat(W.lastName||"","|").concat(W.fieldMode||0),O[$]={firstName:W.firstName||"",lastName:W.lastName||"",fieldMode:W.fieldMode||0,count:((null===(K=O[$])||void 0===K?void 0:K.count)||0)+1})}catch(t){V.e(t)}finally{V.f()}}catch(t){console.warn("Error processing item creators:",t)}}}catch(t){q.e(t)}finally{q.f()}e&&e({stage:"extracting_creators",processed:L+Z.length,total:i.length,percent:Math.round((L+Z.length)/i.length*100)});case 24:L+=j,t.n=22;break;case 25:return H=Object.values(O),Zotero.debug("ZoteroDBAnalyzer: Extracted "+H.length+" unique creators"),console.log("Found ".concat(H.length," unique creator combinations")),H.length>0?(Zotero.debug("ZoteroDBAnalyzer: Sample creators: "+JSON.stringify(H.slice(0,3))),console.log("Sample creators:",H.slice(0,5))):(Zotero.debug("ZoteroDBAnalyzer: WARNING - No creators extracted at all"),console.log("WARNING: No creators found! This indicates an issue with creator extraction.")),Zotero.debug("ZoteroDBAnalyzer: Starting analyzeCreators with "+H.length+" creators"),t.n=26,this.analyzeCreators(H,e,r);case 26:return X=t.v,Zotero.debug("ZoteroDBAnalyzer: analyzeCreators completed, suggestions count: "+(X.suggestions?X.suggestions.length:0)),console.log("Analysis complete: processed ".concat(H.length," unique creator entries")),t.a(2,X);case 27:if(t.p=27,Y=t.v,console.error("Error in database analysis:",Y),"Analysis cancelled"!==Y.message){t.n=28;break}throw Y;case 28:return t.a(2,{surnameFrequencies:{},potentialVariants:[],suggestions:[],totalUniqueSurnames:0,totalVariantGroups:0})}},t,this,[[9,14],[2,27]])})),function(){return p.apply(this,arguments)})},{key:"analyzeCreators",value:(s=l(a().m(function t(e){var r,n,o,i,c,s,l,f,p,y,m,h,v=arguments;return a().w(function(t){for(;;)if(0===t.n){r=v.length>1&&void 0!==v[1]?v[1]:null,n=v.length>2&&void 0!==v[2]?v[2]:null,Zotero.debug("ZoteroDBAnalyzer: analyzeCreators started with "+(e?e.length:0)+" creators"),o={},i=u(e);try{for(i.s();!(c=i.n()).done;)s=c.value,l="".concat(s.firstName," ").concat(s.lastName).trim(),(f=this.parseName(l)).lastName&&(p=f.lastName.toLowerCase().trim(),o[p]=(o[p]||0)+(s.count||1))}catch(t){i.e(t)}finally{i.f()}return y=Object.keys(o),Zotero.debug("ZoteroDBAnalyzer: Found "+y.length+" unique surnames"),console.log("Analyzing ".concat(y.length," unique surnames for variants...")),(m=this.findVariantsEfficiently(o,r,n)).sort(function(t,e){var r=t.variant1.frequency+t.variant2.frequency;return e.variant1.frequency+e.variant2.frequency-r}),h=this.generateNormalizationSuggestions(m),t.a(2,{surnameFrequencies:o,potentialVariants:m,suggestions:h,totalUniqueSurnames:y.length,totalVariantGroups:m.length})}},t,this)})),function(t){return s.apply(this,arguments)})},{key:"findVariantsEfficiently",value:function(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=[],o=Object.keys(t).sort(function(e,r){return t[r]-t[e]}),a=Math.min(1e4,5*o.length),i=0,u=0;u<o.length&&i<a;u++){if(r&&r())throw new Error("Analysis cancelled");for(var c=o[u],s=c.length,l=Math.max(3,s-2),f=s+2,p=u+1;p<o.length&&i<a;p++){var y=o[p];if(!(y.length<l||y.length>f)){i++;var m=this.calculateStringSimilarity(c,y);m>=.8&&n.push({variant1:{name:c,frequency:t[c]},variant2:{name:y,frequency:t[y]},similarity:m,recommendedNormalization:t[c]>=t[y]?c:y})}}e&&u%10==0&&e({stage:"analyzing_surnames",processed:u,total:o.length,percent:Math.round(u/o.length*100)})}return Zotero.debug("ZoteroDBAnalyzer: Variant detection complete, compared "+i+" pairs, found "+n.length+" variants"),console.log("Compared ".concat(i," surname pairs, found ").concat(n.length," potential variants")),n}},{key:"parseName",value:function(t){return(new(r(889))).parse(t)}},{key:"calculateStringSimilarity",value:function(t,e){var r=[],n=t.length,o=e.length;if(0===n)return 0===o?1:0;if(0===o)return 0;for(var a=0;a<=o;a++)r[a]=[a];for(var i=0;i<=n;i++)r[0][i]=i;for(var u=1;u<=o;u++)for(var c=1;c<=n;c++)e.charAt(u-1)===t.charAt(c-1)?r[u][c]=r[u-1][c-1]:r[u][c]=Math.min(r[u-1][c-1]+1,r[u][c-1]+1,r[u-1][c]+1);return 1-r[o][n]/Math.max(n,o)}},{key:"generateNormalizationSuggestions",value:function(t){Zotero.debug("ZoteroDBAnalyzer: generateNormalizationSuggestions called with "+(t?t.length:0)+" variants");var e,r=[],n=new Set,o=u(t);try{for(o.s();!(e=o.n()).done;){var a=e.value,i=a.variant1.name,c=a.variant2.name;n.has(i)||n.has(c)||(r.push({primary:a.recommendedNormalization,variants:[{name:a.variant1.name,frequency:a.variant1.frequency},{name:a.variant2.name,frequency:a.variant2.frequency}],similarity:a.similarity}),n.add(i),n.add(c))}}catch(t){o.e(t)}finally{o.f()}return Zotero.debug("ZoteroDBAnalyzer: Generated "+r.length+" normalization suggestions"),r}},{key:"getNormalizationForSurname",value:(c=l(a().m(function t(e){var r,n,i,c,s;return a().w(function(t){for(;;)switch(t.p=t.n){case 0:if("undefined"!=typeof Zotero){t.n=1;break}return t.a(2,null);case 1:return t.n=2,this.analyzeFullLibrary();case 2:r=t.v,n=u(r.potentialVariants),t.p=3,n.s();case 4:if((i=n.n()).done){t.n=6;break}if((c=i.value).variant1.name!==e&&c.variant2.name!==e){t.n=5;break}return t.a(2,{recommended:c.recommendedNormalization,alternatives:[c.variant1.name,c.variant2.name],similarity:c.similarity,frequencies:o(o({},c.variant1.name,c.variant1.frequency),c.variant2.name,c.variant2.frequency)});case 5:t.n=4;break;case 6:t.n=8;break;case 7:t.p=7,s=t.v,n.e(s);case 8:return t.p=8,n.f(),t.f(8);case 9:return t.a(2,null)}},t,this,[[3,7,8,9]])})),function(t){return c.apply(this,arguments)})},{key:"applyNormalizationSuggestions",value:(i=l(a().m(function t(e){var r,n,o,i,c,s,l,f,p,y,m,h,v,g=arguments;return a().w(function(t){for(;;)switch(t.p=t.n){case 0:if(r=g.length>1&&void 0!==g[1]&&g[1],"undefined"!=typeof Zotero){t.n=1;break}throw new Error("This method must be run in the Zotero context");case 1:n={totalSuggestions:e.length,applied:0,skipped:0,errors:0},t.p=2,o=u(e),t.p=3,o.s();case 4:if((i=o.n()).done){t.n=19;break}if(c=i.value,t.p=5,p=r){t.n=7;break}return t.n=6,this.confirmNormalization(c);case 6:p=t.v;case 7:if(!p){t.n=15;break}s=u(c.variants),t.p=8,s.s();case 9:if((l=s.n()).done){t.n=11;break}if((f=l.value).name===c.primary){t.n=10;break}return t.n=10,this.learningEngine.storeMapping(f.name,c.primary,c.similarity);case 10:t.n=9;break;case 11:t.n=13;break;case 12:t.p=12,y=t.v,s.e(y);case 13:return t.p=13,s.f(),t.f(13);case 14:n.applied++,t.n=16;break;case 15:n.skipped++;case 16:t.n=18;break;case 17:t.p=17,m=t.v,console.error("Error applying normalization:",m),n.errors++;case 18:t.n=4;break;case 19:t.n=21;break;case 20:t.p=20,h=t.v,o.e(h);case 21:return t.p=21,o.f(),t.f(21);case 22:t.n=24;break;case 23:t.p=23,v=t.v,console.error("Error in applyNormalizationSuggestions:",v),n.errors++;case 24:return t.a(2,n)}},t,this,[[8,12,13,14],[5,17],[3,20,21,22],[2,23]])})),function(t){return i.apply(this,arguments)})},{key:"confirmNormalization",value:(n=l(a().m(function t(e){return a().w(function(t){for(;;)if(0===t.n)return t.a(2,!0)},t)})),function(t){return n.apply(this,arguments)})}],e&&f(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,n,i,c,s,p}();t.exports&&(t.exports=y)},889:t=>{function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},e(t)}function r(t,e){for(var r=0;r<e.length;r++){var o=e[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,n(o.key),o)}}function n(t){var r=function(t){if("object"!=e(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=e(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==e(r)?r:r+""}var o=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.prefixes=["van","de","la","von","del","di","du","le","lo","da","des","dos","das","el","al"],this.suffixes=["Jr","Sr","II","III","IV","PhD","MD","Jr.","Sr."],this.initialPattern=/^[A-Z]\.?$/,this.initialsPattern=/^[A-Z]\.[A-Z]\.?$/},(e=[{key:"parse",value:function(t){var e=t||"",r=e.trim().replace(/[,\\s]+$/,"").split(/\s+/),n={firstName:"",middleName:"",lastName:"",prefix:"",suffix:"",original:e};if(1===r.length&&""!==r[0])return this.prefixes.includes(r[0].toLowerCase())?n.prefix=r[0]:n.lastName=r[0],n;if(1===r.length&&""===r[0])return n;if(r.length>=2){n.firstName=r[0];for(var o=1;o<r.length-1&&this.prefixes.includes(r[o].toLowerCase());)n.prefix?n.prefix="".concat(n.prefix," ").concat(r[o]):n.prefix=r[o],o++;n.prefix&&o<r.length-1&&this.isNextWordForPrefix(n.prefix,r[o])&&(n.prefix="".concat(n.prefix," ").concat(r[o]),o++);for(var a=r.length-1;a>o&&this.suffixes.some(function(t){return r[a].toLowerCase()===t.toLowerCase()||r[a].toLowerCase()===t.toLowerCase()+"."});)n.suffix?n.suffix="".concat(r[a]," ").concat(n.suffix):n.suffix=r[a],a--;if(a>=o&&(n.lastName=r[a]),o<a){var i=r.slice(o,a);i.length>0&&(n.middleName=i.join(" "))}}return n}},{key:"isNextWordForPrefix",value:function(t,e){return!!["del","de","da","das","dos","do","du","des","di"].includes(t)&&/^[A-Z][a-zA-Z]+$/.test(e)&&e.length>1}}])&&r(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();t.exports&&(t.exports=o)}},e={};function r(n){var o=e[n];if(void 0!==o)return o.exports;var a=e[n]={exports:{}};return t[n](a,a.exports,r),a.exports}r.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return r.d(e,{a:e}),e},r.d=(t,e)=>{for(var n in e)r.o(e,n)&&!r.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),r.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var n={};return(()=>{"use strict";r.r(n),r.d(n,{BatchProcessor:()=>k.a,CandidateFinder:()=>f.a,DataManager:()=>O.a,GLINERHandler:()=>y.a,ItemProcessor:()=>h.a,LearningEngine:()=>s.a,MenuIntegration:()=>g.a,NERProcessor:()=>e.a,NERWorker:()=>x.a,NameParser:()=>a.a,NormalizerDialog:()=>S.a,VariantGenerator:()=>u.a,ZoteroDBAnalyzer:()=>b.a,default:()=>E});var t=r(388),e=r.n(t),o=r(889),a=r.n(o),i=r(441),u=r.n(i),c=r(95),s=r.n(c),l=r(22),f=r.n(l),p=r(208),y=r.n(p),m=r(48),h=r.n(m),v=r(886),g=r.n(v),d=r(887),b=r.n(d),w=r(491),S=r.n(w),N=r(672),k=r.n(N),j=r(588),O=r.n(j),P=r(827),x=r.n(P),A={NERProcessor:e(),NameParser:a(),VariantGenerator:u(),LearningEngine:s(),CandidateFinder:f(),GLINERHandler:y(),ItemProcessor:h(),MenuIntegration:g(),ZoteroDBAnalyzer:b(),NormalizerDialog:S(),BatchProcessor:k(),DataManager:O(),NERWorker:x()};"undefined"!=typeof window&&(window.ZoteroNER=A);const E=A})(),n})());